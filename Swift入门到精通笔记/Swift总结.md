---
typora-root-url: ../../StudyNotes
---

[TOC]

# åŸºæœ¬è¯­æ³•

## åŸºç¡€

###ABI

ä»Swift5.0å¼€å§‹ABIç¨³å®šäº†

####æè¿°

ABIï¼ˆApplication Binary Interfaceï¼‰ï¼šåº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£ï¼Œæè¿°äº†åº”ç”¨ç¨‹åºå’Œæ“ä½œç³»ç»Ÿä¹‹é—´ï¼Œä¸€ä¸ªåº”ç”¨å’Œå®ƒçš„åº“ä¹‹é—´ï¼Œæˆ–è€…åº”ç”¨çš„ç»„æˆéƒ¨åˆ†ä¹‹é—´çš„ä½æ¥å£ã€‚ABIæ¶µç›–äº†å„ç§ç»†èŠ‚ï¼Œå¦‚ï¼š

+ æ•°æ®ç±»å‹çš„å¤§å°ã€å¸ƒå±€å’Œå¯¹é½
+ è°ƒç”¨çº¦å®šï¼ˆæ§åˆ¶ç€å‡½æ•°çš„å‚æ•°å¦‚ä½•ä¼ é€ä»¥åŠå¦‚ä½•æ¥å—è¿”å›å€¼ï¼‰ï¼Œä¾‹å¦‚ï¼Œæ˜¯æ‰€æœ‰çš„å‚æ•°éƒ½é€šè¿‡æ ˆä¼ é€’ï¼Œè¿˜æ˜¯éƒ¨åˆ†å‚æ•°é€šè¿‡å¯„å­˜å™¨ä¼ é€’ï¼›å“ªä¸ªå¯„å­˜å™¨ç”¨äºå“ªä¸ªå‡½æ•°å‚æ•°ï¼›é€šè¿‡æ ˆä¼ é€’çš„ç¬¬ä¸€ä¸ªå‡½æ•°å‚æ•°æ˜¯æœ€å…ˆpushåˆ°æ ˆä¸Šè¿˜æ˜¯æœ€å
+ ç³»ç»Ÿè°ƒç”¨çš„ç¼–ç å’Œä¸€ä¸ªåº”ç”¨å¦‚ä½•å‘æ“ä½œç³»ç»Ÿè¿›è¡Œç³»ç»Ÿè°ƒç”¨
+ ä»¥åŠåœ¨ä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»ŸABIä¸­ï¼Œç›®æ ‡æ–‡ä»¶çš„äºŒè¿›åˆ¶æ ¼å¼ã€ç¨‹åºåº“ç­‰ç­‰ã€‚

####ABIå’ŒAPIçš„åŒºåˆ«

+ APIæ˜¯Application Programming Interfaceçš„ç¼©å†™ï¼Œå³åº”ç”¨ç¨‹åºæ¥å£ã€‚ ä¸€ä¸ªAPIæ˜¯ä¸åŒä»£ç ç‰‡æ®µçš„è¿æ¥çº½å¸¦ã€‚å®ƒå®šä¹‰äº†ä¸€ä¸ªå‡½æ•°çš„å‚æ•°ï¼Œå‡½æ•°çš„è¿”å›å€¼ï¼Œä»¥åŠä¸€äº›å±æ€§æ¯”å¦‚ç»§æ‰¿æ˜¯å¦è¢«å…è®¸ã€‚ å› æ­¤**APIæ˜¯ç”¨æ¥çº¦æŸç¼–è¯‘å™¨çš„**ï¼šä¸€ä¸ªAPIæ˜¯ç»™ç¼–è¯‘å™¨çš„ä¸€äº›æŒ‡ä»¤ï¼Œå®ƒè§„å®šäº†æºä»£ç å¯ä»¥åšä»¥åŠä¸å¯ä»¥åšå“ªäº›äº‹ã€‚
+ ABIæ˜¯Application Binary Interfaceçš„ç¼©å†™ï¼Œåº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£ã€‚ ä¸€ä¸ªABIæ˜¯ä¸åŒäºŒè¿›åˆ¶ç‰‡æ®µçš„è¿æ¥çº½å¸¦ã€‚ å®ƒå®šä¹‰äº†å‡½æ•°è¢«è°ƒç”¨çš„è§„åˆ™ï¼šå‚æ•°åœ¨è°ƒç”¨è€…å’Œè¢«è°ƒç”¨è€…ä¹‹é—´å¦‚ä½•ä¼ é€’ï¼Œè¿”å›å€¼æ€ä¹ˆæä¾›ç»™è°ƒç”¨è€…ï¼Œåº“å‡½æ•°æ€ä¹ˆè¢«åº”ç”¨ï¼Œä»¥åŠç¨‹åºæ€ä¹ˆè¢«åŠ è½½åˆ°å†…å­˜ã€‚ å› æ­¤**ABIæ˜¯ç”¨æ¥çº¦æŸé“¾æ¥å™¨çš„**ï¼šä¸€ä¸ªABIæ˜¯æ— å…³çš„ä»£ç å¦‚ä½•åœ¨ä¸€èµ·å·¥ä½œçš„è§„åˆ™ã€‚ ä¸€ä¸ªABIä¹Ÿæ˜¯ä¸åŒè¿›ç¨‹å¦‚ä½•åœ¨ä¸€ä¸ªç³»ç»Ÿä¸­å…±å­˜çš„è§„åˆ™ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨Linuxç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªABIå¯èƒ½å®šä¹‰ä¿¡å·å¦‚ä½•è¢«æ‰§è¡Œï¼Œè¿›ç¨‹å¦‚ä½•è°ƒç”¨syscallï¼Œä½¿ç”¨å¤§ç«¯è¿˜æ˜¯å°ç«¯ï¼Œä»¥åŠæ ˆå¦‚ä½•å¢é•¿

###ç¼–è¯‘æµç¨‹

![ç¼–è¯‘æµç¨‹](/Swiftå…¥é—¨åˆ°ç²¾é€šç¬”è®°/ç¼–è¯‘æµç¨‹.png)

ocå’Œswiftçš„ç¼–è¯‘å™¨å‰ç«¯(clangå’Œswiftc)éƒ½å­˜æ”¾åœ¨Xcodeå†…éƒ¨(Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin)

1. ç”Ÿæˆè¯­æ³•æ ‘: swiftc -dump-ast main.swift
2. ç”Ÿæˆæœ€ç®€æ´çš„SILä»£ç : swiftc -emit-sil main.swift
3. ç”ŸæˆLLVM IRä»£ç : swiftc -emit-ir main.swift
4. ç”Ÿæˆæ±‡ç¼–ä»£ç : swiftc -emit-assembly main.swift 

###PlayGround

1. print("hello \(a)") // aæ˜¯å¸¸é‡æˆ–å˜é‡
2. Command+Shift+Enter è¿è¡Œæ•´ä¸ªplayGround
3. Shift+Enter åªè¿è¡Œåˆ°é¼ æ ‡ä½ç½®å¤„ä»£ç 
4. import PlaygroundSupport    å†PlaygroundPage.current.liveView = view ï¼ˆå¯ä»¥å°†viewå±•ç¤ºå†playgroundä¸Šï¼‰
5. æ˜¾ç¤ºmarkUpæ•ˆæœï¼Œ Editor ---> Show Rendered Markup

```swift
//:# ä¸€çº§æ ‡é¢˜
/*:
##åŸºç¡€è¯­æ³•
-å˜é‡
-å¸¸é‡
[è‹¹æœå®˜ç½‘](www.apple.com)
[ä¸‹ä¸€é¡µ](@next)
*/
```

## æ•°æ®ç±»å‹

```swift
var num = 10
num+= 20
 
let age: Int
age = num // å¸¸é‡ä¸è¦æ±‚åœ¨ç¼–è¯‘æ—¶ç¡®å®šï¼Œåªè¦ä½¿ç”¨ä¹‹å‰èµ‹å€¼å°±è¡Œ
// å¸¸é‡ã€å˜é‡åœ¨åˆå§‹åŒ–ä¹‹å‰ï¼Œéƒ½ä¸èƒ½ä½¿ç”¨
//æ ‡è¯†ç¬¦(å¸¸é‡åã€å˜é‡åã€æ–¹æ³•å)å¯ä»¥æ˜¯ä»»ä½•å­—ç¬¦,è¡¨æƒ…ä¹Ÿå¯ä»¥
//Floatï¼Œ 32ä½ï¼Œç²¾åº¦åªæœ‰6ä½ï¼›Doubleï¼Œ64ä½ç½®ï¼Œç²¾åº¦è‡³å°‘15ä½
```

### å¸¸è§æ•°æ®ç±»å‹

![å¸¸è§æ•°æ®ç±»å‹](/Swiftå…¥é—¨åˆ°ç²¾é€šç¬”è®°/å¸¸è§æ•°æ®ç±»å‹.png)

### å­—é¢é‡

å­—é¢é‡ä¹Ÿè¾ƒç«‹å³æ•°

```swift
let character: Character = "ğŸ¶"
// æ•´æ•°
let intDecimal = 17  // åè¿›åˆ¶
let intBinary = 0b10001 // äºŒè¿›åˆ¶
let intOctal = 0O21 // å…«è¿›åˆ¶
let intHextadecimal = 0x11 // åå…­è¿›åˆ¶
//æµ®ç‚¹æ•°
let doubleDecimal = 125.0 // åè¿›åˆ¶
let doubleHexadecimal1 = 0xFp2  // åå…­è¿›åˆ¶,15*2^2,ç›¸å½“äºåè¿›åˆ¶çš„60.0
let doubleHexadecimal2 = 0xFp-2  // åå…­è¿›åˆ¶,15*2^-2ï¼Œç›¸å½“äºåè¿›åˆ¶çš„3.75
// æ•´æ•°å’Œæµ®ç‚¹æ•°å¯ä»¥æ·»åŠ é¢å¤–çš„é›¶æˆ–è€…æ·»åŠ ä¸‹åˆ’çº¿æ¥å¢å¼ºå¯è¯»æ€§
100_0000.000_000_1, 000123.456
//ç±»å‹è½¬æ¢
let int1: UInt16 = 2_000
let int2: UInt8 = 1
let int3 = int1 + UInt16(int2)
// å…ƒç»„
let error = (404, "Not Find")
error.0 // 404
error.1  // Not Find
let(code,message) = error
code // 404
let(code,_) = error // å¿½ç•¥Not Find
let http200Status = (statusCode:200,description:"OK")
http200Status.statusCode
```

## æµç¨‹æ§åˆ¶

### if-else

+ ifåé¢çš„æ¡ä»¶å¯ä»¥çœç•¥å°æ‹¬å·ã€åªèƒ½æ˜¯Boolç±»å‹
+ æ¡ä»¶åé¢çš„å¤§æ‹¬å·ä¸å¯ä»¥çœç•¥çš„

### while

### repeat{}whileæ¡ä»¶

+ ç›¸å½“äºCè¯­éŸ³ä¸­çš„do-while

### ~~++~~

ä¸å†æ”¯æŒï¼›æŠ¥é”™ Use of unresolved operator '++'; did you mean '+= 1'?

+ å¯¹äºvar age = 10; ++age + ++age
+ å¾®è½¯ç¼–è¯‘å™¨ç»“æœ:  12+12
+ Xcodeç¼–è¯‘å™¨ç»“æœ: 11+12

### for

+ é—­åŒºé—´è¿ç®—ç¬¦: a...b, a<= å–å€¼ <=b

  ```swift
  for i in 0...3 {
     print(names[i])  // 1 2 3 4
  }
  let rang = 1...3
  for i in rang {
    print(names[i]) // 2 3 4
  }
  // ié»˜è®¤æ˜¯let,æœ‰éœ€è¦æ—¶å¯ä»¥å£°æ˜ä¸ºvar
  for var i in 1...3 {
    i += 5
    print(i)  // 6 7 8
  }
  for _ in 1...3 {
     print("123") // 123 123 123
  }
  // åŒºé—´è¿ç®—ç¬¦ç”¨åœ¨æ•°ç»„ä¸Š
  for name in names[0...3] {
    print(name)  // 1 2 3 4
  }
  // å•ä¾§åŒºé—´:è®©åŒºé—´æœä¸€ä¸ªæ–¹å‘å°½å¯èƒ½çš„è¿œ
  for name in names[2...] { // 2ã€3ã€4
     print(name)  // 3 4 5
  }
  for name in names[...2] { // 0ã€1ã€2
     print(name) // 1 2 3
  }
  for name in names[..<2] { // 0ã€1
     print(name) // 1 2
  }
  
  let range = ...5 // è´Ÿæ— ç©·-5
  range.contains(-3) // true
  // åŒºé—´ç±»å‹
  let range1: Range<Int> = 1..<3
  // å­—ç¬¦ã€å­—ç¬¦ä¸²ä¹Ÿèƒ½ä½¿ç”¨åŒºé—´è¿ç®—ç¬¦ã€ä½†é»˜è®¤ä¸èƒ½ç”¨åœ¨for-inä¸­
  let stringRange1 = "cc"..."ff"
  stringRange1.contains("cb")  // false
  stringRange1.contains("dz")  // true
  stringRange1.contains("fg")  // false
  // \0-ï½æ‰€æœ‰å¯èƒ½ç”¨åˆ°çš„ASCIIå­—ç¬¦
  let characterRange: ClosedRange<Character> = "\0"..."~"
  // å¸¦é—´éš”çš„åŒºé—´å€¼
  let hours = 11
  let hourInterval = 2
  // tickMarkçš„å–å€¼:ä»4å¼€å§‹,ç´¯åŠ 2ï¼Œä¸è¶…è¿‡11
  for tickMark in stride(from:4,through:hours,by:hourInterval) {
     print(tickMark) // 4 6 8 10
  }
  
  // å°†æ‰€æœ‰æ­£æ•°åŠ èµ·æ¥
  var numbers = [10,20,-10,-20,30,-30]
  var sum = 0
  for num in numbers where num>0 {
    sum += num
  } // 60
  print(sum) // 60 ; where num>0ç›¸å½“äºä¸ç¬¦åˆæ¡ä»¶continue
  ```

### switch

1. caseã€defaultåé¢ä¸èƒ½å†™å¤§æ‹¬å·{}
2. é»˜è®¤å¯ä»¥ä¸å†™breakï¼Œå¹¶ä¸ä¼šè´¯ç©¿åˆ°åé¢çš„æ¡ä»¶
3. ä½¿ç”¨fallthroughå¯ä»¥å®ç°è´¯ç©¿æ•ˆæœ
4. switchå¿…é¡»è¦ä¿è¯èƒ½å¤„ç†æ‰€æœ‰æƒ…å†µ
5. caseã€defaultåé¢è‡³å°‘è¦æœ‰ä¸€æ¡è¯­å¥
6. å¦‚æœèƒ½ä¿è¯å·²å¤„ç†æ‰€æœ‰æƒ…å†µï¼Œä¹Ÿå¯ä»¥ä¸å¿…ä½¿ç”¨default
7. switchä¹Ÿæ”¯æŒCharacterã€Stringç±»å‹
8. å¦‚æœä¸æƒ³åšä»»ä½•äº‹ï¼ŒåŠ ä¸ªbreakæ—¢å¯

```swift
let names = [1,2,3,4,5]
var number = 1
switch number {
  case 1:
     print("number is 1")
     break
  case 2:
     print("number is 2")
     fallthrough  // ä¼šè´¯ç©¿åˆ°ä¸‹ä¸€ä¸ªåˆ¤æ–­
  default:
     print("number is 2")
} // number is 1

let string = "jack"
switch string {
  case "jack":
    fallthrough
  case "Rose":
    print("12")
  default:
    break
}   // 12

// åŒºé—´åŒ¹é…
let count = 62
switch count {
  case 0:
    print("none")
  case 1..<5:
    print("a few")
  default:
    print("many")
} // many

// å…ƒç»„åŒ¹é…
var point = (1,1)
switch point {
  case (0,0):
    print("the origin")
  case (_,0):
    print("on the x-axis") // å·¦è¾¹ä»€ä¹ˆå€¼éƒ½å¯ä»¥
  case(-2...2,-2...2):
    print("inside the box")
  default:
    print("outside the box")
} // inside the box

// å€¼ç»‘å®š
point = (2,0)
switch point {
  case (let x,0):
    print("on the x-axis with an x value of \(x)")
  case let(x,y):
    print("somewhere else at (\(x),\(y))")
} // on the x-axis with an x value of 2


// æ ‡ç­¾è¯­å¥
outer: for i in 1...4 {
  for k in 1...4 {
    if k==3 {
      continue outer
    }
    if i==3 {
      break outer
    }
    print("i==\(i),k==\(k)")
  }
} // i==1,k==1   i==1,k==2   i==2,k==1   i==2,k==2
```

#å‡½æ•°

1. å½¢å‚é»˜è®¤æ˜¯letï¼Œä¹Ÿåªèƒ½æ˜¯let

2. éšå¼è¿”å›ï¼Œå¦‚æœæ•´ä¸ªå‡½æ•°ä½“æ˜¯ä¸€ä¸ªå•ä¸€è¡¨è¾¾å¼,é‚£ä¹ˆå‡½æ•°ä¼šéšå¼è¿”å›æ•´ä¸ªè¡¨è¾¾å¼

   ```swift
   func sum(v1: Int, v2: Int) -> Int {
     v1+v2 // ä¸ç”¨å†™return,éšå¼è¿”å›
   }
   // è¿”å›å…ƒç»„ï¼Œå®ç°è¿”å›å¤šè¿”å›å€¼
   func calculate(v1: Int, v2:Int) -> (sum:Int,difference:Int,average:Int) {
     let sum = v1+v2;
     return (sum,v1-v2,sum>>1)
   }
   let result = calculate(v1:20,v2:10)
   result.sum
   result.difference
   result.average
   ```

3. å‡½æ•°çš„æ–‡æ¡£æ³¨é‡Š(é¼ æ ‡åœ¨æ–¹æ³•ä¸ŠæŒ‰ä½optionæ—¢å¯å‡ºç°)[æ›´å¤šè¯­æ³•è§„èŒƒ](https://swift.org/documentation/api-design-guidelines/)

   ```swift
   /// æ±‚å’Œ[æ¦‚è¿°]
   ///
   /// å°†2ä¸ªæ•´æ•°ç›¸åŠ [æ›´è¯¦ç»†çš„æè¿°]
   ///
   /// - Parameter v1: ç¬¬ä¸€ä¸ªæ•´æ•°
   /// - Parameter v2: ç¬¬äºŒä¸ªæ•´æ•°
   /// - Returns : 2ä¸ªæ•´æ•°çš„å’Œ
   ///
   /// - Note:ä¼ å…¥2ä¸ªæ•´æ•°æ—¢å¯[æ‰¹æ³¨]
   ///
   func sum(v1: Int, v2: Int) -> Int {
     v1+v2 
   }
   ```

4. å‚æ•°æ ‡ç­¾ã€é»˜è®¤å‚æ•°å€¼

   ```swift
   // å‚æ•°æ ‡ç­¾
   func goToWork(at time: String) {
     print("this time is \(time)")
   }
   goToWork(at: "08:00")
    
   // é»˜è®¤å‚æ•°å€¼,c++ä¹Ÿå¯ä»¥è®¾ç½®é»˜è®¤å€¼ï¼Œåªæ˜¯c++é»˜è®¤å‚æ•°å€¼å¿…é¡»åœ¨æœ€å³è¾¹ï¼Œswiftå› ä¸ºæœ‰å‚æ•°æ ‡ç­¾ä¸é™åˆ¶ï¼Œæ‰€ä»¥çœç•¥äº†å‚æ•°æ ‡ç­¾ï¼Œc++çš„é—®é¢˜å°±éœ€è¦ç‰¹åˆ«æ³¨æ„
   // å› ä¸ºc++è°ƒç”¨å‡½æ•°å‚æ•°æ˜¯å¯¹å·å…¥åº§çš„ï¼Œ
   func check(name: String = "nobody", age: Int, job:String="none"){
     print("name=\(name),age=\(age),job=\(job)")
   }
   check(name:"Rose",age:18)
    
   // å¦‚æœåªæƒ³ç»™middleèµ‹å€¼ï¼Œè¿™é‡Œçš„middleä¸å¯ä»¥çœç•¥æ ‡ç­¾
   func test(_ first: Int = 10, middle: Int, _ last: Int = 30) {
       print("first=\(first),middle=\(middle),last=\(last)")
   }
   test(middle: 20)
   ```

5. å¯å˜å‚æ•°

   + ä¸€ä¸ªå‡½æ•°æœ€å¤šåªèƒ½æœ‰1ä¸ªå¯å˜å‚æ•°
   + ç´§è·Ÿåœ¨å¯å˜å‚æ•°åé¢çš„å‚æ•°ä¸èƒ½çœç•¥å‚æ•°æ ‡ç­¾

   ```swift
   // ä¸€ä¸ªå‡½æ•°æœ€å¤šåªèƒ½æœ‰1ä¸ªå¯å˜å‚æ•°
   // ç´§è·Ÿåœ¨å¯å˜å‚æ•°åé¢çš„å‚æ•°ä¸èƒ½çœç•¥å‚æ•°æ ‡ç­¾
   func sum(_ numbers: Int...) -> Int {
     var total = 0
     for number in numbers {
       total += number
     }
     return total
   }
   sum(10,20,30,40)
   ```

## printå‡½æ•°

```swift
// public func print(_ items:Any...,separator:String=" ",terminator:String="\n") æ¥æ”¶å¤šä¸ªå‚æ•°ï¼Œè¿™äº›å‚æ•°é»˜è®¤ä»¥" "è¿æ¥ï¼Œç»“æœæ˜¯\n
print("1","2","3") //1 2 3\n
print("1","2","3",separator:"_",terminator:"")//1_2_3
```

##è¾“å…¥è¾“å‡ºå‡½æ•°(In-Out Parameter)

1. å¯ä»¥ç”¨inoutå®šä¹‰ä¸€ä¸ªè¾“å…¥è¾“å‡ºå‚æ•°: å¯ä»¥åœ¨å‡½æ•°å†…éƒ¨ä¿®æ”¹å¤–éƒ¨å®å‚çš„å€¼
2. å¯å˜å‚æ•°ä¸èƒ½æ ‡è®°ä¸ºinout
3. inoutå‚æ•°ä¸èƒ½æœ‰é»˜è®¤å€¼
4. inoutå‚æ•°çš„æœ¬è´¨æ˜¯åœ°å€ä¼ é€’(å¼•ç”¨ä¼ é€’)
   1. å¦‚æœä¼ é€’ç»™inout
5. inoutåªæ¥å—å¯ä»¥è¢«å¤šæ¬¡èµ‹å€¼çš„

```swift
var number = 10
func add(_ num: inout Int) {
   num = 20
}
add(&number) // numberä¸èƒ½æ˜¯letï¼Œä¸èƒ½è¢«å¤šæ¬¡èµ‹å€¼
print(number) // 20ï¼Œ
```

### æ±‡ç¼–éƒ¨åˆ†

1. callq åé¢è·Ÿç€å‡½æ•°åœ°å€ã€leaqç”¨äºåšåœ°å€ä¼ é€’ç”¨
2. %å¼€å¤´çš„æ˜¯å¯„å­˜å™¨,  
3. leaq   0x10da(%rip),%rdi  // (å°†0x10da+ripåœ°å€çš„å’Œèµ‹å€¼ç»™rdi,æ‰€ä»¥rdiå­˜å‚¨çš„æ˜¯åœ°å€å€¼)
   1. ripå­˜å‚¨çš„æ˜¯æŒ‡ä»¤çš„åœ°å€ï¼Œå­˜çš„å†…å®¹æ˜¯ä¸‹ä¸€ä¸ªæ±‡ç¼–æŒ‡ä»¤çš„å‰é¢æ ‡è®°çš„åœ°å€
   2. CPUè¦æ‰§è¡Œçš„ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€å°±å­˜å‚¨åœ¨ripä¸­
4. movq  &0x14,(%rdi)  //ï¼ˆå°†16è¿›åˆ¶çš„14èµ‹å€¼ç»™rdiæ‰€å­˜å‚¨åœ°å€æ‰€åœ¨çš„ç©ºé—´,()æ‰¾åˆ°åœ°å€æŒ‡å‘çš„ç©ºé—´ï¼‰
5. movq  -ox30(%rbp),%rdi  //å°†rbp-0x30çš„åœ°å€æ‰€åœ¨ç©ºé—´çš„å€¼èµ‹å€¼ç»™%rdi

###inoutçš„æœ¬è´¨

1. inoutæœ¬è´¨è¿˜æ˜¯å¼•ç”¨ä¼ é€’ï¼Œä¼ é€’çš„æ˜¯åœ°å€å€¼ï¼Œåªæ˜¯æ˜¯è°çš„åœ°å€å€¼è¦çœ‹æƒ…å†µ
2. ç»“æ„ä½“çš„åœ°å€å€¼å°±æ˜¯å®ƒç¬¬ä¸€ä¸ªå±æ€§çš„åœ°å€å€¼

```swift
struct Shape {
    var width: Int
    var side: Int {
    
        willSet {
            print("willSet",newValue)
        }
        didSet {
            print("didSet",oldValue,side)
        }
    }
    var girth: Int {
        set {
            width = newValue / side
            print("setGirth",newValue)
        }
        get {
            print("getGirth")
            return width * side
        }
    }
    func show() {
        print("width=\(width), side=\(side), girth = \(girth)")
    }
}

func test(_ num: inout Int) {
    
    num = 20
}
var s = Shape(width:10, side:4)
test(&s.width) 
s.show() // getGirth    width=20, side=4, girth = 80
// ä¸»è¦æ±‡ç¼–
/*
    0x10000103c <+108>: leaq   0x71b5(%rip), %rdi        ; SwiftTest.s : SwiftTest.Shape
    0x100001043 <+115>: callq  0x100001d90               ; SwiftTest.test(inout Swift.Int) -> () at main.swift:41
*/
/*
     0x71b5(%rip)æ˜¯ä¸€ä¸ªå…¨å±€åœ°å€ï¼Œä»æ³¨é‡Šå¯çœ‹å‡ºæ˜¯sï¼Œå°†sè¿™ä¸ªåœ°å€å€¼ä½œä¸ºå‚æ•°ä¼ é€’ç»™äº†testå‡½æ•°ï¼Œ(å› ä¸ºç»“æ„ä½“çš„åœ°å€å€¼å°±æ˜¯å®ƒç¬¬ä¸€ä¸ªå±æ€§çš„åœ°å€å€¼) 
*/


print("-------------")
test(&s.side)
s.show()  // willSet 20      didSet 4 20      getGirth     width=20, side=20, girth = 400
// ä¸»è¦æ±‡ç¼–
/*
   0x10000131d <+93>:  movq   0x6edc(%rip), %rax        ; SwiftTest.s : SwiftTest.Shape + 8
    0x100001324 <+100>: movq   %rax, -0x28(%rbp)
    0x100001328 <+104>: leaq   -0x28(%rbp), %rdi
   0x10000132c <+108>: callq  0x100001d90               ; SwiftTest.test(inout Swift.Int) -> () at main.swift:41
    0x100001331 <+113>: movq   -0x28(%rbp), %rdi
    0x100001335 <+117>: leaq   0x6ebc(%rip), %r13        ; SwiftTest.s : SwiftTest.Shape
    0x10000133c <+124>: callq  0x100001430               ; SwiftTest.Shape.side.setter : Swift.Int at main.swift:14
*/
/*
     å…ˆè°ƒç”¨äº†testï¼Œå†è°ƒç”¨äº†setteræ–¹æ³•
     movq   0x6edc(%rip), %raxï¼š å°†æŸä¸ªå…¨å±€å˜é‡çš„å†…å®¹èµ‹å€¼ç»™raxï¼Œä»åé¢æ³¨é‡Šå¯çœ‹åˆ°è¿™ä¸ªå…¨å±€å˜é‡æ˜¯s+8å³sçš„ç¬¬äºŒä¸ªæˆå‘˜sideï¼Œè¿™å¥æ„æ€æ˜¯å°†sideé‡Œçš„å†…å®¹èµ‹å€¼ç»™raxï¼Œ
     movq   %rax, -0x28(%rbp): raxåˆèµ‹å€¼ç»™äº†ä¸€ä¸ªå±€éƒ¨å˜é‡
     leaq   -0x28(%rbp), %rdiï¼š å°†å±€éƒ¨å˜é‡çš„åœ°å€å€¼èµ‹å€¼ç»™rdi
     è°ƒç”¨testä¿®æ”¹å€¼ï¼Œæ”¹å®Œåå°†è¿™ä¸ªå±€éƒ¨å˜é‡åœ°å€çš„å†…å®¹èµ‹å€¼ç»™rdi
     rdiåˆä½œä¸ºå‡½æ•°å‚æ•°ç»™äº†setterï¼Œ
*/
// setterä¸»è¦æ±‡ç¼–
/*
    0x100001459 <+41>: movq   %rdi, -0x20(%rbp)
    0x10000145d <+45>: movq   %r13, -0x28(%rbp)
    0x100001461 <+49>: movq   %rax, -0x30(%rbp)
    0x100001465 <+53>: callq  0x100001490               ; SwiftTest.Shape.side.willset : Swift.Int at main.swift:16
    0x10000146a <+58>: movq   -0x28(%rbp), %rax
    0x10000146e <+62>: movq   -0x20(%rbp), %rcx
    0x100001472 <+66>: movq   %rcx, 0x8(%rax)
    0x100001476 <+70>: movq   -0x30(%rbp), %rdi
    0x10000147a <+74>: movq   %rax, %r13
    0x10000147d <+77>: callq  0x1000015b0               ; SwiftTest.Shape.side.didset : Swift.Int at main.swift:19
*/
/*
  setteræ–¹æ³•é‡Œé¢ä¼šè°ƒç”¨willset 
  åœ¨willsetå’Œdidsetä¹‹é—´ä»£ç å°±æ˜¯çœŸæ­£ä¿®æ”¹sideå†…å®¹çš„ä»£ç ï¼Œæ”¹å®Œä¹‹åè°ƒç”¨didSet
  movq   -0x28(%rbp), %raxï¼šæ‰“å°raxä¼šå‘ç°ä»–æ˜¯sçš„åœ°å€å€¼ï¼Œ
  movq   -0x20(%rbp), %rcx:
   movq   %rcx, 0x8(%rax): æ‰“å°rcxä¼šå‘ç°æ˜¯20çš„é‚£ä¸ªå€¼ï¼ŒæŠŠè¿™ä¸ªå€¼å­˜å‚¨è¿›raxçš„ç¬¬äºŒä¸ªæˆå‘˜side
*/
// testå‡½æ•°å†…éƒ¨æ˜¯ä¸å¯èƒ½è°ƒç”¨willsetå’Œdidsetï¼Œæ‰€ä»¥å¼„ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œtestä¿®æ”¹è¿™ä¸ªå±€éƒ¨å˜é‡å†è°ƒç”¨setterçœŸæ­£ä¿®æ”¹sideçš„å€¼ï¼Œèƒ½è§¦å‘willSetå’ŒdidSet


print("-------------")
test(&s.girth)
s.show()  //  getGirth       setGirth 20       getGirth       width=5, side=4, girth = 20
// ä¸»è¦æ±‡ç¼–
/*
      0x100001322 <+258>: callq  0x1000016f0               ; SwiftTest.Shape.girth.getter : Swift.Int at main.swift:30
    0x100001327 <+263>: movq   %rax, -0x28(%rbp)
    0x10000132b <+267>: leaq   -0x28(%rbp), %rdi
    0x10000132f <+271>: callq  0x100001d90               ; SwiftTest.test(inout Swift.Int) -> () at main.swift:41
    0x100001334 <+276>: movq   -0x28(%rbp), %rdi
    0x100001338 <+280>: leaq   0x6eb9(%rip), %r13        ; SwiftTest.s : SwiftTest.Shape
    0x10000133f <+287>: callq  0x100001840               ; SwiftTest.Shape.girth.setter : Swift.Int at main.swift:26
*/
/*
  ç”±äºs.girthæ˜¯è®¡ç®—å±æ€§ï¼Œæ²¡æœ‰è‡ªå·±çš„å†…å­˜åœ°å€
  ä»æ±‡ç¼–çœ‹å…ˆè°ƒç”¨äº†girth.getteræ–¹æ³•ï¼Œç„¶åè°ƒç”¨äº†testï¼Œæ‰å®Œtestå†è°ƒç”¨äº†girth.setter
  å…ˆè°ƒç”¨setteræ–¹æ³•ï¼Œæ–¹æ³•çš„è¿”å›å€¼éƒ½å­˜æ”¾åœ¨raxä¸Šï¼Œraxåˆèµ‹å€¼ç»™ -0x28(%rbp)ï¼Œ-0x28(%rbp)æ˜¯å‡½æ•°çš„æ ˆç©ºé—´ï¼Œå‡½æ•°çš„æ ˆç©ºé—´è¿”å›æ—¶rbp--rspä¹‹é—´ï¼Œæ‰€ä»¥æ˜¯å½“å‰çš„å‡½æ•°çš„æ ˆç©ºé—´(mainå‡½æ•°çš„ä¸€ä¸ªæ ˆç©ºé—´å³mainå‡½æ•°çš„ä¸€ä¸ªå±€éƒ¨å˜é‡) 
  leaq   -0x28(%rbp), %rdi ï¼š å°†å±€éƒ¨å˜é‡çš„åœ°å€å€¼ç»™rdiï¼Œè¯´æ˜å°†å±€éƒ¨å˜é‡çš„åœ°å€å€¼ç»™äº†testï¼Œtestæ–¹æ³•é‡Œé¢ä¼šé€šè¿‡åœ°å€å€¼ä¿®æ”¹å†…å®¹
  è°ƒç”¨å®Œteståï¼Œçœ‹åˆ°æ±‡ç¼– movq   -0x28(%rbp), %rdiï¼š å°†å±€éƒ¨å˜é‡é‡Œå­˜å‚¨çš„å†…å®¹ç»™rdiï¼Œæ³¨æ„movå’Œleaçš„åŒºåˆ«
  è¿™ä¸ªrdiåˆä¼ ç»™äº†setteræ–¹æ³•

  è°ƒç”¨getterå¾—åˆ°è¿”å›å€¼ï¼Œå°†è¿”å›å€¼æ”¾åœ¨ä¸€ä¸ªä¸´æ—¶çš„ç©ºé—´ï¼Œè°ƒç”¨testä¼ é€’çš„åœ°å€å€¼å°±æ˜¯è¿™ä¸ªä¸´æ—¶çš„ç©ºé—´ï¼Œè°ƒç”¨å®Œåä¸´æ—¶çš„ç©ºé—´å°±è¢«æ›´æ”¹ä¸ºæ–°çš„å€¼ï¼Œæ”¹å®Œæ–°å€¼åä¼šè°ƒç”¨è®¡ç®—å±æ€§girthçš„setæ–¹æ³•ï¼Œæ–°çš„å€¼ä½œä¸ºnewValueä¼ é€’
*/
```

####æ€»ç»“

1. å¦‚æœå®å‚æœ‰ç‰©ç†å†…å­˜åœ°å€ï¼Œä¸”æ²¡æœ‰è®¾ç½®å±æ€§è§‚å¯Ÿå™¨
   1. ç›´æ¥å°†å®æƒ¨çš„å†…å­˜åœ°å€ä¼ å…¥å‡½æ•°(å®æƒ¨è¿›è¡Œå¼•ç”¨ä¼ é€’)
2. å¦‚æœå®å‚æ˜¯è®¡ç®—å±æ€§æˆ–è€…è®¾ç½®äº†å±æ€§è§‚å¯Ÿå™¨
   1. é‡‡å–äº†Copy In Copy Outçš„åšæ³•
   2. è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œå…ˆå¤åˆ¶å®å‚çš„å€¼ï¼Œäº§ç”Ÿå‰¯æœ¬[get]
   3. å°†å‰¯æœ¬çš„å†…å­˜åœ°å€ä¼ å…¥å‡½æ•°(å‰¯æœ¬è¿›è¡Œå¼•ç”¨ä¼ é€’),åœ¨å‡½æ•°å†…éƒ¨å¯ä»¥ä¿®æ”¹å‰¯æœ¬çš„å€¼
   4. å‡½æ•°è¿”å›åï¼Œå†å°†å‰¯æœ¬çš„å€¼è¦†ç›–å®å‚çš„å€¼[set]

##å‡½æ•°é‡è½½

+ è§„åˆ™

  1. å‡½æ•°åç›¸åŒ
  2. å‚æ•°ä¸ªæ•°ä¸åŒ||å‚æ•°ç±»å‹ä¸åŒ||å‚æ•°æ ‡ç­¾ä¸åŒ

+ è¿”å›å€¼ç±»å‹æœ‰æ— ä¸åŒä¸æ„æˆå‡½æ•°é‡è½½

+ é»˜è®¤å‚æ•°å€¼å’Œå‡½æ•°é‡è½½ä¸€èµ·ä½¿ç”¨äº§ç”ŸäºŒä¹‰è¡Œæ—¶ï¼Œç¼–è¯‘å™¨å¹¶ä¸ä¼šæŠ¥é”™(åœ¨c++ä¸­ä¼šæŠ¥é”™)

+ å¯å˜å‚æ•°ã€çœç•¥å‚æ•°æ ‡ç­¾ã€å‡½æ•°é‡è½½ä¸€èµ·ä½¿ç”¨äº§ç”ŸäºŒä¹‰æ€§æ—¶ï¼Œç¼–è¯‘å™¨æœ‰å¯èƒ½æŠ¥é”™

  ```swift
  // è¿™æ®µæ”¾å¼€å°±ä¼šæŠ¥é”™
  //func sum(v1:Int, v2:Double) -> Int {
  //    v1+Int(v2)+1
  //}
  func sum(_ v1:Int, _ v2:Int) -> Int {
    v1+v2
  }
  //func sum(v1:Int,v2:Int,v3:Int=30) -> Int {
  //  v1+v2+v3
  //}
  func sum(_ v1:Int,_ v2:Int,_ v3:Int=30) -> Int {
    v1+v2+v3
  }
  
  func sum(_ v1:Int...) -> Int {
      v1.first ?? 0
  }
   
  print(sum(10,20)) // 30
  ```

## å†…è”å‡½æ•°

1. å¦‚æœå¼€å¯äº†ç¼–è¯‘å™¨ä¼˜åŒ–(Releaseæ¨¡å¼é»˜è®¤ä¼šå¼€å¯ä¼˜åŒ–),ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å°†æŸäº›å‡½æ•°å˜æˆå†…è”å‡½æ•°
   1. Build Settings ä¸‹æœç´¢optimizationä¼šçœ‹åˆ°Swift Complierï¼Œ 
2. å†…è”å°±æ˜¯å°†å‡½æ•°è°ƒç”¨å±•å¼€æˆå‡½æ•°ä½“,(å³è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œæ˜¯å°†æ•´ä¸ªå‡½æ•°ä½“çš„ä»£ç æ‹¿å‡ºæ¥æ‰§è¡Œï¼Œå‡å°‘äº†å‡½æ•°è°ƒç”¨å¼€é”€ï¼Œ)
3. å“ªäº›å‡½æ•°ä¸ä¼šå†…è”
   1. å‡½æ•°ä½“æ¯”è¾ƒé•¿
   2. é€’å½’è°ƒç”¨
   3. åŒ…å«åŠ¨æ€æ´¾å‘
   4. ...
4. @inline
   1. åœ¨Releaseæ¨¡å¼ä¸‹ï¼Œç¼–è¯‘å™¨å·²ç»å¼€å¯ä¼˜åŒ–ï¼Œä¼šè‡ªåŠ¨å†³å®šå“ªäº›å‡½æ•°éœ€è¦å†…è”ï¼Œå› æ­¤æ²¡å¿…è¦ä½¿ç”¨@inline

```swift
// æ°¸è¿œä¸ä¼šè¢«å†…è”(å³ä½¿å¼€å¯è”ç¼–è¯‘å™¨ä¼˜åŒ–)
@inline(never) func test() {
   print("test")
}
// å¼€å¯è”ç¼–è¯‘å™¨ä¼˜åŒ–åï¼Œå³ä½¿ä»£ç å¾ˆé•¿ï¼Œä¹Ÿä¼šè¢«å†…è”(é€’å½’è°ƒç”¨å‡½æ•°ã€åŠ¨æ€æ´¾å‘çš„å‡½æ•°é™¤å¤–)
@inline(__always) func test(){
  print("test")
}
```

## å‡½æ•°ç±»å‹

1. æ¯ä¸€ä¸ªå‡½æ•°éƒ½æ˜¯æœ‰ç±»å‹çš„ï¼Œå‡½æ•°ç±»å‹ç”±å½¢å¼å‚æ•°ç±»å‹ã€è¿”å›å€¼ç±»å‹ç»„æˆ

   ```swift
   func test() {}  // () -> Void æˆ–è€… () -> ()
   func sum(a:Int,b:Int) -> Int {
     a+b
   } // (Int,Int) -> Int
   // å®šä¹‰å˜é‡
   var fn:(Int,Int) -> Int = sum  // å°†å‡½æ•°ç±»å‹èµ‹å€¼ç»™å˜é‡
   fn(2,3) // è°ƒç”¨æ—¶ä¸éœ€è¦å‚æ•°æ ‡ç­¾
   ```

2. å‡½æ•°ç±»å‹ä½œä¸ºå‡½æ•°å‚æ•°

   ```swift
   func sum(a:Int,b:Int) -> Int {
     a+b
   }
   func difference(a:Int,b:Int) -> Int {
     a-b
   } 
   func printResult(_ mathFn:(Int,Int)->Int,_ a:Int,_ b:Int) {
     print("Result:\(mathFn(a,b))")
   }
   printResult(sum,5,2) // Result:7
   printResult(difference,5,2) // Result:3
   ```

3. å‡½æ•°ç±»å‹ä½œä¸ºè¿”å›å€¼ï¼Œè¿”å›å€¼æ˜¯å‡½æ•°ç±»å‹çš„å‡½æ•°ï¼Œå«åšé«˜é˜¶å‡½æ•°

## typealias

1. ç”¨æ¥ç»™ç±»å‹èµ·åˆ«å

   ```swift
   typealias Byte = Int8
   typealias Date = (year:Int,month:Int,day:Int)
   typealias IntFn = (Int,Int)->Int
   ```

2. æŒ‰ç…§Swiftæ ‡å‡†åº“çš„å®šä¹‰ï¼ŒVoidå…¶å®å°±æ˜¯ç©ºå…ƒç¥–

   ```swift
   typealias Void = ()
   ```

## åµŒå¥—å‡½æ•°

1. å°†å‡½æ•°å®šä¹‰åœ¨å‡½æ•°å†…éƒ¨

# æšä¸¾

```swift
enum Direction {
   case north
   case south
   case east
}
var dir = Direction.north
dir = .south
```

## å…³è”å€¼

æœ‰æ—¶ä¼šå°†æšä¸¾çš„æˆå‘˜å€¼è·Ÿå…¶ä»–ç±»å‹çš„å…³è”å­˜å‚¨åœ¨ä¸€èµ·ï¼Œä¼šéå¸¸æœ‰ç”¨

```swift
enum Score {
  case point(Int)
  case grade(Character)
  case digit(year:Int,month:Int,day:Int)
}
var score = Score.point(96)
score = .grade("A")
 
 
switch score {
  case let .point(i):
      print(i,"points")
  case let .grade(i):
      print("grade",i)
  case .digit(let year,let month,let day):
      print("let å†™å‰é¢è¡¨ç¤ºyearã€monthã€dayéƒ½æ˜¯letï¼Œä¹Ÿå¯ä»¥åˆ†å¼€å†™")
}
```

## åŸå§‹å€¼

1. æšä¸¾æˆå‘˜å¯ä»¥ä½¿ç”¨ç›¸åŒç±»å‹çš„é»˜è®¤å€¼é¢„å…ˆå…³è”ï¼Œè¿™ä¸ªé»˜è®¤å€¼å«åšåŸå§‹å€¼
2. å¦‚æœæšä¸¾çš„åŸå§‹å€¼ç±»å‹æ˜¯Int(0\1\2é€’å¢)ã€String(å³æ˜¯caseçš„å€¼æ¯”å¦‚notrh=â€œnorthâ€),Swiftä¼šè‡ªåŠ¨åˆ†é…åŸå§‹å€¼
3. åŸå§‹å€¼æ˜¯ä»€ä¹ˆå¹¶ä¸ä¼šå½±å“è¿™ä¸ªæšä¸¾çš„å¤§å°

```swift
enum Grade: String {
  case perfect = "A"
  case great = "B"
  case good = "C"
}
```

## é€’å½’æšä¸¾

æšä¸¾é‡Œçš„ä¸€ä¸ªcaseå…³è”æšä¸¾ï¼Œéœ€è¦åŠ ä¸Šindirectä¿®é¥°

```swift
indirect enum ArithExpr {
  case number(Int)
  case sum(ArithExpr,ArithExpr)
}
```

## memoryLayout

è·å–ç±»å‹å ç”¨çš„å†…å­˜å¤§å°

```swift
// å…³è”å€¼ã€åŸå§‹å€¼çš„åŒºåˆ«
// å¦‚æœæ˜¯å…³è”å€¼ï¼Œæ˜¯å°†å†…å®¹ç›´æ¥å­˜å‚¨è¿›å†…å­˜é‡Œ
// å¦‚æœæ˜¯åŸå§‹å€¼ï¼Œå€¼æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥ä¸ç®¡ä»€ä¹ˆç±»å‹ï¼Œéƒ½åªæ˜¯å°†æ¯ä¸ªå€¼æ ‡ä¸ªåºå·(åªå ä¸€ä¸ªå­—èŠ‚)ï¼Œè°ƒç”¨x.rawValueæ‰ä¼šçœŸæ­£æ‹¿åˆ°é»˜è®¤å€¼
//memoryLayout.size      // å®é™…ç”¨åˆ°çš„ç©ºé—´å¤§å°
//memoryLayout.stride    // åˆ†é…å ç”¨çš„ç©ºé—´å¤§å°
//memoryLayout.alignment // å¯¹é½å‚æ•°
 
enum Password {
   case number(Int,Int,Int,Int) // 32
   case other  // 1
}
var pwd = Password.number(5,6,7,8)
pwd = .other
 
print(MemoryLayout<Password>.size) // 33
print(MemoryLayout<Password>.stride)    // 40
print(MemoryLayout<Password>.alignment)  // 8
 
 
enum Season : String {
   case spring = "spring",sumer = "sumer",autumn = "autumn",winter = "winter"
}
var s = Season.spring
 
print(MemoryLayout<Season>.size)       // 1
print(MemoryLayout<Season>.stride)     // 1
print(MemoryLayout<Season>.alignment)  // 1
```

# å¯é€‰é¡¹(Optional)

1. å¯é€‰ç±»å‹å…è®¸å°†å€¼è®¾ç½®ä¸ºnil
2. åœ¨ç±»å‹åç§°åé¢åŠ ä¸ªé—®å¥½?æ¥å®šä¹‰ä¸€ä¸ªå¯é€‰é¡¹
3. é€šè¿‡å­—å…¸æ‹¿åˆ°çš„å€¼æ˜¯å¯é€‰é¡¹ï¼Œé€šè¿‡æ•°ç»„æ‹¿åˆ°çš„å°±æ˜¯å€¼ï¼Œæ•°ç»„è¶Šç•Œä¼šå´©æºƒ

```swift
var age: Int   // æ²¡æœ‰åˆå§‹å€¼
var kage: Int?  // é»˜è®¤ä¸ºnil
 
 
// å¼ºåˆ¶è§£åŒ…
var num = Int("123")
if num != nil {
   print("è½¬æ¢æˆåŠŸ:\(num!)")
} else {
   print("è½¬æ¢å¤±è´¥")
}
 
 
// å¯é€‰é¡¹ç»‘å®š
if let number = Int("123") { // number ä½œç”¨åŸŸåªåœ¨è¿™ä¸ªå¤§é˜”å·é‡Œ
   print("è½¬æ¢æˆåŠŸ:\(number)")
} else {
   print("è½¬æ¢å¤±è´¥")
}
 
 
// åŒæ—¶æˆç«‹åˆ¤æ–­,ç›¸å½“äºfirstæœ‰å€¼è§£åŒ…æˆåŠŸ&&secondæœ‰å€¼è§£åŒ…æˆåŠŸ&&first < second // && second < 100çš„è¯æ‰“å°...  å¯¹äºå¯é€‰é¡¹ç»‘å®šçš„å¹¶ä¸”ç”¨ï¼Œä¸èƒ½ç”¨&&
if let first = Int("4"),
   if second = Int("42"),
   first < second && second < 100 {
   print("\(second) < \(second) < 100")
}
 
 
// whileå¾ªç¯ä¸­ä½¿ç”¨å¯é€‰é¡¹ç»‘å®š
// éå†æ•°ç»„,å°†é‡åˆ°çš„æ­£æ•°éƒ½åŠ èµ·æ¥ï¼Œå¦‚æœé‡åˆ°è´Ÿæ•°æˆ–è€…éæ•°å­—ï¼Œåœæ­¢éå†
var strs = ["10","20","abc","-20","30"]
var index = 0
var sum = 0
while let num = Int(strs[index]),num>0 {  // å¹¶ä¸”
   sum += num
   index += 1
}
 
 
// ?? ä¸ if leté…åˆä½¿ç”¨
let a: Int? = nil
let b: Int? = 2
if let c = a ?? b { // ç±»ä¼¼äº if a!=nil||b!=nil
   print(c)
}
```

##å¼ºåˆ¶è§£åŒ…

1. å¯é€‰é¡¹æ˜¯å¯¹å…¶ä»–ç±»å‹çš„ä¸€å±‚åŒ…è£…ï¼Œå¯ä»¥å°†å®ƒç†è§£ä¸ºä¸€ä¸ªç›’å­
2. å¦‚æœä¸ºnilï¼Œé‚£ä¹ˆæ˜¯ä¸ªç©ºç›’å­
3. å¦‚æœä¸ä¸ºnilï¼Œé‚£ä¹ˆç›’å­é‡Œè£…çš„æ˜¯:è¢«åŒ…è£…ç±»å‹çš„æ•°æ®
4. å¦‚æœè¦ä»å¯é€‰é¡¹ä¸­å–å‡ºè¢«åŒ…è£…çš„æ•°æ®(å°†ç›’å­é‡Œè£…çš„ä¸œè¥¿å–å‡ºæ¥),éœ€è¦ä½¿ç”¨æ„Ÿå¹å·!è¿›è¡Œå¼ºåˆ¶è§£åŒ…
5. å¦‚æœå¯¹å€¼ä¸ºnilçš„å¯é€‰é¡¹(ç©ºç›’å­)è¿›è¡Œå¼ºåˆ¶è§£åŒ…ï¼Œå°†ä¼šäº§ç”Ÿè¿è¡Œæ—¶é”™è¯¯

##å¯é€‰é¡¹ç»‘å®š

1. å¯ä»¥ä½¿ç”¨å¯é€‰é¡¹ç»‘å®šæ¥åˆ¤æ–­å¯é€‰é¡¹æ˜¯å¦åŒ…å«å€¼
2. å¦‚æœåŒ…å«å€¼å°±è‡ªåŠ¨è§£åŒ…ï¼ŒæŠŠå€¼èµ‹ç»™ä¸€ä¸ªä¸´æ—¶çš„å¸¸é‡(let)æˆ–è€…å˜é‡(var),å¹¶è¿”å›true,å¦åˆ™è¿”å›false
3. å¯é€‰é¡¹ç»‘å®šçš„"å¹¶ä¸”"ç”¨','è¡¨ç¤ºï¼Œä¸èƒ½ç”¨'&&'

##ç©ºåˆå¹¶è¿ç®—ç¬¦??

1. a??b  // å¦‚æœaä¸ä¸ºnilï¼Œè¿”å›aï¼Œå¦‚æœaä¸ºnilï¼Œè¿”å›b
2. a æ˜¯å¯é€‰é¡¹ï¼Œbå¯ä»¥æ˜¯å¯é€‰é¡¹ä¹Ÿå¯ä»¥ä¸æ˜¯å¯é€‰é¡¹ï¼Œaè·Ÿbçš„å­˜å‚¨ç±»å‹å¿…é¡»ç›¸åŒ
3. å¦‚æœbä¸æ˜¯å¯é€‰é¡¹ï¼Œè¿”å›aæ—¶ä¼šè‡ªåŠ¨è§£åŒ…

## guard

1. å½“guardæ¡ä»¶ä¸ºfalseæ—¶ï¼Œå°±ä¼šæ‰§è¡Œå¤§æ‹¬å·é‡Œçš„ä»£ç 
2. å½“guardæ¡ä»¶ä¸ºtrueæ—¶ï¼Œå°±ä¼šè·³è¿‡guardè¯­å¥
3. å½“ä½¿ç”¨guardè¯­å¥è¿›è¡Œå¯é€‰é¡¹ç»‘å®šæ—¶ï¼Œç»‘å®šçš„å¸¸é‡(let)ã€å˜é‡(var)ä¹Ÿèƒ½åœ¨å¤–å±‚ä½œç”¨åŸŸä¸­ä½¿ç”¨

```swift
guard æ¡ä»¶ else {
    
   é€€å‡ºå½“å‰ä½œç”¨åŸŸ// returnã€breakã€continueã€throwã€error
}
 
 
// ä½¿ç”¨
func login(_ info:[String:String]) {
   guard let username = info["username"] else {
      print("è¯·è¾“å…¥ç”¨æˆ·å")
      return
   }
   guard let password = info["password"] else {
      print("è¯·è¾“å…¥å¯†ç ")
      return
   }
   // è¿›è¡Œç™»å½•
   print("ç”¨æˆ·å:\(username)","å¯†ç :\(password)","ç™»é™†ing")
}
```

## éšå¼è§£åŒ…

1. åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯é€‰é¡¹ä¸€æ—¦è¢«è®¾å®šå€¼ä¹‹åï¼Œå°±ä¼šä¸€ç›´æ‹¥æœ‰å€¼
2. åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å»æ‰æ£€æŸ¥ï¼Œä¹Ÿä¸å¿…æ¯æ¬¡è®¿é—®çš„æ—¶å€™éƒ½è¿›è¡Œè§£åŒ…ï¼Œå› ä¸ºå®ƒèƒ½ç¡®å®šæ¯æ¬¡è®¿é—®çš„æ—¶å€™éƒ½æœ‰å€¼
3. å¯ä»¥åœ¨ç±»å‹åé¢åŠ ä¸ªæ„Ÿå¹å·ï¼å®šä¹‰ä¸€ä¸ªéšå¼è§£åŒ…çš„å¯é€‰é¡¹

```swift
let num1: Int! = 10  // è™½ç„¶æ˜¯ç›’å­ï¼Œä½†æ˜¯æ˜¯ï¼ï¼Œæ‰€ä»¥ä¼šè‡ªåŠ¨è§£åŒ…
let num2: Int = num1 // éšå¼è§£åŒ…äº† Intç±»å‹
let num3 = num1  // Int? ç±»å‹

let num4: Int? = 10  // è™½ç„¶æ˜¯ç›’å­ï¼Œä½†æ˜¯æ˜¯ï¼ï¼Œæ‰€ä»¥ä¼šè‡ªåŠ¨è§£åŒ…
let num5: Int = num4  // ä¼šæŠ¥é”™
```

##å¯é€‰é¡¹çš„å­—ç¬¦ä¸²æ’å€¼

å¯é€‰é¡¹åœ¨å­—ç¬¦ä¸²æ’å€¼æˆ–è€…ç›´æ¥æ‰“å°æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå‘å‡ºè­¦å‘Š

```swift
var age: Int? = 10   // 10 æˆ– nil
print("My age is \(age)") // ä¼šæœ‰è­¦å‘Š My age is Optional(10) æˆ– My age is nil
//æ¶ˆé™¤è­¦å‘Šæ–¹æ³•
print("My age is \(age!)") // My age is 10 æˆ– å´©æºƒ
print("My age is \(String(describing: age))")  // My age is Optional(10) æˆ– My age is nil
print("My age is \(age ?? 0)")  // My age is 10 æˆ– My age is 0
```

## å¤šé‡å¯é€‰é¡¹

xcodeå‘½ä»¤è¡Œè¾“å…¥: fr v -R x (å¯ä»¥çœ‹åˆ°å¯¹è±¡çš„ç»„æˆç»“æ„)

```swift
var num11: Int? = 10
/* num1 = some { 
 *  some = {
 *    _value = 10
 *  }
 * }
*/
var num22: Int?? = num1
var num33: Int?? = 10
print(num22 == num33) // true
 
 
var num1: Int? = nil
/* num1 = none {  // ä¸ºnoneçš„æ—¶å€™é‡Œé¢çš„å†…å®¹æ— æ„ä¹‰
 *  some = {
 *    _value = 0
 *  }
 * }
*/
var num2: Int?? = num1
/* num2 = some {
    some = none { 
 *    some = {
 *      _value = 0
 *    }
 * }
  }
*/
var num3: Int?? = nil
/* num3 = none {
    some = some { 
 *    some = {
 *      _value = 0
 *    }
 * }
  }
*/
print(num2 == num3) // false é‡ç‚¹  å¦‚æœnum2å’Œnum3å­˜çš„valueéƒ½æ˜¯1ï¼Œé‚£ä¹ˆä¸ºtrueï¼Œå› ä¸ºè‡ªé¡¶å‘ä¸‹éƒ½æ˜¯someã€someã€1
print(num1 == num3) // false ç±»å‹ä¸åŒ
(num2 ?? 1) ?? 2  // 2  é‡ç‚¹ num2ä¸ä¸ºnil
(num3 ?? 1) ?? 2  // 1  é‡ç‚¹ num3ä¸ºnil
```

# æ±‡ç¼–

## çª¥æ¢å†…å­˜

1. æ‰“æ–­ç‚¹â†’View Memory of 'num' æˆ–è€…å·¥å…·æ â†’Debugä¸‹Debug Workflowçš„View Memory
2. æŸ¥çœ‹å†…å­˜åœ°å€çš„å°å·¥å…·: https://github.com/CoderMJLee/Mems ï¼ˆæŠŠMems.Swiftæ‹–å…¥é¡¹ç›®æ—¢å¯ç”¨ï¼‰
3. æŸ¥çœ‹æ™®é€šæšä¸¾ï¼Œå‘ç°æšä¸¾ç”¨äº†ä¸€ä¸ªå­—èŠ‚æ¥å­˜å‚¨ï¼Œå­˜å‚¨0ã€1ã€2ã€ã€ã€ã€ã€
4. å¯¹äºå…³è”å€¼ï¼Œä¸€ä¸ªå­—èŠ‚å­˜å‚¨æˆå‘˜å€¼ï¼ŒNä¸ªå­—èŠ‚å­˜å‚¨å…³è”å€¼(Nå–å ç”¨å†…å­˜æœ€å¤§çš„å…³è”å€¼)

```swift
// å¯ä»¥çœ‹åˆ°ç”¨å‰é¢24ä¸ªå­—èŠ‚å­˜å‚¨å†…å®¹å€¼
// ç¬¬25ä¸ªå­—èŠ‚ç”¨æ¥è¡¨ç¤ºæ˜¯å“ªä¸€ä¸ªæšä¸¾
enum TestEnum {
  case test1(Int,Int,Int) // 24
  case test2(Int,Int)
  case test3(Int)
  case test4(Bool)
  case test5
}

var e = TestEnum.test1(1,2,3)
// å°ç«¯: é«˜é«˜ä½ä½
// 01 00 00 00 00 00 00 00
// 02 00 00 00 00 00 00 00
// 03 00 00 00 00 00 00 00
// 00
// 00 00 00 00 00 00 00
print(Mems.ptr(ofVal:&e)) // æ‰“å°åœ°å€ï¼Œå†é€šè¿‡View Memory of 'num'æˆ–è€…æ§åˆ¶å°x/20 0x0000000100008228æŸ¥çœ‹è¯¥åœ°å€ä¸‹å­˜å‚¨çš„å†…å®¹
e = .test2(4,5)
// 04 00 00 00 00 00 00 00
// 05 00 00 00 00 00 00 00
// 00 00 00 00 00 00 00 00
// 01
// 00 00 00 00 00 00 00
e = .test3(6)
e = .test4(true)
e = .test5
 
 
MemoryLayout<TestEnum>.size       // 25
MemoryLayout<TestEnum>.stride     // 32
MemoryLayout<TestEnum>.alignment  // 8
 
 
// åªæœ‰ä¸€ä¸ªå€¼çš„æšä¸¾,å¹¶ä¸ä¼šå ç”¨å†…å­˜
enum TestEn {
  case test
}
var t = TestEn.test
MemoryLayout<TestEn>.size       // 0
MemoryLayout<TestEn>.stride     // 1
MemoryLayout<TestEn>.alignment  // 1
// åŒç†åªæœ‰ä¸€ä¸ªå€¼çš„å…³è”æšä¸¾,å¹¶ä¸éœ€è¦é¢å¤–ä¸€ä¸ªå­—èŠ‚æ ‡ç¤ºæ˜¯å“ªä¸ªæšä¸¾
enum TestE {
  case test(Int)
}
var te = TestE.test
MemoryLayout<TestE>.size       // 8
MemoryLayout<TestE>.stride     // 8
MemoryLayout<TestE>.alignment  // 8
```

## ç¨‹åºçš„æœ¬è´¨

1. å­˜æ”¾åœ¨ç¡¬ç›˜çš„ç¨‹åº\è½¯ä»¶  ----è£…è½½---->å†…å­˜(å…¨æ˜¯0101çš„æ•°æ®) <---è¯»å†™----> CPU ----> æ§åˆ¶ ----->è®¡ç®—æœº(æ˜¾ç¤ºå™¨ã€éŸ³å“ã€è¯ç­’ã€å…¶ä»–è®¾å¤‡)

2. CPU(å¯„å­˜å™¨(ä¿¡æ¯å­˜å‚¨)ã€è¿ç®—å™¨(è¿ç®—å¤„ç†)ã€æ§åˆ¶å™¨)

3. å¯„å­˜å™¨ä¸å†…å­˜

   1. é€šå¸¸ï¼ŒCPUä¼šå…ˆå°†å†…å­˜ä¸­çš„æ•°æ®å­˜å‚¨åˆ°å¯„å­˜å™¨ä¸­ï¼Œç„¶åå†å¯¹å¯„å­˜å™¨ä¸­çš„æ•°æ®è¿›è¡Œè¿ç®—

      ![å¯„å­˜å™¨ä¸å†…å­˜](/Swiftå…¥é—¨åˆ°ç²¾é€šç¬”è®°/å¯„å­˜å™¨ä¸å†…å­˜.png)

##ç¼–ç¨‹è¯­è¨€çš„å‘å±•

1. æœºå™¨è¯­è¨€
   1. ç”±0å’Œ1ç»„æˆ
2. æ±‡ç¼–è¯­è¨€
   1. ç”¨ç¬¦å·ä»£æ›¿æ¥0å’Œ1ï¼Œæ¯”æœºå™¨è¯­è¨€ä¾¿äºé˜…è¯»å’Œè®°å¿†
3. é«˜çº§è¯­è¨€
   1. C\C++\Java\JavaScript\Pythonç­‰ï¼Œæ›´æ¥è¿‘äººç±»è‡ªç„¶è¯­è¨€
4. é«˜çº§è¯­è¨€ ----ç¼–è¯‘---> æ±‡ç¼–è¯­è¨€ ----ç¼–è¯‘---> æœºå™¨è¯­è¨€ ----è¿è¡Œ---> è®¡ç®—æœº
   1. æ±‡ç¼–è¯­è¨€å’Œæœºå™¨è¯­è¨€ä¸€ä¸€å¯¹åº”ï¼Œæ¯ä¸€æ¡æœºå™¨æŒ‡ä»¤éƒ½æœ‰ä¸ä¹‹å¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤
   2. æ±‡ç¼–è¯­è¨€å¯ä»¥é€šè¿‡ç¼–è¯‘å¾—åˆ°æœºå™¨è¯­è¨€ï¼Œæœºå™¨è¯­è¨€å¯ä»¥é€šè¿‡åæ±‡ç¼–å¾—åˆ°æ±‡ç¼–è¯­è¨€
5. æ±‡ç¼–è¯­è¨€çš„ç§ç±»
   1. 8086æ±‡ç¼–(16bit)
   2. x86æ±‡ç¼–(32bit)
   3. x64æ±‡ç¼–(64bit)
   4. ARMæ±‡ç¼–(åµŒå…¥å¼ã€ç§»åŠ¨è®¾å¤‡)
   5. .....
6. x86ã€x64æ±‡ç¼–æ ¹æ®ç¼–è¯‘å™¨çš„ä¸åŒï¼Œæœ‰2ç§ä¹¦å†™æ ¼å¼
   1. Intel    ï¼šWindowsæ´¾ç³»
   2. AT&T  ï¼šUnixæ´¾ç³»
7. ä½œä¸ºiOSå¼€å‘å·¥ç¨‹å¸ˆï¼Œä¸»è¦çš„æ±‡ç¼–è¯­è¨€æ˜¯
   1. AT&Tæ±‡ç¼– -----> iOSæ¨¡æ‹Ÿå™¨
   2. ARMæ±‡ç¼– -----> iOSçœŸæœºè®¾å¤‡

##å¸¸è§æ±‡ç¼–æŒ‡ä»¤

1. jmpæ˜¯è·³è½¬ï¼Œcallæ˜¯æ‰§è¡ŒæŸä¸ªå‡½æ•°ï¼Œcallä¸€èˆ¬å’Œreturné…åˆä½¿ç”¨ï¼Œjmpåˆ™ä¸èƒ½ç”¨
2. æœ‰raxï¼Œripï¼Œeaxï¼Œecx(eå¼€å¤´éƒ½æ˜¯32ä½çš„ï¼Œrå¼€å¤´çš„æ˜¯8ä¸ªå­—èŠ‚)
3. æŒ‡ä»¤movã€leaåé¢è·Ÿç€æ•°å­—å†³å®šæ¥æ“ä½œæ•°é•¿åº¦

![å¸¸è§æ±‡ç¼–æŒ‡ä»¤](/Swiftå…¥é—¨åˆ°ç²¾é€šç¬”è®°/å¸¸è§æ±‡ç¼–æŒ‡ä»¤.png)

## lldbå¸¸ç”¨æŒ‡ä»¤

1. thread step-overã€nextã€n : å•æ­¥è¿è¡Œï¼ŒæŠŠå­å‡½æ•°å½“ä½œæ•´ä½“ä¸€æ­¥æ‰§è¡Œ(æºç çº§åˆ«)
2. thread step-inã€stepã€s : å•æ­¥è¿è¡Œï¼Œé‡åˆ°å­å‡½æ•°ä¼šè¿›å…¥å­å‡½æ•°(æºç çº§åˆ«)
3. thread step-inst-overã€nextiã€ni : å•æ­¥è¿è¡Œï¼ŒæŠŠå­å‡½æ•°å½“ä½œæ•´ä½“ä¸€æ­¥æ‰§è¡Œ(æ±‡ç¼–çº§åˆ«)
4. thread step-instã€stepiã€si : å•æ­¥è¿è¡Œï¼Œé‡åˆ°å­å‡½æ•°ä¼šè¿›å…¥å­å‡½æ•°(æ±‡ç¼–çº§åˆ«)
5. thread step-outã€finish : æ‰§è¡Œæ‰§è¡Œå®Œå½“å‰å‡½æ•°çš„æ‰€æœ‰ä»£ç ,è¿”å›åˆ°ä¸Šä¸€ä¸ªå‡½æ•°(é‡åˆ°æ–­ç‚¹ä¼šå¡ä½)
6. ![lldbå¸¸ç”¨æŒ‡ä»¤](/Swiftå…¥é—¨åˆ°ç²¾é€šç¬”è®°/lldbå¸¸ç”¨æŒ‡ä»¤.png)

##æ±‡ç¼–çœ‹é—­åŒ…

1. æ±‡ç¼–: xorl %ecx, %ecx  // å¼‚æˆ–ï¼Œecxå¼‚æˆ–ecxä¸º0ï¼Œå†å°†è¿™ä¸ª0èµ‹å€¼ç»™ecx
2. æ±‡ç¼–: movq %rcx, (%rax) // (%rax)æŒ‡å–å‡ºraxé‡Œé¢å­˜çš„å€¼
3. æ±‡ç¼–: addq $0x10, %rdx // å°†rdxçš„åœ°å€+0x10ï¼Œå†èµ‹å€¼ç»™rdx
4. æ²¡æœ‰æ•è·ä¸¥æ ¼æ„ä¹‰ä¸Šä¸ç®—é—­åŒ…

# å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹(ç»“æ„ä½“å’Œç±»)

##ç»“æ„ä½“

1. åœ¨Swiftæ ‡å‡†åº“ä¸­ï¼Œç»å¤§å¤šæ•°çš„å…¬å¼€ç±»å‹éƒ½æ˜¯ç»“æ„ä½“ï¼Œè€Œæšä¸¾å’Œç±»åªå å¾ˆå°ä¸€éƒ¨åˆ†

2. Boolã€Intã€Doubleã€Stringã€Arrayã€Dictionaryéƒ½æ˜¯ç»“æ„ä½“

3. æ‰€æœ‰çš„ç»“æ„ä½“éƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„åˆå§‹åŒ–å™¨(ä¿è¯æ‰€æœ‰æˆå‘˜éƒ½æœ‰åˆå§‹å€¼)(initializer,åˆå§‹åŒ–æ–¹æ³•ï¼Œæ„é€ å™¨ï¼Œæ„é€ æ–¹æ³•)

4. ä¸€æ—¦åœ¨å®šä¹‰ç»“æ„ä½“æ—¶è‡ªå®šä¹‰ç±»åˆå§‹åŒ–å™¨ï¼Œç¼–è¯‘å™¨å°±ä¸ä¼šå†å¸®å®ƒè‡ªåŠ¨ç”Ÿæˆå…¶ä»–åˆå§‹åŒ–å™¨

   ```swift
   struct Date {
     var year: Int = 1
     var month: Int
     var day: Int
   }
   var date = Date(year:2019,month:6,day:23) //è¿™äº›æˆå‘˜å«å­˜å‚¨å±æ€§
   var date2 = Date(month: 1, day: 2)
   ```

##ç±»

1. ç±»çš„å®šä¹‰å’Œç»“æ„ä½“ç±»ä¼¼ï¼Œä½†ç¼–è¯‘å™¨å¹¶æ²¡æœ‰ä¸ºç±»è‡ªåŠ¨ç”Ÿæˆå¯ä»¥ä¼ å…¥æˆå‘˜å€¼çš„åˆå§‹åŒ–å™¨
2. å¦‚æœè¿™äº›æˆå‘˜éƒ½æœ‰é»˜è®¤å€¼ï¼Œä¼šåªç”Ÿæˆä¸€ä¸ªæ— å‚åˆå§‹åŒ–å™¨
3. ç±»è‡ªå¸¦16ä¸ªå­—èŠ‚ï¼Œå­˜å‚¨ç±»å‹ä¿¡æ¯å’Œå¼•ç”¨è®¡æ•°

## ç±»å’Œç»“æ„ä½“çš„åŒºåˆ«

1. ç»“æ„ä½“æ˜¯å€¼ç±»å‹(æšä¸¾ä¹Ÿæ˜¯å€¼ç±»å‹)ï¼Œç±»æ˜¯å¼•ç”¨ç±»å‹(æŒ‡é’ˆç±»å‹)

2. æŸ¥çœ‹æ±‡ç¼–å¯çœ‹åˆ°ç»“æ„ä½“æ²¡æœ‰è°ƒç”¨allocï¼Œç±»æœ‰è°ƒç”¨alloc

   ![ç±»å’Œç»“æ„ä½“çš„åŒºåˆ«](/Swiftå…¥é—¨åˆ°ç²¾é€šç¬”è®°/ç±»å’Œç»“æ„ä½“çš„åŒºåˆ«.png)

### å¯¹è±¡çš„å †ç©ºé—´ç”³è¯·è¿‡ç¨‹

1. åœ¨Swiftä¸­ï¼Œåˆ›å»ºç±»çš„å®ä¾‹å¯¹è±¡ï¼Œè¦å‘å †ç©ºé—´ç”³è¯·å†…å­˜ï¼Œå¤§æ¦‚æµç¨‹å¦‚ä¸‹
   1. Class.__allocating_init()
   2. libswiftCore.dylib:_swift_allocObject_
   3. libswiftCore.dylib: swift_slowAlloc
   4. libsystem_malloc.dylib:malloc
2. åœ¨Macã€iOSä¸­çš„mallocå‡½æ•°åˆ†é…çš„å†…å­˜å¤§å°æ€»æ˜¯16çš„å€æ•°
3. é€šè¿‡class_getInstanceSizeå¯ä»¥å¾—çŸ¥ç±»çš„å¯¹è±¡çœŸæ­£ä½¿ç”¨çš„å†…å­˜å¤§å°ï¼šclass_getInstanceSize(Point.self) æˆ–class_getInstanceSize(type(of:p))
4. malloc_size()// æˆ–è€…æŒ‡é’ˆæŒ‡å‘çš„å †ç©ºé—´å ç”¨çš„ç©ºé—´ä½¿ç”¨:

## å¼•ç”¨ç±»å‹

1. å¼•ç”¨èµ‹å€¼ç»™varã€letæˆ–è€…ç»™å‡½æ•°ä¼ å‚ï¼Œæ˜¯å°†å†…å­˜åœ°å€æ‹·è´ä¸€ä»½

2. ç±»ä¼¼äºåˆ¶ä½œä¸€ä¸ªæ–‡ä»¶çš„æ›¿èº«(å¿«æ·æ–¹å¼ã€é“¾æ¥)ï¼ŒæŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªæ–‡ä»¶ã€‚å±äºæµ…æ‹·è´(shallow copy)

   ![å¼•ç”¨ç±»å‹](/Swiftå…¥é—¨åˆ°ç²¾é€šç¬”è®°/å¼•ç”¨ç±»å‹.png)

3. æ±‡ç¼–ï¼šraxã€rdxä¸€èˆ¬ç”¨äºåšå‡½æ•°è¿”å›å€¼ä½¿ç”¨
   1. rdiã€rsiã€rdxã€rcxã€r8ã€r9ç­‰å¯„å­˜å™¨å¸¸ç”¨äºå­˜æ”¾å‡½æ•°å‚æ•°ï¼Œ
   2. å¦‚æœä»¥ä¸Šéƒ½ä¸å¤Ÿæ”¾å‚æ•°ï¼Œrspã€rbpç”¨äºæ ˆæ“ä½œï¼Œä¼šæŠŠå‰©ä½™çš„å‡½æ•°å‚æ•°å­˜æ”¾åœ¨rspã€rbpé‡Œ
   3. ripä½œä¸ºæŒ‡ä»¤æŒ‡é’ˆ
   4. register read rax: è·å–raxçš„åœ°å€å€¼
   5. æ ˆåˆ†é…çš„åœ°å€å…ˆåˆ†é…çš„æ›´é«˜ï¼Œååˆ†é…çš„åœ°å€æ›´ä½
   6. å†…å­˜åœ°å€æ ¼å¼ä¸ºï¼š0x10(%rax)ï¼Œä¸€èˆ¬æ˜¯å †ç©ºé—´
   
   ```swift
   func testReferenceType() {
      class Size {
        var width: Int
        var height: Int
        init(width:Int,height:Int) {
           self.width = width
           self.height = height
        }
      }
      var s1 = Size(width:10,height:20)
      var s2 = s1
      s2.width = 11
      s2.height = 22
   }
      
   å¯¹åº”éƒ¨åˆ†æ±‡ç¼–ï¼š
   // å‡¡æ˜¯__allocating_initå°±å¯ä»¥çŸ¥é“è¿™ä¸ªå‡½æ•°é‡Œé¢æ˜¯alloc initåŠŸèƒ½
   callq 0x100000f50  ; __allocating_init(width: ...)
   // raxä¸€èˆ¬ä½œä¸ºè¿”å›å€¼ä½¿ç”¨ï¼Œæ‰€ä»¥è¿™é‡Œraxå­˜å‚¨çš„æ˜¯åˆå§‹åŒ–åçš„å¯¹è±¡
   // -0x10(%rbp)æ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œæ‰€ä»¥å®ƒå°±æ˜¯s1çš„æŒ‡é’ˆå˜é‡äº†
   movq  %rax,  -0x10(%rbp)
   movq  %rax,  %rdi
   // -0x60(%rbp)æ˜¯å¦ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œæ‰€ä»¥å®ƒå°±æ˜¯2çš„æŒ‡é’ˆå˜é‡äº†
   movq  %rax,  -0x60(%rbp)
   callq 0x10005dca  ; symbol stub for: swift_retain
   .....
   // å°†s2çš„åœ°å€å€¼ç»™rax
   movq  -0x60(%rbp), %rax
   // å°†0xb(10ä½æ•°çš„11) ç»™raxç§»åŠ¨16ä¸ªå­—èŠ‚ä½ç½®(å³å­—èŠ‚çš„ç¬¬ä¸€ä¸ªæˆå‘˜å±æ€§)
   movq  $0xb, 0x10(rax)
   ```

## å€¼ç±»å‹

1. ç±»æ— è®ºåœ¨å“ªé‡Œåˆ›å»ºï¼Œè¿™ä¸ªå¯¹è±¡çš„å†…å­˜éƒ½åœ¨å †ç©ºé—´ï¼ŒæŒ‡é’ˆå˜é‡åœ°å€ä¼šæ ¹æ®æƒ…å†µå˜åŒ–
2. å€¼ç±»å‹èµ‹å€¼ç»™varã€letæˆ–è€…ç»™å‡½æ•°ä¼ å‚ï¼Œæ˜¯ç›´æ¥å°†æ‰€æœ‰å†…å®¹æ‹·è´ä¸€ä»½
3. ç±»ä¼¼äºå¯¹æ–‡ä»¶è¿›è¡Œcopyã€pasteæ“ä½œï¼Œäº§ç”Ÿäº†å…¨æ–°çš„æ–‡æœ¬å‰¯æœ¬ã€‚å±äºæ·±æ‹·è´
4. æ±‡ç¼–eaxå…¶å®å°±æ˜¯raxï¼Œä¸Šä¸€ä¸ªæŒ‡ä»¤æ˜¯eaxï¼Œä¸‹ä¸€ä¸ªæŒ‡ä»¤raxï¼Œä»–ä»¬2ä¸ªå°±æ˜¯ä»£è¡¨åŒä¸€ä¸ªä¸œè¥¿
5. æ±‡ç¼–è§„å¾‹ï¼Œå†…å­˜åœ°å€æ ¼å¼ä¸º:0xxxxx(%rip), ripåŠ ä¸Šä¸€ä¸ªå¾ˆå¤§çš„å€¼ï¼Œä¸€èˆ¬æ˜¯å…¨å±€å˜é‡(å…¨å±€åŒºã€æ•°æ®æ®µ)ï¼Œç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ripçš„å€¼ä¸ä¼šå˜ï¼Œ
6. æ±‡ç¼–è§„å¾‹ï¼Œå†…å­˜åœ°å€æ ¼å¼ä¸º:-0x78(%rbp), rbpå‡æ‰ä¸€ä¸ªå€¼ï¼Œä¸€èˆ¬æ˜¯å±€éƒ¨å˜é‡(æ ˆç©ºé—´)ï¼Œrbpæ¯æ¬¡è°ƒç”¨æ—¶å€™çš„å€¼å°±æœ‰å¯èƒ½ä¸åŒ
7. å­—ç¬¦ä¸²ã€æ•°ç»„éƒ½æ˜¯å€¼ç±»å‹
8. åœ¨Swiftæ ‡å‡†åº“ä¸­ï¼Œä¸ºäº†æç¤ºæ€§èƒ½ï¼ŒStringã€Arrayã€Dictionaryã€Seté‡‡å–äº†Copy On WriteæŠ€æœ¯
   1. Copy On Write: å¦‚æœå€¼ä¸åšæ›´æ”¹ï¼Œå°±ä¸è¿›è¡Œæ·±æ‹·è´ï¼Œå¦‚æœåšäº†ä¿®æ”¹æ“ä½œï¼Œå°±è¿›è¡Œæ·±æ‹·è´
   2. è‡ªå®šä¹‰çš„ç»“æ„ä½“æ˜¯æ²¡æœ‰è¿™ä¸ªæŠ€æœ¯çš„
9. ä¸éœ€è¦ä¿®æ”¹çš„ï¼Œå°½é‡å®šä¹‰ä¸ºlet

```swift
struct Point {
  var x: Int
  var y: Int
}
func test() {
  var p1 = Point(x:10,y:20)
  var p2 = p1
  p2.x = 11
  p2.y = 22
  // é—®p1çš„xå’Œyæ˜¯å¤šå°‘ï¼Ÿ
  // ç­”: 10 20
 
 
  p1 = Point(x:100,y:200)
  // p1çš„åœ°å€å¹¶ä¸ä¼šå˜åŒ–ï¼Œåªæ˜¯åœ°å€é‡Œçš„å€¼ä¼šæ›´æ”¹ä¸º100ï¼Œ200
}
 
 
// Copy On Write
var s1 = "Jack"
var s2 = s1  // å¦‚æœs1å’Œs2çš„å€¼ä¸€æ ·ï¼Œé‚£ä¹ˆs2çš„åœ°å€å’Œs1çš„åœ°å€å°±æ˜¯ä¸€æ ·çš„
s2.appendï¼ˆ"_Rose"ï¼‰ // 2ä¸ªä¸ä¸€æ ·å¼€å§‹åšäº†æ·±æ‹·è´ï¼Œs2åšæ·±æ‹·è´
```

##æšä¸¾ã€ç»“æ„ä½“ã€ç±»éƒ½å¯ä»¥å®šä¹‰æ–¹æ³•

1. ä¸€èˆ¬æŠŠå®šä¹‰åœ¨æšä¸¾ã€ç»“æ„ä½“ã€ç±»å†…éƒ¨çš„å‡½æ•°ï¼Œå«åšæ–¹æ³•
2. æ–¹æ³•å¹¶ä¸å ç”¨å¯¹è±¡çš„å†…å­˜
3. æ–¹æ³•çš„æœ¬è´¨å°±æ˜¯å‡½æ•°
4. æ–¹æ³•ã€å‡½æ•°éƒ½å­˜æ”¾åœ¨ä»£ç æ®µ
5. æ–¹æ³•ä¸­çš„å˜é‡åœ¨æ ˆé‡Œ
6. ä»£ç æ®µæ”¾åœ¨æœ€å‰é¢åœ°å€æœ€å°ï¼Œå†æ¥ç€æ˜¯å…¨å±€å˜é‡ï¼Œç„¶åæ˜¯å †ç©ºé—´ï¼Œæœ€åæ ˆç©ºé—´ï¼Œæ ˆç©ºé—´çš„åœ°å€ä¸€èˆ¬éƒ½ç‰¹åˆ«ç‰¹åˆ«å¤§ï¼Œ

##å¼•ç”¨ç±»å‹çš„èµ‹å€¼æ“ä½œ

```swift
class Size {
    var width: Int
    var height: Int
    init(width: Int, height: Int) {
        self.width = width
        self.height = height
    }
}
 
var s1 = Size(width: 10, height: 20)
s1 = Size(width: 11, height: 22)
// s1çš„åœ°å€å€¼å¹¶ä¸ä¼šå˜ï¼Œä½†æ˜¯s1ä¸­å­˜çš„å¯¹è±¡åœ°å€ä¼šå˜
```

##å€¼ç±»å‹ã€å¼•ç”¨ç±»å‹çš„let

```swift
let p = Point(x: 10, y: 20) // Pointç»“æ„ä½“å€¼ç±»å‹ // p = Point(x: 11, y: 22) // ä¸å…è®¸ // p.x = 33 // ä¸å…è®¸ // p.x = 44 // ä¸å…è®¸ let s = Size(width: 10, height: 20)// s = Size(width: 11, height: 22) // ä¸å…è®¸s.width = 33 // å…è®¸s.height = 44 // å…è®¸
```

##æ–¹æ³•

1. æšä¸¾ã€ç»“æ„ä½“ã€ç±»éƒ½å¯ä»¥å®šä¹‰å®ä¾‹æ–¹æ³•ã€ç±»å‹æ–¹æ³•
   1. å®ä¾‹æ–¹æ³•ï¼šé€šè¿‡å®ä¾‹è°ƒç”¨
   2. ç±»å‹æ–¹æ³•ï¼šé€šè¿‡ç±»å‹è°ƒç”¨ï¼Œç”¨staticæˆ–è€…classå…³é”®å­—å®šä¹‰
2. selfåœ¨å®ä¾‹æ–¹æ³•ä¸­ä»£è¡¨å®ä¾‹ï¼Œåœ¨ç±»å‹æ–¹æ³•ä¸­è¡¨ç¤ºç±»å‹

```swift
Class Car {
   static var count = 0
   init() {
      Car.count += 1
   }
   static func getCount() -> Int { count } // countç­‰ä»·äºself.countã€Car.self.countã€Car.count
}
 
let c0 = Car()
let c1 = Car()
let c2 = Car()
print(Car.getCount()) // 3 getCountæ–¹æ³•å°±æ˜¯ç±»å‹æ–¹æ³•
```

## mutating

1. æšä¸¾å’Œç»“æ„ä½“æ˜¯å€¼ç±»å‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå€¼ç±»å‹çš„å±æ€§ä¸èƒ½è¢«è‡ªèº«çš„å®ä¾‹æ–¹æ³•ä¿®æ”¹Â 
   1. åœ¨funcå…³é”®å­—å‰åŠ mutatingå¯ä»¥å…è®¸è¿™ç§ä¿®æ”¹è¡Œä¸º

```swift
struct Point {
   var x = 0.0, y = 0.0
   mutating func moveBy(deltaX: Double, deltaY: Double) { // ä¸åŠ mutatingä¼šæŠ¥é”™
      x += deltaX
      y += deltaY
   }
}
```

## @discardableResult

1. åœ¨funcå‰é¢åŠ ä¸ª@discardableResultï¼Œå¯ä»¥æ¶ˆé™¤: å‡½æ•°è¿”å›å€¼æœªè¢«ä½¿ç”¨çš„è­¦å‘Š

## ä¸‹æ ‡(subscript)

1. å‰ç«¯æœ‰2ä¸ªæ ‡ç­¾<sup>//ä¸Šæ ‡ <sub> //ä¸‹æ ‡ ä¸Šæ ‡ä¸‹æ ‡å°±æ˜¯æ–¹ç¨‹å¼ä¸­çš„ä¸Šæ ‡ä¸‹æ ‡
2. ä½¿ç”¨subscriptå¯ä»¥ç»™ä»»æ„ç±»å‹(æšä¸¾ã€ç»“æ„ä½“ã€ç±»)å¢åŠ ä¸‹æ ‡åŠŸèƒ½ï¼Œæœ‰äº›åœ°æ–¹ä¹Ÿç¿»è¯‘ä¸º:ä¸‹æ ‡è„šæœ¬
3. subscriptçš„è¯­æ³•æœ‰ç‚¹ç±»ä¼¼äºå®ä¾‹æ–¹æ³•ã€è®¡ç®—å±æ€§ï¼Œæœ¬è´¨å°±æ˜¯æ–¹æ³•(å‡½æ•°)
4. subscriptä¸­å®šä¹‰çš„è¿”å›å€¼ç±»å‹å†³å®šäº†
   1. getæ–¹æ³•çš„è¿”å›å€¼ç±»å‹
   2. setæ–¹æ³•ä¸­newValueçš„ç±»å‹
5. subscriptå¯ä»¥æ¥å—å¤šä¸ªå‚æ•°ï¼Œå¹¶ä¸”ç±»å‹ä»»æ„,å¯ä»¥è®¾ç½®å‚æ•°æ ‡ç­¾
6. subscriptå¯ä»¥æ²¡æœ‰setæ–¹æ³•ï¼Œä½†å¿…é¡»è¦æœ‰getæ–¹æ³•ï¼Œæ­¤æ—¶å¯ä»¥çœç•¥get{}è¿™ä¸ªå¤–åŒ…è£… å’Œè®¡ç®—å±æ€§ç›¸åŒ(åªè¯»è®¡ç®—å±æ€§)
7. ä¸‹æ ‡å¯ä»¥æ˜¯ç±»å‹æ–¹æ³•

```swift
class Point {
   var x = 0.0, y = 0.0
   subscript(index: Int) -> Double { // è¿™é‡Œçš„Doubleè¯´æ˜newValueæ˜¯doubleï¼Œgetè¿”å›çš„ä¼šæ˜¯Double
     set {
       if index == 0 {
          x = newValue
       } else if index == 1 {
          y = newValue
       }
     }
     get {
        if index == 0 {
           return x
        } else if index == 1 {
           return y
        }
        return 0
     }
   }
}
var p = Point()
p[0] = 11.1 // æœ¬è´¨è°ƒç”¨setæ–¹æ³•
p[1] = 22.2
print(p.x) // 11.1
print(p.y) // 22.2
print(p[0]) // 11.1 æœ¬è´¨è°ƒç”¨getæ–¹æ³•
print(p[1])  // 22.2
```

8. ç»“æ„ä½“ã€ç±»å¯ä»¥ä½œä¸ºè¿”å›å€¼å¯¹æ¯”

   ```swift
   struct Point {
     var x = 10,y=10
   }
   class PointManager {
      var point = Point()
      subscript(index: Int) -> Point {
         set { point = newValue }
         get { point }
      }
   }
   var pm = PointManager()
   pm[0].x = 11  // ä¼šèµ°ä¸‹æ ‡çš„setæ–¹æ³•  æœ¬è´¨å°±æ˜¯ pm[0] = Point(x:11, y:pm[0].y)ï¼Œå¦‚æœæ²¡æœ‰setæ–¹æ³•pm[0]ç”±äºæ˜¯å€¼ç±»å‹ï¼Œå¹¶ä¸ä¼šæ›´æ”¹åˆ°pointé‡Œé¢æ‰€å­˜å‚¨çš„å€¼ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™
    
    
   // å¦‚æœPointæ˜¯classçš„è¯ï¼Œæ²¡æœ‰å†™setæ–¹æ³•ï¼Œpm[0].x = 11ä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œæ­¤æ—¶ç›¸å½“äºpm[0]è°ƒç”¨äº†getæ–¹æ³•ï¼Œç”±äºç±»æ˜¯å¼•ç”¨ç±»å‹ï¼Œè¿”å›çš„pointå…¶å®æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œæ‰€ä»¥å¯ä»¥æ›´æ”¹æŒ‡é’ˆé‡Œæ‰€æŒ‡å‘çš„xã€yçš„å€¼
   ```

9. æ¥æ”¶å¤šä¸ªå‚æ•°çš„ä¸‹æ ‡

## ç»§æ‰¿

1. å€¼ç±»å‹(æšä¸¾ã€ç»“æ„ä½“)ä¸æ”¯æŒç»§æ‰¿ï¼Œåªæœ‰ç±»æ”¯æŒç»§æ‰¿
2. æ²¡æœ‰çˆ¶ç±»çš„ç±»ï¼Œç§°ä¸º: åŸºç±»
   1. Swiftå¹¶æ²¡æœ‰åƒOcã€javaé‚£æ ·çš„è§„å®š: ä»»ä½•ç±»æœ€ç»ˆéƒ½è¦ç»§æ‰¿è‡ªæŸä¸ªåŸºç±»
3. å­ç±»å¯ä»¥é‡å†™çˆ¶ç±»çš„ä¸‹æ ‡ã€æ–¹æ³•ã€å±æ€§(è®¡ç®—å±æ€§)ï¼Œé‡å†™å¿…é¡»åŠ ä¸Šoverrideå…³é”®å­—
   1. å®ä¾‹ä¸‹æ ‡ã€æ–¹æ³•ã€å±æ€§(è®¡ç®—å±æ€§) å…è®¸è¢«å­ç±»é‡å†™
   2. è¢«classä¿®é¥°çš„ç±»å‹æ–¹æ³•ã€ä¸‹æ ‡ï¼Œ å…è®¸è¢«å­ç±»é‡å†™
   3. è¢«staticä¿®é¥°çš„ç±»å‹æ–¹æ³•ã€ä¸‹æ ‡ï¼Œä¸å…è®¸è¢«å­ç±»é‡å†™
   4. å­ç±»é‡å†™å¯å°†é‡å†™çš„æ–¹æ³•ã€ä¸‹æ ‡ä¿®é¥°ä¸ºstaticï¼Œè¿™æ ·å­ç±»çš„å­ç±»ä¸èƒ½é‡å†™

### é‡æ–°å®ä¾‹å±æ€§

1. å­ç±»å¯ä»¥å°†çˆ¶ç±»çš„å±æ€§(å­˜å‚¨ã€è®¡ç®—)é‡å†™ä¸ºè®¡ç®—å±æ€§
2. å­ç±»ä¸å¯ä»¥å°†çˆ¶ç±»çš„å±æ€§(å­˜å‚¨ã€è®¡ç®—)é‡å†™ä¸ºå­˜å‚¨å±æ€§

```swift
class Circle {
  var radius: Int = 0
  var diameter: Int {
     set{
        print("Circle setDiameter")
        radius = newValue / 2
     }
     get {
       print("Circle getDiameter")
       return radius * 2  // å­ç±»é€šè¿‡è°ƒç”¨super.diameterè°ƒç”¨åˆ°è¿™é‡Œï¼Œradiusåˆä¼šè°ƒç”¨åˆ°å­ç±»çš„radiusçš„getæ–¹æ³•ï¼Œå­ç±»çš„radiusçš„getä¼šå»çˆ¶ç±»æ‹¿åˆ°å­˜å‚¨å±æ€§radiusçš„å€¼
     }
  }
}
class SubCircle: Circle {
   override var radius: Int {
     set{
        print("SubCircle setRadius")
        super.radius = newValue > 0 ? newValue : 0 // è®¾ç½®çˆ¶ç±»çš„å­˜å‚¨å±æ€§radiusçš„å€¼
     }
     get {
        print("SubCircle getRadius")
        return super.radius  // è·å–çˆ¶ç±»çš„å­˜å‚¨å±æ€§radiusçš„å€¼
     }
   }
   override var diameter: Int {
     set{
        print("SubCircle setDiameter")
        super.diameter = newValue > 0 ? newValue : 0
     }
     get {
       print("SubCircle getDiameter")
       return super.diameter  // è°ƒç”¨çˆ¶ç±»çš„getæ–¹æ³•
     }
  }
}
var circle = SubCircle()
 
 
// SubCircle setRadius
circle.radius = 6
 
 
// SubCircle getDiameter
// Circle getDiameter
// SubCircle getRadius
// 12
print(circle.diameter)
 
 
// SubCircle setDiameter
// Circle setDiameter
// SubCircle setRadius
circle.diameter = 20
 
 
// SubCircle getRadius
// 10
print(circle.radius)
```

### é‡å†™ç±»å‹å±æ€§

1. è¢«classä¿®é¥°çš„è®¡ç®—ç±»å‹å±æ€§ï¼Œå¯ä»¥è¢«å­ç±»é‡å†™(classä¸èƒ½ä¿®é¥°å­˜å‚¨å±æ€§)
2. è¢«staticä¿®é¥°çš„ç±»å‹å±æ€§(å­˜å‚¨ã€è®¡ç®—)ï¼Œä¸å¯ä»¥è¢«å­ç±»é‡å†™

###å±æ€§è§‚å¯Ÿå™¨

1. å¯ä»¥åœ¨å­ç±»ä¸­ä¸ºçˆ¶ç±»å±æ€§(é™¤äº†åªè¯»è®¡ç®—å±æ€§ã€letå±æ€§)å¢åŠ å±æ€§è§‚å¯Ÿå™¨
2. å¦‚æœå­ç±»å’Œçˆ¶ç±»éƒ½æœ‰å±æ€§è§‚å¯Ÿå™¨ï¼Œè°ƒç”¨å­ç±».å±æ€§ = 20ï¼Œé‚£ä¹ˆå­ç±» willSet.. â†’ çˆ¶ç±» willSet â†’ çˆ¶ç±» didSet â†’ å­ç±» didSet
3. çˆ¶ç±»æ˜¯è®¡ç®—å±æ€§ï¼Œå­ç±»ä¹Ÿå¯ä»¥å¢åŠ å±æ€§è§‚å¯Ÿå™¨

```swift
class Circle {
  var radius: Int {
     set{
        print("Circle setRadius",newValue)
     }
     get {
       print("Circle getRadius")
       return 20
     }
  }
}
class SubCircle: Circle {
   override static var radius: Int {
     willSet{
        print("SubCircle willSetRadius",newValue)
     }
     didSet {
        print("SubCircle didSetRadius",oldValue,radius) // radiusä¼šè°ƒç”¨åˆ°çˆ¶ç±»çš„getæ–¹æ³•
     }
   }
}
 
 
// Circle getRadius   // è¿™é‡Œæ˜¯è°ƒç”¨oldValueäº§ç”Ÿçš„æ‰“å°ï¼Œå› ä¸ºæ˜¯oldValueï¼Œæ‰€ä»¥ä¼šåœ¨willSetä¹‹å‰å…ˆæ‹¿åˆ°åŸæ¥çš„å€¼
// SubCircle willSetRadius 10
// Circle setRadius 10
// Circle getRadius
// SubCircle didSetRadius 20 20
SubCircle.radius = 10
```

### final

1. è¢«finalä¿®é¥°çš„æ–¹æ³•ã€ä¸‹æ ‡ã€å±æ€§ï¼Œç¦æ­¢è¢«é‡å†™
2. è¢«finalä¿®é¥°çš„ç±»ï¼Œä¸èƒ½è¢«ç»§æ‰¿

## å¤šæ€åŸç†

1. Ocåˆ©ç”¨rutimeå®ç°
2. C++åˆ©ç”¨è™šè¡¨(è™šå‡½æ•°è¡¨)
3. Swiftç±»ä¼¼äºC++çš„è™šè¡¨
4. ç±»çš„å‰8ä¸ªå­—èŠ‚æ”¾ç€ç±»å‹ä¿¡æ¯;ç±»å‹ä¿¡æ¯æ‰€æŒ‡å‘åœ°å€æ”¾ç€æ–¹æ³•åœ°å€ï¼Œæ²¡é‡å†™çš„çˆ¶ç±»æ–¹æ³•åœ°å€
5. çœ‹ç±»å‹ä¿¡æ¯æ‰€å­˜å†…å®¹çš„åœ°å€å¯çŸ¥é“å®ƒæ”¾åœ¨å…¨å±€åŒº
6. åŒä¸€ä¸ªç±»çš„å¤šä¸ªå®ä¾‹å‰8ä¸ªå­—èŠ‚éƒ½æ˜¯ä¸€æ ·çš„

```swift
// ç±»å®šä¹‰æ–¹æ³•åç”Ÿæˆçš„æ±‡ç¼–ä¼šéå¸¸å¤šï¼Œ call  ä¸æ˜¯å›ºå®šåœ°å€å€¼,å› ä¸ºè¿è¡Œçš„æ—¶å€™æ‰èƒ½ç¡®å®šçš„
// è°ƒç”¨ç±»æ–¹æ³•ä¼šæ‰¾åˆ°è¿™ç±»çš„å‰é¢8ä¸ªå€¼ï¼Œå†æ‰¾åˆ°ç±»å‹åœ°å€æ‰€æŒ‡å‘åœ°å€ï¼Œæ‰¾åˆ°è¿™ä¸ªåœ°å€+åç§»é‡åå¾—åˆ°æ–¹æ³•åœ°å€ï¼Œ
// ç»“æ„ä½“å®šä¹‰æ–¹æ³•åç”Ÿæˆçš„æ±‡ç¼–å°±æ¯”è¾ƒå°‘ï¼Œcall 0xå›ºå®šåœ°å€å€¼
```

## åˆå§‹åŒ–å™¨

1. ç±»ã€ç»“æ„ä½“ã€æšä¸¾éƒ½å¯ä»¥å®šä¹‰åˆå§‹åŒ–å™¨
2. ç±»æœ‰2ç§åˆå§‹åŒ–å™¨ï¼šæŒ‡å®šåˆå§‹åŒ–å™¨(designated initializer)ã€ä¾¿æ·åˆå§‹åŒ–å™¨(convenience initializer)
   1. æ¯ä¸ªç±»è‡³å°‘æœ‰ä¸€ä¸ªæŒ‡å®šåˆå§‹åŒ–å™¨ï¼ŒæŒ‡å®šåˆå§‹åŒ–å™¨æ˜¯ç±»çš„ä¸»è¦åˆå§‹åŒ–å™¨
   2. é»˜è®¤åˆå§‹åŒ–å™¨æ€»æ˜¯ç±»çš„æŒ‡å®šåˆå§‹åŒ–å™¨ ï¼Œå½“ä½ æ²¡å†™æ–°çš„æŒ‡å®šåˆå§‹åŒ–å™¨ï¼Œä¼šè‡ªå¸¦é»˜è®¤åˆå§‹åŒ–å™¨ï¼Œä¸€æ—¦è‡ªå·±å†™äº†æ–°çš„æŒ‡å®šåˆå§‹åŒ–å™¨ï¼Œé»˜è®¤åˆå§‹åŒ–å™¨å°±è‡ªåŠ¨æ¶ˆå¤±ï¼Œä¸èƒ½å†ç”¨äº†ï¼Œä½†æ˜¯å½“ä½ åªå†™äº†ä¸€ä¸ªæ–°çš„ä¾¿æ·åˆå§‹åŒ–å™¨ï¼Œé»˜è®¤åˆå§‹åŒ–å™¨ä¾ç„¶å­˜åœ¨ï¼Œä¾ç„¶å¯ç”¨ã€‚
   3. ç±»åå‘äºå°‘é‡æŒ‡å®šåˆå§‹åŒ–å™¨ï¼Œä¸€ä¸ªç±»é€šå¸¸åªæœ‰ä¸€ä¸ªæŒ‡å®šåˆå§‹åŒ–å™¨
   4. ç±»å¯ä»¥å¤šå®šä¹‰ä¾¿æ·åˆå§‹åŒ–å™¨ï¼Œå°‘å®šä¹‰æŒ‡å®šåˆå§‹åŒ–å™¨
3. åˆå§‹åŒ–å™¨çš„ç›¸äº’è°ƒç”¨è§„åˆ™
   1. æŒ‡å®šåˆå§‹åŒ–å™¨å¿…é¡»ä»å®ƒçš„ç›´ç³»çˆ¶ç±»è°ƒç”¨æŒ‡å®šåˆå§‹åŒ–å™¨ï¼ˆä¸èƒ½è‡ªå·±çš„æŒ‡å®šè°ƒç”¨è‡ªå·±çš„æŒ‡å®šï¼‰ï¼Œå¹¶ä¸”è°ƒç”¨é¡ºåºè¦å†™åœ¨å­ç±»è‡ªå®šä¹‰çš„å±æ€§åé¢ï¼Œå¹¶ä¸”æ²¡è°ƒç”¨çˆ¶ç±»çš„æŒ‡å®šåˆå§‹åŒ–å™¨å‰ï¼Œä¸èƒ½ä½¿ç”¨ä»çˆ¶ç±»ç»§æ‰¿è¿‡æ¥çš„å±æ€§
   2. ä¾¿æ·åˆå§‹åŒ–å™¨å¿…é¡»ä»ç›¸åŒçš„ç±»é‡Œè°ƒç”¨å¦ä¸€ä¸ªåˆå§‹åŒ–å™¨
   3. ä¾¿æ·åˆå§‹åŒ–å™¨æœ€ç»ˆå¿…é¡»è°ƒç”¨ä¸€ä¸ªæŒ‡å®šåˆå§‹åŒ–å™¨

![åˆå§‹åŒ–å™¨ç®€å•å›¾](/Swiftå…¥é—¨åˆ°ç²¾é€šç¬”è®°/åˆå§‹åŒ–å™¨ç®€å•å›¾.png)

![åˆå§‹åŒ–å™¨å¤æ‚å›¾](/Swiftå…¥é—¨åˆ°ç²¾é€šç¬”è®°/åˆå§‹åŒ–å™¨å¤æ‚å›¾.png)

### ä¸¤æ®µå¼åˆå§‹åŒ–

1. Swiftåœ¨ç¼–ç å®‰å…¨æ–¹é¢æ˜¯ç…è´¹è‹¦å¿ƒï¼Œä¸ºäº†ä¿è¯åˆå§‹åŒ–è¿‡ç¨‹çš„å®‰å…¨ï¼Œè®¾å®šäº†ä¸¤æ®µå¼åˆå§‹åŒ–ã€å®‰å…¨æ£€æŸ¥

2. ä¸¤æ®µå¼åˆå§‹åŒ–

   1. ç¬¬ä¸€é˜¶æ®µ: åˆå§‹åŒ–æ‰€æœ‰å­˜å‚¨å±æ€§

      1. å¤–å±‚è°ƒç”¨æŒ‡å®š\ä¾¿æ·åˆå§‹åŒ–å™¨
      2. åˆ†é…å†…å­˜ç»™å®ä¾‹ï¼Œä½†æœªåˆå§‹åŒ–
      3. æŒ‡å®šåˆå§‹åŒ–å™¨ç¡®ä¿å½“å‰ç±»å®šä¹‰çš„å­˜å‚¨å±æ€§éƒ½åˆå§‹åŒ–
      4. æŒ‡å®šåˆå§‹åŒ–å™¨è°ƒç”¨çˆ¶ç±»çš„åˆå§‹åŒ–å™¨ï¼Œä¸æ–­å‘ä¸Šè°ƒç”¨ï¼Œå½¢æˆåˆå§‹åŒ–å™¨é“¾

      ```swift
      class Person {
          
          var age: Int
          init(age: Int) {
              
              print(self.age) // ä¼šæŠ¥é”™
              self.age = age
          }
      }
      ```

   2. ç¬¬äºŒé˜¶æ®µï¼šè®¾ç½®æ–°çš„å­˜å‚¨å±æ€§å€¼

      1. ä»é¡¶éƒ¨åˆå§‹åŒ–å™¨å¾€ä¸‹ï¼Œé“¾ä¸­çš„æ¯ä¸€ä¸ªæŒ‡å®šåˆå§‹åŒ–å™¨éƒ½æœ‰è®¡åˆ’è¿›ä¸€æ­¥å®šåˆ¶å®ä¾‹
      2. åˆå§‹åŒ–å™¨ç°åœ¨èƒ½å¤Ÿä½¿ç”¨self(è®¿é—®ã€ä¿®æ”¹å®ƒçš„å±æ€§ï¼Œè°ƒç”¨å®ƒçš„å®ä¾‹æ–¹æ³•ç­‰ç­‰)
      3. æœ€ç»ˆï¼Œé“¾ä¸­ä»»ä½•ä¾¿æ·åˆå§‹åŒ–å™¨éƒ½æœ‰æœºä¼šå®šåˆ¶å®ä¾‹ä»¥åŠä½¿ç”¨self

3. å®‰å…¨æ£€æŸ¥

   1. æŒ‡å®šåˆå§‹åŒ–å™¨å¿…é¡»ä¿è¯åœ¨è°ƒç”¨çˆ¶ç±»åˆå§‹åŒ–å™¨ä¹‹å‰ï¼Œå…¶æ‰€åœ¨ç±»å®šä¹‰çš„æ‰€æœ‰å­˜å‚¨å±æ€§éƒ½è¦åˆå§‹åŒ–å®Œæˆ
   2. æŒ‡å®šåˆå§‹åŒ–å™¨å¿…é¡»å…ˆè°ƒç”¨çˆ¶ç±»åˆå§‹åŒ–å™¨ï¼Œç„¶åæ‰èƒ½ä¸ºç»§æ‰¿çš„å±æ€§è®¾ç½®æ–°å€¼
   3. ä¾¿æ·åˆå§‹åŒ–å™¨å¿…é¡»å…ˆè°ƒç”¨åŒç±»ä¸­çš„å…¶ä»–åˆå§‹åŒ–å™¨ï¼Œç„¶åå†ä¸ºä»»æ„å±æ€§è®¾ç½®æ–°å€¼
   4. åˆå§‹åŒ–å™¨åœ¨ç¬¬ä¸€é˜¶æ®µåˆå§‹åŒ–å®Œæˆä¹‹å‰ï¼Œä¸èƒ½è°ƒç”¨ä»»ä½•å®ä¾‹æ–¹æ³•ã€ä¸èƒ½è¯»å–ä»»ä½•å®ä¾‹å±æ€§çš„å€¼ï¼Œä¹Ÿä¸èƒ½å¼•ç”¨self
   5. ç›´åˆ°ç¬¬ä¸€é˜¶æ®µç»“æŸï¼Œå®ä¾‹æ‰ç®—å®Œå…¨åˆæ³•

### è‡ªåŠ¨ç»§æ‰¿

1. å¦‚æœå­ç±»æ²¡æœ‰è‡ªå®šä¹‰ä»»ä½•æŒ‡å®šåˆå§‹åŒ–å™¨ï¼Œå®ƒä¼šè‡ªåŠ¨ç»§æ‰¿çˆ¶ç±»æ‰€æœ‰çš„æŒ‡å®šåˆå§‹åŒ–å™¨ï¼Œå¦åˆ™ä¸ä¼šè‡ªåŠ¨ç»§æ‰¿
2. å¦‚æœå­ç±»æä¾›ç±»çˆ¶ç±»æ‰€æœ‰æŒ‡å®šåˆå§‹åŒ–å™¨çš„å®ç°(è¦ä¹ˆé€šè¿‡1ç»§æ‰¿ï¼Œè¦ä¹ˆé‡å†™)
   1. å­ç±»è‡ªåŠ¨ç»§æ‰¿æ‰€æœ‰çš„çˆ¶ç±»ä¾¿æ·åˆå§‹åŒ–å™¨
3. å°±ç®—å­ç±»æ·»åŠ äº†æ›´å¤šçš„ä¾¿æ·åˆå§‹åŒ–å™¨ï¼Œè¿™äº›è§„åˆ™ä»ç„¶é€‚ç”¨
4. å­ç±»ä»¥ä¾¿æ·åˆå§‹åŒ–å™¨çš„å½¢å¼é‡å†™çˆ¶ç±»çš„æŒ‡å®šåˆå§‹åŒ–å™¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºæ»¡è¶³è§„åˆ™2çš„ä¸€éƒ¨åˆ†

```swift
class Person {
    
    var age: Int
    init(age: Int) {
        self.age = age
    }
    convenience init() {
        self.init(age: 0)
    }
    init(hhh: Int) {
        self.age = 0
    }
}
 
class Student: Person {
    
   var score: Int = 0
    
    convenience override init(age: Int) {
        
        self.init()
        self.score = score
        self.age = 10
    }
   convenience init(age: Int, score: Int) {
    
        self.init(age: age)
        self.score = score
        self.age = 10
    }
}

Student(age: 2)
Student()
Student(age: 3, score: 4)
Student(hhh: 2)
```

### é‡å†™åˆå§‹åŒ–å™¨

1. å½“é‡å†™çˆ¶ç±»çš„æŒ‡å®šåˆå§‹åŒ–å™¨æ—¶ï¼Œå¿…é¡»åŠ ä¸Šoverride(å³ä½¿å­ç±»çš„å®ç°æ˜¯ä¾¿æ·åˆå§‹åŒ–å™¨)
2. å­ç±»å¯ä»¥å°†çˆ¶ç±»çš„æŒ‡å®šåˆå§‹åŒ–å™¨é‡å†™å†™ä¾¿æ·åˆå§‹åŒ–å™¨
3. å¦‚æœå­ç±»å†™ç±»ä¸€ä¸ªåŒ¹é…çˆ¶ç±»ä¾¿æ·åˆå§‹åŒ–å™¨çš„åˆå§‹åŒ–å™¨(ä¸ç®¡æ˜¯æŒ‡å®šè¿˜æ˜¯ä¾¿æ·)ï¼Œä¸ç”¨åŠ ä¸Šoverride(ä¾¿æ·åˆå§‹åŒ–å™¨ä¸èƒ½è¢«å­ç±»è°ƒç”¨ï¼Œæ‰€ä»¥ä¸¥æ ¼è¯´ä¸ç®—é‡å†™)

```swift
class Person {
   var width: Int
   var height: Int
   // æŒ‡å®šåˆå§‹åŒ–å™¨
   init(width: Int, height: Int) {
      self.width = width
      self.height = height
   }
   convenience init() {
      self.init(width: 0,height: 0)
   }
}
class Student: Person {
   var score: Int
   init(width: Int,height: Int, score: Int) {
       self.score = score // æŒ‡å®šåˆå§‹åŒ–å™¨ç¡®ä¿å½“å‰ç±»å®šä¹‰çš„å­˜å‚¨å±æ€§éƒ½åˆå§‹åŒ–
       // æŒ‡å®šåˆå§‹åŒ–å™¨å¿…é¡»ä»å®ƒçš„ç›´ç³»çˆ¶ç±»è°ƒç”¨æŒ‡å®šåˆå§‹åŒ–å™¨
       super.init(width: width,height: height)
       // å¯ä»¥å¼€å§‹ä½¿ç”¨self(è®¿é—®ã€ä¿®æ”¹å®ƒçš„å±æ€§ï¼Œè°ƒç”¨å®ƒçš„å®ä¾‹æ–¹æ³•ç­‰ç­‰)
       self.width = 10
   }
   override convenience init(width: Int, height: Int) {
      self.init(width: width,height: height,score: 0)
   }
 
 
   init() { // å¦‚æœå­ç±»å†™ç±»ä¸€ä¸ªåŒ¹é…çˆ¶ç±»ä¾¿æ·åˆå§‹åŒ–å™¨çš„åˆå§‹åŒ–å™¨(ä¸ç®¡æ˜¯æŒ‡å®šè¿˜æ˜¯ä¾¿æ·)ï¼Œä¸ç”¨åŠ ä¸Šoverride
 
 
      self.score = 0
      super.init(width: 0, height: 0)
   }
}
```

### required

1. ç”¨requiredä¿®é¥°æŒ‡å®šåˆå§‹åŒ–å™¨ï¼Œè¡¨æ˜å…¶æ‰€æœ‰å­ç±»éƒ½å¿…é¡»å®ç°è¯¥åˆå§‹åŒ–å™¨(é€šè¿‡ç»§æ‰¿æˆ–è€…é‡å†™å®ç°)
2. å¦‚æœå­ç±»é‡å†™äº†requiredåˆå§‹åŒ–å™¨ï¼Œä¹Ÿå¿…é¡»åŠ ä¸Šrequiredï¼Œä¸ç”¨åŠ override

### å±æ€§è§‚å¯Ÿå™¨

1. çˆ¶ç±»çš„å±æ€§åœ¨å®ƒè‡ªå·±çš„åˆå§‹åŒ–å™¨ä¸­èµ‹å€¼ä¸ä¼šè§¦å‘å±æ€§è§‚å¯Ÿå™¨ï¼Œä½†åœ¨å­ç±»çš„åˆå§‹åŒ–å™¨ä¸­èµ‹å€¼ä¼šè§¦å‘å±æ€§è§‚å¯Ÿå™¨

### å¯å¤±è´¥åˆå§‹åŒ–å™¨

1. ç±»ã€ç»“æ„ä½“ã€æšä¸¾éƒ½å¯ä»¥ä½¿ç”¨init?å®šä¹‰å¯å¤±è´¥åˆå§‹åŒ–å™¨
2. ä¸å…è®¸åŒæ—¶å®šä¹‰å‚æ•°æ ‡ç­¾ã€å‚æ•°ä¸ªæ•°ã€å‚æ•°ç±»å‹ç›¸åŒçš„å¯å¤±è´¥åˆå§‹åŒ–å™¨å’Œéå¯å¤±è´¥åˆå§‹åŒ–å™¨
3. å¯ä»¥ç”¨init!å®šä¹‰éšå¼è§£åŒ…çš„å¯å¤±è´¥åˆå§‹åŒ–å™¨
4. å¯å¤±è´¥åˆå§‹åŒ–å™¨å¯ä»¥è°ƒç”¨éå¯å¤±è´¥åˆå§‹åŒ–å™¨ï¼Œéå¯å¤±è´¥åˆå§‹åŒ–å™¨è°ƒç”¨å¯å¤±è´¥åˆå§‹åŒ–å™¨éœ€è¦è¿›è¡Œè§£åŒ…
5. å¦‚æœåˆå§‹åŒ–å™¨è°ƒç”¨ä¸€ä¸ªå¯å¤±è´¥åˆå§‹åŒ–å™¨å¯¼è‡´åˆå§‹åŒ–å¤±è´¥ï¼Œé‚£ä¹ˆæ•´ä¸ªåˆå§‹åŒ–è¿‡ç¨‹éƒ½å¤±è´¥ï¼Œå¹¶ä¸”ä¹‹åçš„ä»£ç éƒ½åœæ­¢æ‰§è¡Œ
6. å¯ä»¥ç”¨ä¸€ä¸ªéå¯å¤±è´¥åˆå§‹åŒ–å™¨é‡å†™ä¸€ä¸ªå¯å¤±è´¥åˆå§‹åŒ–å™¨ï¼Œä½†åè¿‡æ¥æ˜¯ä¸è¡Œçš„(åè®®åè¿‡æ¥ä¹Ÿå¯ä»¥)

```swift
class Person {
    
    var name: String = ""
    var age: Int = 0
    convenience init?(name: String) { // å®šä¹‰å¯å¤±è´¥åˆå§‹åŒ–å™¨
        
        self.init() // å¯å¤±è´¥åˆå§‹åŒ–å™¨è°ƒç”¨éå¯å¤±è´¥åˆå§‹åŒ–å™¨
        if name.isEmpty {
            return nil
        }
        self.name = name
    }
    init!(age: Int) { // éšå¼è§£åŒ…çš„å¯å¤±è´¥åˆå§‹åŒ–å™¨
        if age == 0 {
            return nil
        }
        self.age = age
    }
    
    // éå¯å¤±è´¥åˆå§‹åŒ–å™¨è°ƒç”¨å¯å¤±è´¥åˆå§‹åŒ–å™¨
    convenience init() {
        
        self.init(age: 2) // éšå¼è§£åŒ…
        self.name = ""
    }
    
    // éå¯å¤±è´¥åˆå§‹åŒ–å™¨è°ƒç”¨å¯å¤±è´¥åˆå§‹åŒ–å™¨
    convenience init(name: String, age: Int) {
        
        self.init(name: "")!  // å¼ºåˆ¶è§£åŒ…
    }
}
 
class Student: Person {
    
    override init(age: Int) { // éå¯å¤±è´¥åˆå§‹åŒ–å™¨é‡å†™ä¸€ä¸ªå¯å¤±è´¥åˆå§‹åŒ–å™¨
        
        super.init(age: age)
    }
}
```

### ååˆå§‹åŒ–å™¨(deinit)

1. deinitå«åšååˆå§‹åŒ–å™¨ï¼Œç±»ä¼¼äºC++çš„ææ„å‡½æ•°ã€OCä¸­çš„deallocæ–¹æ³• 
2. å½“ç±»çš„å®ä¾‹å¯¹è±¡è¢«é‡Šæ”¾å†…å­˜æ—¶ï¼Œå°±ä¼šè°ƒç”¨å®ä¾‹å¯¹è±¡çš„deinitæ–¹æ³•
3. deinitä¸æ¥å—ä»»ä½•å‚æ•°ï¼Œä¸èƒ½å†™å°æ‹¬å·ï¼Œä¸èƒ½è‡ªè¡Œè°ƒç”¨ 
4. çˆ¶ç±»çš„deinitèƒ½è¢«å­ç±»ç»§æ‰¿
5.  å­ç±»çš„deinitå®ç°æ‰§è¡Œå®Œæ¯•åä¼šè°ƒç”¨çˆ¶ç±»çš„deinit

```swift
class Person {
   deinit {
      print("Personå¯¹è±¡é”€æ¯äº†")
   }
}
class Student: Person {
   deinit {
print("Studentå¯¹è±¡é”€æ¯äº†")
   }
}
func test() {
   var stu = Student()
}
print("1")
test()
print("2")
// 1
// Studentå¯¹è±¡é”€æ¯äº†
// Personå¯¹è±¡é”€æ¯äº†
// 2
```

# é—­åŒ…

## ä»‹ç»

### é—­åŒ…è¡¨è¾¾å¼

1. swifté‡Œï¼Œå¯ä»¥é€šè¿‡funcå®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é—­åŒ…è¡¨è¾¾å¼å®šä¹‰ä¸€ä¸ªå‡½æ•°

```swift
func sum(_ v1: Int, _ v2: Int) -> Int { v1 + v2 }

var fn = {
    (v1: Int, v2: Int) -> Int in
    return v1 + v2
}
//fn(10,20)
//// é—­åŒ…æ ¼å¼
//{
//    (å‚æ•°åˆ—è¡¨) -> è¿”å›å€¼ç±»å‹ in
//    å‡½æ•°ä½“ä»£ç 
//}

// å®šä¹‰å®Œç›´æ¥è°ƒç”¨
{
    (v1: Int, v2: Int) -> Int in
    return v1 + v2
}(10,20)
```

### é—­åŒ…è¡¨è¾¾å¼çš„ç®€å†™

```swift
func exec(v1: Int, v2: Int, fn:(Int,Int) -> Int) {
  print(fn(v1,v2))
}
// çœç•¥1
exec(v1: 10,v2: 20, fn{
  (v1: Int, v2: Int) -> Int in
  return v1+v2
})
// çœç•¥2
exec(v1: 10,v2: 20, fn{
  v1, v2 in
  return v1+v2
})
// çœç•¥3
exec(v1: 10,v2: 20, fn{
  v1, v2 in v1+v2
})
// çœç•¥4
exec(v1: 10,v2: 20, fn{ $0 + $1}) // $0è¡¨ç¤ºç¬¬1ä¸ªå‚æ•°ï¼Œ$1ç¬¬äºŒä¸ªå‚æ•°
// çœç•¥5
exec(v1: 10,v2: 20, fn{+}) // æµ‹è¯•è¿™ä¸ªä¸è¡Œ
```

### å°¾éšé—­åŒ…

1. å¦‚æœå°†ä¸€ä¸ªå¾ˆé•¿çš„é—­åŒ…è¡¨è¾¾å¼ä½œä¸ºå‡½æ•°çš„æœ€åä¸€ä¸ªå®æƒ¨ï¼Œä½¿ç”¨å°¾éšé—­åŒ…å¯ä»¥å¢å¼ºå‡½æ•°çš„å¯è¯»æ€§
2. å°¾éšé—­åŒ…æ˜¯ä¸€ä¸ªè¢«ä¹¦å†™åœ¨å‡½æ•°è°ƒç”¨æ‹¬å·å¤–é¢(åé¢)çš„é—­åŒ…è¡¨è¾¾å¼
3. å¦‚æœé—­åŒ…è¡¨è¾¾å¼æ˜¯å‡½æ•°çš„å”¯ä¸€å®å‚ï¼Œè€Œä¸”ä½¿ç”¨é‡Œå°¾éšé—­åŒ…çš„è¯­æ³•ï¼Œé‚£å°±ä¸éœ€è¦åœ¨å‡½æ•°ååè¾¹å†™åœ†æ‹¬å·

```swift
func exec(v1: Int, v2: Int, fn:(Int, Int) -> Int) {
    
    print(fn(v1,v2))
}

exec(v1: 10, v2: 20) {
    
    $0 + $1
}
 
func execfn(fn:(Int, Int) -> Int) {
    
    print(fn(1,2))
}

execfn(fn: {$0+$1})

execfn(){$0+$1}

execfn{$0+$1}
```

### é—­åŒ…

1. ä¸€ä¸ªå‡½æ•°å’Œå®ƒæ‰€æ•è·çš„å˜é‡\å¸¸é‡ç¯å¢ƒç»„åˆèµ·æ¥ï¼Œç§°ä¸ºé—­åŒ…
2. (lldb) x/5xg åœ°å€ // ä¼šåœ¨æ§åˆ¶å°æ‰“å°5ç»„(8(g)ä¸ªå­—èŠ‚ä¸€ç»„)è¯¥åœ°å€é‡Œå†…å®¹
3. å¯ä»¥æŠŠé—­åŒ…æƒ³è±¡æˆä¸€ä¸ªç±»çš„å®ä¾‹å¯¹è±¡ï¼Œå†…å­˜åœ¨å †ç©ºé—´ï¼Œæ•è·çš„å±€éƒ¨å˜é‡ã€å¸¸é‡å°±æ˜¯å¯¹è±¡çš„æˆå‘˜ï¼Œç»„æˆé—­åŒ…çš„å‡½æ•°å°±æ˜¯ç±»å†…éƒ¨å®šä¹‰çš„æ–¹æ³•

```swift
func getFn() -> Fn {
   var num = 0 // å±€éƒ¨å˜é‡
   func plus(_ i: Int) -> Int {
     num += i    // å†…å±‚å‡½æ•°ä½¿ç”¨é‡Œå¤–å±‚å˜é‡ï¼Œå°±ä¼šåœ¨å †ç©ºé—´ç”³è¯·å†…å­˜å­˜å‚¨num
     return num
   }
   return plus
}
var fn = getFn()
print(fn(1))  // 1
print(fn(2))  // 3
print(fn(3))  // 6
```

### è‡ªåŠ¨é—­åŒ…

1. @autoclosureä¼šè‡ªåŠ¨å°†20å°è£…æˆé—­åŒ…{20}
2. @autoclosureåªæ”¯æŒ() â†’ T æ ¼å¼çš„å‚æ•°
3. @autoclosureå¹¶éåªæ”¯æŒæœ€åä¸€ä¸ªå‚æ•° 
4. ç©ºåˆå¹¶è¿ç®—ç¬¦ï¼Ÿï¼Ÿä½¿ç”¨äº†@autoclosureæŠ€æœ¯
5. æœ‰@autoclosureå’Œæ— @autoclosureæ„æˆäº†å‡½æ•°é‡è½½

```swift
func getFirstPositive(_ v1: Int, _ v2: @autoclosure () -> Int) -> Int {
     
    return v1 > 0 ? v1 : v2()
}
// ä¼šè‡ªåŠ¨å°†20å°è£…æˆé—­åŒ…{20}
getFirstPositive(-4,20)
```

###æ±‡ç¼–çœ‹é—­åŒ…

1. æ±‡ç¼–: xorl %ecx, %ecx  // å¼‚æˆ–ï¼Œecxå¼‚æˆ–ecxä¸º0ï¼Œå†å°†è¿™ä¸ª0èµ‹å€¼ç»™ecx
2. æ±‡ç¼–: movq %rcx, (%rax) // (%rax)æŒ‡å–å‡ºraxé‡Œé¢å­˜çš„å€¼
3. æ±‡ç¼–: addq $0x10, %rdx // å°†rdxçš„åœ°å€+0x10ï¼Œå†èµ‹å€¼ç»™rdx
4. æ²¡æœ‰æ•è·ä¸¥æ ¼æ„ä¹‰ä¸Šä¸ç®—é—­åŒ…

# å±æ€§

1. Swiftä¸­è·Ÿå®ä¾‹ç›¸å…³çš„å±æ€§å¯ä»¥åˆ†ä¸º2å¤§ç±»
   1. å­˜å‚¨å±æ€§
      1. ç±»ä¼¼äºæˆå‘˜å˜é‡è¿™ä¸ªæ¦‚å¿µ
      2. å­˜å‚¨åœ¨å®ä¾‹çš„å†…å­˜ä¸­
      3. ç»“æ„ä½“ã€ç±»å¯ä»¥å®šä¹‰å­˜å‚¨å±æ€§
      4. æšä¸¾ä¸å¯ä»¥å®šä¹‰å­˜å‚¨å±æ€§
   2. è®¡ç®—å±æ€§
      1. æœ¬è´¨å°±æ˜¯æ–¹æ³•(å‡½æ•°)
      2. ä¸å ç”¨å®ä¾‹çš„å†…å­˜
      3. æšä¸¾ã€ç»“æ„ä½“ã€ç±»éƒ½å¯ä»¥å®šä¹‰è®¡ç®—å±æ€§
   3. å±æ€§è§‚å¯Ÿå™¨ã€è®¡ç®—å±æ€§çš„åŠŸèƒ½ï¼ŒåŒæ ·å¯ä»¥åº”ç”¨åœ¨å…¨å±€å˜é‡ã€å±€éƒ¨å˜é‡èº«ä¸Š

```swift
struct Circle {
   // å­˜å‚¨å±æ€§
   var radius: Double  // ä¸€ä¸ªdoubleå 8ä¸ªå†…å­˜
   // è®¡ç®—å±æ€§
   var dismeter: Double {  // ä¸å­˜åœ¨dismeterè¿™ä¸ªæˆå‘˜å˜é‡
      set {
         radiu = newValue / 2
      }
      get {
         radiu * 2 // çœç•¥äº†return
      }
   }
}
var c = Circle = 40
print(c.radius) // 20
c.radius = 11
print(c.diameter) // 22
print(MemoryLaout<Circle>.stride)  // 8
```

## å­˜å‚¨å±æ€§

```swift
struct Point {
   var x: Int = 11
   var y: Int = 22
    
  // åŒ
  // init() {
  //  x = 11,
  //  y = 22,
  // }
   var onlyReadValue: Double { x*2 } // è¿™é‡Œçœç•¥äº†getå’Œreturn
}
```

### å»¶è¿Ÿå­˜å‚¨å±æ€§

1. ä½¿ç”¨lazyå¯ä»¥å®šä¹‰ä¸€ä¸ªå»¶è¿Ÿå­˜å‚¨å±æ€§ï¼Œåœ¨ç¬¬ä¸€æ¬¡ç”¨åˆ°å±æ€§çš„æ—¶å€™æ‰ä¼šè¿›è¡Œåˆå§‹åŒ–
2. lazyå±æ€§å¿…é¡»æ˜¯varï¼Œä¸èƒ½æ˜¯let(å› ä¸ºletå¿…é¡»åœ¨å®ä¾‹çš„åˆå§‹åŒ–æ–¹æ³•å®Œæˆä¹‹å‰å°±æ‹¥æœ‰å€¼)
3. å¦‚æœå¤šçº¿ç¨‹åŒæ—¶è®¿é—®lazyï¼Œé‚£ä¹ˆlazyå°±æ— æ³•ä¿è¯åªè¢«åˆå§‹åŒ–ä¸€æ¬¡
4. å½“ç»“æ„ä½“åŒ…å«ä¸€ä¸ªå»¶è¿Ÿå­˜å‚¨å±æ€§æ—¶ï¼Œåªæœ‰varæ‰èƒ½è®¿é—®å»¶è¿Ÿå­˜å‚¨å±æ€§(å› ä¸ºå»¶è¿Ÿå±æ€§åˆå§‹åŒ–æ—¶éœ€è¦æ”¹å˜ç»“æ„ä½“çš„å†…å­˜)

```swift
class Car {
   init() {
      print("Car init!")
   }
   func run() {
      print("Car is running!")
   }
}
class Person {
   lazy var car = Car()
init() {
      print("Person init!")
   }
   func goOut() {
      car.run()
   }
}
let p = Person()
print("-------------")
p.goOut()
 
 
// æ‰“å°ç»“æœ
// Person init!
// --------------
// Car init!
// Car is running!
 
 
// ç»å…¸çš„è®¾ç½®å›¾ç‰‡çš„æ–¹æ³•
class PhotoView {
   lazy var image: Image = {
      let url = "https://www.baidu.com/xx.png"
      let data = Data(url: url)
      return Image(data: data)
   }() // ä¸€ä¸ªé—­åŒ…è¡¨è¾¾å¼ï¼Œå¹¶ä¸æ˜¯è®¡ç®—å±æ€§çš„getæ–¹æ³•
}
```

### å±æ€§è§‚å¯Ÿå™¨

1. å¯ä»¥ä¸ºélazyçš„varå­˜å‚¨å±æ€§è®¾ç½®å±æ€§è§‚å¯Ÿå™¨
2. willSetä¼šä¼ é€’æ–°å€¼ï¼Œé»˜è®¤å«newValue
3. didSetä¼šä¼ é€’æ—§å€¼ï¼Œé»˜è®¤å«oldValue
4. åœ¨åˆå§‹åŒ–ä¸­è®¾ç½®å±æ€§å€¼ä¸ä¼šè§¦å‘willSetå’ŒdidSet
5. 

## è®¡ç®—å±æ€§

1. setä¼ å…¥çš„æ–°å€¼é»˜è®¤å«åšnewValueï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰

2. åªè¯»è®¡ç®—å±æ€§: åªæœ‰getï¼Œæ²¡æœ‰set

3. è®¡ç®—å±æ€§åªèƒ½ç”¨varï¼Œä¸èƒ½ç”¨let

4. æšä¸¾çš„rawValueæœ¬è´¨å°±æ˜¯è®¡ç®—å±æ€§,åªè¯»è®¡ç®—å±æ€§

   ```swift
   enum Season: Int {
      case spring = 1,summer,autumn,winter
    
    
      var rawValue: Int {
        switch self {
          case .sprint:
            return 11
          case .summer:
            return 22
          case .autumn:
            return 33
          case .winter:
            return 44
        }
      }
   }
   var s = Season.sumer
   print(s.rawValue) // 22
   ```

## ç±»å‹å±æ€§

1. ä¸¥æ ¼æ¥è¯´ï¼Œå±æ€§å¯ä»¥åˆ†ä¸º
   1. å®ä¾‹å±æ€§ï¼Œåªèƒ½é€šè¿‡å®ä¾‹å»è®¿é—®
      1. å­˜å‚¨å®ä¾‹å±æ€§: å­˜å‚¨åœ¨å®ä¾‹çš„å†…å­˜ä¸­ï¼Œæ¯ä¸ªå®ä¾‹éƒ½æœ‰ä¸€ä»½
      2. è®¡ç®—å®ä¾‹å±æ€§
   2. ç±»å‹å±æ€§ï¼šåªèƒ½é€šè¿‡ç±»å‹å»è®¿é—®
      1. å­˜å‚¨ç±»å‹å±æ€§: æ•´ä¸ªç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå°±åªæœ‰1ä»½å†…å­˜(ç±»ä¼¼äºå…¨å±€å˜é‡)
      2. è®¡ç®—ç±»å‹å±æ€§
2. å¯ä»¥é€šè¿‡staticå®šä¹‰ç±»å‹å±æ€§
3. å¦‚æœæ˜¯ç±»ï¼Œä¹Ÿå¯ä»¥ç”¨å…³é”®å­—classå®šä¹‰ç±»å‹å±æ€§

```swift
struct Shape {
   var width: Int = 0
   static var count: Int = 0
}
var s = Shape()
// s.count = 10 // æŠ¥é”™ï¼Œç±»å‹å±æ€§åªèƒ½é€šè¿‡ç±»å‹å»è®¿é—®
Shape.count = 10
print(Shape.count) // 10
```

### ç±»å‹å±æ€§ç»†èŠ‚

1. ä¸åŒäº**å­˜å‚¨å®ä¾‹å±æ€§**ï¼Œä½ å¿…é¡»ç»™**å­˜å‚¨ç±»å‹å±æ€§**è®¾å®šåˆå§‹å€¼

   1. å› ä¸ºç±»å‹æ²¡æœ‰åƒå®ä¾‹é‚£æ ·çš„initåˆå§‹åŒ–å™¨æ¥åˆå§‹åŒ–å­˜å‚¨å±æ€§

2. å­˜å‚¨ç±»å‹å±æ€§

   é»˜è®¤å°±æ˜¯lazyï¼Œä¼šåœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„æ—¶å€™æ‰åˆå§‹åŒ–

   1. å°±ç®—è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œä¿è¯åªä¼šåˆå§‹åŒ–ä¸€æ¬¡
   2. **å­˜å‚¨ç±»å‹å±æ€§**å¯ä»¥æ˜¯let(å› ä¸ºä»–ä¸æ˜¯å®ä¾‹ï¼Œå®ä¾‹çš„åˆå§‹åŒ–æ–¹æ³•å®Œæˆä¹‹å‰è¦æ±‚letæ‹¥æœ‰å€¼)

3. æšä¸¾ç±»å‹ä¹Ÿå¯ä»¥å®šä¹‰ç±»å‹å±æ€§(å­˜å‚¨ç±»å‹å±æ€§ã€è®¡ç®—ç±»å‹å±æ€§)

4. å•ä¾‹æ¨¡å¼

   ```swift
   // å•ä¾‹çš„å†™æ³•
   class FileManager {
      public static let shared = FileManager()
      private init() { }
      func open() {
     
      }
   }
   FileManager.shared.open()
   ```

### å­˜å‚¨ç±»å‹å±æ€§

å…¨å±€å˜é‡åœ¨å†…å­˜ä¸­æ˜¯ä¸€ç›´å­˜åœ¨çš„ï¼Œè¿™æ˜¯cè¯­è¨€çš„ç‰¹æ€§

```swift
int num1 = 10
int num2 = 11
int num3 = 12
// å¯¹åº”æ±‡ç¼–,3ä¸ªå€¼æŒ¨ç€åœ¨å…¨å±€åŒºåŸŸ
0x10001956 movq $0xa, 0xc34f(%rip)  // num1åœ°å€å€¼: rip+0xc34f = 0x10000DCB0
0x10001961 movq $0xb, 0xc34c(%rip)  // num2åœ°å€å€¼: rip+0xc34c = 0x10000DCB8
0x1000196c movq $0xc, 0xc349(%rip)  // num3åœ°å€å€¼: rip+0xc349 = 0x10000DCc0
0x10001977
 
 
ä¿®æ”¹ä»£ç 2ä»£ï¼š
int num1 = 10
class Car {
   static var count = 1 // çœ‹æ±‡ç¼–çŸ¥é“è¿™é‡Œè°ƒç”¨äº†swift_onceï¼Œswift_onceé‡Œé¢åˆè°ƒç”¨äº†dispatch_onceï¼Œä¿è¯äº†åªåˆå§‹åŒ–äº†ä¸€æ¬¡å’Œçº¿ç¨‹å®‰å…¨
}
Car.count = 11
int num3 = 12
// çœ‹æ±‡ç¼–ï¼Œ3ä¸ªå€¼æŒ¨ç€åœ¨å…¨å±€åŒºåŸŸï¼Œæ‰€ä»¥å¯çŸ¥é“ï¼Œstatic var countä»å†…å­˜è§’åº¦çœ‹ï¼Œæ˜¯åœ¨å…¨å±€å˜é‡ï¼Œåªæ˜¯å®šä¹‰åœ¨ç±»é‡Œï¼ŒåŠ ä¸Šäº†è®¿é—®é™åˆ¶æ§åˆ¶ï¼Œåªèƒ½Car.countè®¿é—®ï¼Œä¸èƒ½ç›´æ¥countè®¿é—®
movq $0xa, 0xc7fd(%rip)  // ç®—å‡ºæ¥çš„å€¼æ˜¯0x10000DDD0
...
movq $0xb, (%rax)  // å¯çŸ¥ï¼Œå°†11ç»™äº†raxå­˜å‚¨çš„é‚£ä¸ªå€¼(è¿™ä¸ªå€¼ä¹Ÿæ˜¯ä¸ªå†…å­˜åœ°å€)æ‰€æŒ‡å‘ä½ç½®ï¼Œåœ¨æ±‡ç¼–è¯¥å¥æ‰“ä¸Šæ–­ç‚¹ï¼Œæ§åˆ¶å°è¾“å…¥:register read rax å¾—rax = 0x10000ddd8
...
movq $0xa, 0xc7fd(%rip)  // ç®—å‡ºæ¥çš„å€¼æ˜¯0x10000DDE0
```

# å¯é€‰é“¾(Optional Chaining)

å¯é€‰é¡¹çš„è¿”å›å€¼ä¹Ÿæ˜¯å¯é€‰å‹

```swift
class Person {
   
    var name: String = ""
    var dog: Dog = Dog()
    var car: Car? = Car()
    func age() -> Int { 18 }
    func eat() { print("Person eat") }
    subscript(index: Int) -> Int { index }
}

var person: Person? = Person()

var age1 = person!.age() // Int
var age2 = person?.age() // Int?
var name = person?.name // String?
var index = person?[6] // Int?
var res = person?.eat() // ()?
```

1. å¦‚æœå¯é€‰é¡¹ä¸ºnilï¼Œè°ƒç”¨æ–¹æ³•ã€ä¸‹æ ‡ã€å±æ€§å¤±è´¥ï¼Œç»“æœä¸ºnil
2. å¦‚æœå¯é€‰é¡¹ä¸ä¸ºnilï¼Œè°ƒç”¨æ–¹æ³•ã€ä¸‹æ ‡ã€å±æ€§æˆåŠŸï¼Œç»“æœä¼šè¢«åŒ…è£…æˆå¯é€‰é¡¹ 
3.  å¦‚æœç»“æœæœ¬æ¥å°±æ˜¯å¯é€‰é¡¹ï¼Œä¸ä¼šè¿›è¡Œå†æ¬¡åŒ…è£…
4. å¯é€‰é¡¹è°ƒç”¨æ— è¿”å›å€¼çš„æ–¹æ³•çš„ç»“æœå¯ä»¥ä¸ºnilï¼Œä¹Ÿå¯ä»¥ä¸ºå¯é€‰å‹ç©ºå…ƒç»„()?ï¼Œæ¯”å¦‚person?.eat()ï¼Œå½“personä¸ºnilï¼Œåˆ™ç»“æœä¸ºnilï¼Œè‹¥personä¸ä¸ºnilï¼Œåˆ™è¿”å›å€¼ä¸ºå¯é€‰å‹ç©ºå…ƒç»„()?ã€‚å¯é€‰é¡¹ç»‘å®šè¿ç”¨çš„å°±æ˜¯è¿™ç§åŸç†ï¼š
5. å¯é€‰é“¾å¯ä»¥ç†è§£ä¸ºåœ¨å¯é€‰é¡¹åè°ƒç”¨å±æ€§ï¼Œä¸‹æ ‡å’Œæ–¹æ³•
6. å¤šä¸ªï¼Ÿå¯ä»¥é“¾æ¥åœ¨ä¸€èµ·ï¼Œå¦‚æœé“¾ä¸­ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ä¸ºnilï¼Œé‚£ä¹ˆæ•´ä¸ªé“¾å°±ä¼šè°ƒç”¨å¤±è´¥

```swift
var num2: Int? = nil
num2? = 10 // è¿™é‡Œåˆ¤æ–­num2æ˜¯nilï¼Œæ‰€ä»¥ä¸ä¼šè¿›è¡Œåé¢çš„èµ‹å€¼ï¼Œnum2è¿˜æ˜¯å¯é€‰nil
```

# åè®®

1. åè®®å¯ä»¥ç”¨æ¥å®šä¹‰æ–¹æ³•ã€å±æ€§ã€ä¸‹æ ‡çš„å£°æ˜ï¼Œåè®®å¯ä»¥è¢«æšä¸¾ã€ç»“æ„ä½“ã€ç±»éµå®ˆ(å¤šä¸ªåè®®ç”¨é€—å·éš”å¼€)
2. åè®®ä¸­å®šä¹‰æ–¹æ³•æ—¶ä¸èƒ½æœ‰é»˜è®¤å‚æ•°å€¼
3. é»˜è®¤æƒ…å†µä¸‹ï¼Œåè®®ä¸­å®šä¹‰çš„å†…å®¹å¿…é¡»å…¨éƒ¨éƒ½å®ç°
4. åè®®ä¸­å®šä¹‰å±æ€§æ—¶å¿…é¡»ç”¨varå…³é”®å­—
5. åè®®å®šä¹‰getã€setï¼Œç”¨varå­˜å‚¨å±æ€§æˆ–getã€setè®¡ç®—å±æ€§å»å®ç°
6. åè®®å®šä¹‰getï¼Œç”¨ä»»ä½•å±æ€§éƒ½å¯ä»¥å®ç°
7. Optional
   1. åœ¨Ocä¸­æœ‰ @optional å…³é”®å­—ï¼Œä½†åœ¨ swift ä¸­ä½¿ç”¨ optional å…³é”®å­—æ—¶ï¼Œä¼šæœ‰è­¦å‘Šï¼Œæç¤ºæˆ‘ä»¬è¦ä½¿ç”¨@objcï¼Œè¿™å¾ˆä¸ swiftã€‚è€Œä¸”ï¼Œè¢«æ ‡è®°ä¸º@objc çš„åè®®ï¼Œåªèƒ½è¢« class å®ç°ï¼Œä¸èƒ½ç”¨äºç»“æ„ä½“å’Œæšä¸¾ã€‚
   2. å¯é€šè¿‡æ‰©å±•åè®®å®ç°Optionalï¼Œåœ¨åè®®ä¸­å®šä¹‰æ–¹æ³•ï¼Œåœ¨æ‰©å±•åè®®ä¸­ç»™å‡ºé»˜è®¤å®ç°ï¼Œè€Œæœ‰é»˜è®¤å®ç°çš„åè®®æ–¹æ³•å°±æ˜¯å¯é€‰æ–¹æ³•ã€‚
8. ä¸€ä¸ªåè®®å¯ä»¥ç»§æ‰¿å…¶ä»–åè®®

```swift
protocol Drawable {
   func draw()
   var x: Int { get set}  // è¯»å†™å±æ€§ï¼Œå¹¶ä¸æ˜¯è¯´æ˜¯è®¡ç®—å±æ€§,å®ç°å¯ä»¥å­˜å‚¨å¯ä»¥è®¡ç®—
   var y: Int { get }  // åªè¯»å±æ€§ï¼Œå¿…é¡»ç”¨varï¼Œå› ä¸ºå¦‚æœå®ç°æ˜¯è®¡ç®—å±æ€§ï¼Œè®¡ç®—é‡Œå¯èƒ½è¿”å›çš„å€¼æ˜¯è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šçš„ï¼Œå°±ä¸èƒ½ç”¨let
   subscript(index: Int) -> Int { get set}
}
class Person1ï¼šDrawable {
   var x: Int = 0
   let y: Int = 0
   func draw() {
     print("Person draw")
   }
   subscript(index: Int) -> Int {
      set {}
      get { index }
   }  
}
class Person2ï¼šDrawable {
   var x: Int {
      set {  }
      get { 0 }
   }
   let y: Int { 0 }
   func draw() {
     print("Person draw")
   }
   subscript(index: Int) -> Int {
      set {}
      get { index }
   }  
}
```

## staticã€class

1. ä¸ºäº†ä¿è¯é€šç”¨ï¼Œåè®®ä¸­å¿…é¡»ç”¨staticå®šä¹‰ç±»å‹æ–¹æ³•ï¼Œç±»å‹å±æ€§ï¼Œç±»å‹ä¸‹æ ‡
2. å®ç°æ–¹å¦‚æœå…è®¸å­ç±»é‡å†™ï¼Œå°±å†™æˆclassï¼Œä¸å…è®¸å°±å†™æˆstatic
3. å€¼ç±»å‹(æšä¸¾ã€ç»“æ„ä½“)ä¸æ”¯æŒç»§æ‰¿ï¼Œåªæœ‰ç±»æ”¯æŒç»§æ‰¿

```swift
protocol Drawable {
    
  static func draw()
}
class Person: Drawable {
   
    class func draw() {
      print("Person draw")
    }
}
class Student: Person {
    
    override class func draw() {  // å¦‚æœPersonæ˜¯ç”¨ staticï¼Œä¼šæŠ¥é”™Cannot override static method
        print("Student draw")
    }
}
struct Circle: Drawable {
    
    static func draw() {  // åªæœ‰ç±»èƒ½ç”¨class,åªæœ‰ç±»æœ‰ç»§æ‰¿
        print("Circle draw")
    }
}
```

## mutating

1. åªæœ‰å°†åè®®ä¸­çš„å®ä¾‹æ–¹æ³•æ ‡è®°ä¸ºmutatingï¼Œæ‰å…è®¸ç»“æ„ä½“ã€æšä¸¾çš„å…·ä½“å®ç°ä¿®æ”¹è‡ªèº«å†…å­˜ï¼Œç±»åœ¨å®ç°æ–¹æ³•æ—¶ä¸ç”¨åŠ mutatingï¼Œæšä¸¾ã€ç»“æ„ä½“æ‰éœ€è¦åŠ mutating,(mutatingæ˜¯åªæœ‰æšä¸¾ã€ç»“æ„ä½“æ‰èƒ½ç”¨)

## initã€initï¼Ÿã€initï¼

1. åè®®ä¸­è¿˜å¯ä»¥å®šä¹‰åˆå§‹åŒ–å™¨ï¼Œéfinalç±»å®ç°æ—¶å¿…é¡»åŠ ä¸Šrequired(finalç±»ä¸èƒ½è¢«ç»§æ‰¿ï¼Œå®ç°å¯ä»¥ä¸ç”¨required)
2. å¦‚æœä»åè®®å®ç°çš„åˆå§‹åŒ–å™¨ï¼Œåˆšå¥½æ˜¯é‡å†™ç±»çˆ¶ç±»çš„æŒ‡å®šåˆå§‹åŒ–å™¨ï¼Œé‚£ä¹ˆè¿™ä¸ªåˆå§‹åŒ–å¿…é¡»åŒæ—¶åŠ requiredã€override
3. åè®®ä¸­å®šä¹‰çš„initï¼Ÿã€initï¼ï¼Œå¯ä»¥ç”¨initã€initï¼Ÿã€initï¼å»å®ç°
4. åè®®ä¸­å®šä¹‰çš„initï¼Œå¯ä»¥ç”¨initã€initï¼å®ç°

```swift
protocol Livable {
   init()
   init?(age:Int)
   init!(no: Int)
}
class Personï¼šLivable {
   required init() { }
   // required init!() {}
 
 
   required init?(age: Int) { }
   // required init!(age: Int) { }
   // required init(age: Int) { }
 
 
   required init!(no: Int) { }
   // required init?(no: Int) { }
   // required init(no: Int) { }
}
```

## åè®®ç»„åˆ

1. åè®®ç»„åˆå¯ä»¥åŒ…å«ä¸€ä¸ªç±»ç±»å‹(æœ€å¤šä¸€ä¸ª)ã€å¤šä¸ªåè®®,ä¸èƒ½æ˜¯ç»“æ„ä½“ã€æšä¸¾ï¼›
2. func fn3(obj: Person & Livable & Runable) { } // æ¥æ”¶åŒæ—¶éµå®ˆLivableã€Runableåè®®ï¼Œå¹¶ä¸”æ˜¯Personæˆ–è€…å…¶å­ç±»çš„å®ä¾‹
3. typealias RealPerson = Person & Livable & Runable

## CaseIterable

1. è®©æšä¸¾éµå®ˆCaseIterableåè®®ï¼Œå¯ä»¥å®ç°éå†æšä¸¾å€¼

```swift
class Person: CaseIterable {
    
    typealias AllCases = [Person]
      
    static var allCases: [Person] { get { [Person(), Person()] } }
}


let person = Person.allCases
print(person.count)
for per in person {
   print(per)
}
 
enum Season: CaseIterable {
   case spring, summer, autumn, winter
}
let seasons = Season.allCases
print(seasons.count)
for season in seasons {
   print(season)
}
```

## CustomStringConvertible

1. éµå®ˆCustomStringConvertibleã€CustomDebugStringConvertibleåè®®ï¼Œå¯ä»¥è‡ªå®šä¹‰å®ä¾‹çš„æ‰“å°å­—ç¬¦ä¸²
2. printè°ƒç”¨çš„æ˜¯CustomStringConvertibleçš„description
3. debugPrintã€æ§åˆ¶å°çš„poè°ƒç”¨çš„æ˜¯CustomDebugStringConvertibleåè®®çš„debugDescription

```swift
class Person: CustomStringConvertible, CustomDebugStringConvertible {
    
    var description: String { "_____CustomStringConvertible____" }
    var debugDescription: String { "_____CustomDebugStringConvertible____" }
}
 
var person = Person()
 
print(person) // _____CustomStringConvertible____
debugPrint(person)  // _____CustomDebugStringConvertible____ // åŒ(lldb)po person
```

## Anyã€AnyObject

1. Swiftæä¾›ç±»2ç§ç‰¹æ®Šçš„ç±»å‹: Anyã€AnyObject
   1. Any: å¯ä»¥ä»£è¡¨ä»»æ„ç±»å‹(æšä¸¾ã€ç»“æ„ä½“ã€ç±»ï¼Œä¹ŸåŒ…æ‹¬å‡½æ•°ç±»å‹)
   2. AnyObject: å¯ä»¥ä»£è¡¨ä»»æ„ç±»ç±»å‹(åœ¨åè®®åé¢å†™ä¸Š: AnyObjectä»£è¡¨åªæœ‰ç±»èƒ½éµå®ˆè¿™ä¸ªåè®®) ï¼ˆprotocol Runable: AnyObject { }ï¼‰

## isã€asï¼Ÿã€asï¼ã€as

1. isç”¨æ¥åˆ¤æ–­æ˜¯å¦ä¸ºæŸç§ç±»å‹ï¼Œasç”¨æ¥åšå¼ºåˆ¶ç±»å‹è½¬æ¢
2. å¯¹äºç™¾åˆ†æ¯”å¯ä»¥è½¬æ¢çš„å°±å¯ä»¥ç›´æ¥ç”¨as

```swift
var stu: Any = 10
(stu as? Student)?.study() // æ²¡æœ‰è°ƒç”¨study
stu = Student()
(stu as? Student)?.study() // è°ƒç”¨study
(stu as! Student).study() // è°ƒç”¨study
 
var data = [Any]()
data.append(Int("123") as Any)
print(data.count)
```

## X.selfã€X.Typeã€AnyClassã€type(of: x)

1. X.selfæ˜¯ä¸€ä¸ªå…ƒç±»å‹(metadata)çš„æŒ‡é’ˆï¼Œmetadataå­˜æ”¾ç€ç±»å‹ç›¸å…³ä¿¡æ¯

2. X.self å±äºX.Typeç±»å‹

3. var p: Person = Person(); var pType: Person.Type = Person.self //çœ‹æ±‡ç¼–å¯çŸ¥pTypeæ”¾ç€8ä¸ªå­—èŠ‚ï¼Œå†…å®¹æ˜¯pçš„å‰é¢8ä¸ªå­—èŠ‚ä¹Ÿå°±æ˜¯ç±»å‹ä¿¡æ¯

4. AnyClasså°±æ˜¯AnyObject.Type

5. var per = Person();var perType = type(of: per); // Person.self çœ‹æ±‡ç¼–å¯çŸ¥å®ƒæ˜¯å°†perçš„å‰é¢8ä¸ªå­—èŠ‚é‡Œçš„å†…å®¹æ‹¿å‡ºæ¥èµ‹å€¼ç»™äº†perTypeï¼Œåº•å±‚å¹¶æ²¡æœ‰åˆ†é…æ ˆç©ºé—´(å‡½æ•°è°ƒç”¨ä¼šåˆ†é…æ ˆç©ºé—´)ï¼Œä¹Ÿæ²¡æœ‰call æ±‡ç¼–æŒ‡ä»¤

6. è™½ç„¶swiftè¯´å¹¶æ²¡æœ‰å‘océ‚£æ ·æ‰€æœ‰çš„ç±»æœ€ç»ˆç»§æ‰¿ä¸€ä¸ªåŸºç±»ï¼Œæ²¡æœ‰çˆ¶ç±»çš„ç±»ï¼Œç§°ä¸º: åŸºç±»ï¼› ä½†æ˜¯é€šè¿‡è°ƒç”¨print(class_getSuperclass(Person.self)!) å¯ä»¥çœ‹åˆ°è™½ç„¶Personæ²¡æœ‰çˆ¶ç±»ï¼Œä½†æ˜¯æ‰“å°ç»“æœæ˜¯Swift_SwiftObject(éšè—çš„åŸºç±»)

7. class_getInstanceSizeï¼šè¡¨ç¤ºå¯¹è±¡å®é™…ç”¨åˆ°çš„å†…å­˜å¤§å°ï¼Œä¹Ÿå°±æ˜¯å­˜å‚¨å±æ€§éœ€è¦çš„æœ€å°å€¼

   class_getSuperclass:è·å–çˆ¶ç±»ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°Personè™½ç„¶æ²¡ç»§æ‰¿ä»»ä½•ç±»ï¼Œä½†å®ƒæœ‰ä¸€ä¸ªè¦éšè—çš„åŸºç±»Swift._SwiftObject

8. type(of: )è·å–å…ƒç±»å‹çš„æŒ‡é’ˆ

```swift
class Person { var age: Int = 0 }
class Student: Person { var no: Int = 0 }
  
var p: Person = Person()
var stu: Student = Student()
var pType: Person.Type = Person.self

var subType: Student.Type = Student.self
pType = Student.self  // ç”±äºStudentç»§æ‰¿è‡ªPersonï¼Œæ‰€ä»¥pType = Student.selfä¹Ÿæˆç«‹ï¼Œå¥½æ¯”å¤šæ€çš„çˆ¶ç±»æŒ‡é’ˆæŒ‡å‘å­ç±»å¯¹è±¡ï¼Œä½†æ˜¯ä¸ç»§æ‰¿è‡ªPersonçš„ç±»ä¸å¯ä»¥è¿™ä¹ˆå†™


var perType = type(of: p) // Person.Self

print(Person.self == perType)  // true
 
print(class_getInstanceSize(Student.self)) // 32,ç±»è‡ªå¸¦16ä¸ªå­—èŠ‚ï¼Œå­˜å‚¨ç±»å‹ä¿¡æ¯å’Œå¼•ç”¨è®¡æ•°
print(class_getSuperclass(Student.self)!) // Person
print(class_getSuperclass(Person.self)!) // _TtCs12_SwiftObject
```

## Self

1. Selfä»£è¡¨å½“å‰ç±»å‹
2. Selfä¸€èˆ¬ç”¨ä½œè¿”å›å€¼ç±»å‹ï¼Œé™å®šè¿”å›å€¼è·Ÿæ–¹æ³•è°ƒç”¨è€…å¿…é¡»æ˜¯åŒä¸€ç±»å‹(ä¹Ÿå¯ä»¥ä½œä¸ºå‚æ•°ç±»å‹)
3. æœ‰ç‚¹ç±»ä¼¼äºOcçš„instanceType(å½“å‰å®ä¾‹çš„ç±»å‹)
4. å¦‚æœSelfç”¨åœ¨ç±»ä¸­ï¼Œè¦æ±‚è¿”å›æ—¶è°ƒç”¨çš„åˆå§‹åŒ–å™¨æ˜¯requiredçš„

```swift
protocol Runable {
   func test() -> Self
}
class Person: Runable {
    
    var age = 1
    class var count: Int {
        get {
            return 2
        }
    }
   required init(){ } // å¦‚æœSelfç”¨åœ¨ç±»ä¸­ï¼Œè¦æ±‚è¿”å›æ—¶è°ƒç”¨çš„åˆå§‹åŒ–æ˜¯requiredçš„
//   func test() -> Self {
//    Person() as! Self // ä¼šæŠ¥é”™ï¼Œå› ä¸ºå¦‚æœæ˜¯å­ç±»è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„è¯ï¼Œè¿”å›çš„å°±ä¸åº”è¯¥æ˜¯Personå®ä¾‹äº†
//     type(of: self).init()
//   }
    func test() -> Self {
        
        print(self.age, Self.count)
        return type(of: self).init()
    }
}
 
 
class Student: Person {
    
    class override var count: Int {
        get {
            return 22
        }
    }
    
    required init() {
        super.init()
        self.age = 11
    }
}

var stu = Student()
print(stu.test()) // 11 22 SwiftTest.Student

var per = Person()
print(per.test()) // 1 2 SwiftTest.Person
```

5. å®Œå…¨ç›¸åŒçš„å‡ ç§è°ƒç”¨

```swift
class Person {
   static var age = 0
   static func run() { }
}
Person.age = 10
Person.run()
 
 
// å’Œä¸Šé¢å®Œå…¨ç›¸åŒ
Person.self.age = 10
Person.self.run()
 
 
// ä¸‹é¢å››å¥äº§ç”Ÿçš„æ±‡ç¼–ä¸€æ ·
var p1 = Person.init()
var p2 = Person.self.init()
var p3 = Person.self()
var p4 = Person()
```

# é”™è¯¯å¤„ç†

## é”™è¯¯ç±»å‹

å¼€å‘è¿‡ç¨‹å¸¸è§çš„é”™è¯¯

1. è¯­æ³•é”™è¯¯
2. é€»è¾‘é”™è¯¯
3. è¿è¡Œæ—¶é”™è¯¯(å¯èƒ½ä¼šå¯¼è‡´é—ªé€€ï¼Œä¸€èˆ¬ä¹Ÿå«åšå¼‚å¸¸)

## è‡ªå®šä¹‰é”™è¯¯

 Swiftä¸­å¯ä»¥é€šè¿‡Erroråè®®è‡ªå®šä¹‰è¿è¡Œæ—¶çš„é”™è¯¯ä¿¡æ¯ï¼Œä¸€æ—¦æŠ›å‡ºå¼‚å¸¸ï¼Œå®ƒä½œç”¨åŸŸèŒƒå›´å†…ä¸‹çš„æ‰€æœ‰ä»£ç éƒ½ä¸ä¼šæ‰§è¡Œ

```swift
func test(){
   print("1")
   do {
      print("2")
      print(try divide(20,0))
      print("3")
   } catch let SomeError.illegalArg(msg) {
      print("å‚æ•°å¼‚å¸¸:",mes)
   } catch let SomeError.outOfBounds(size,index) {
      print("ä¸‹æ ‡è¶Šç•Œ:","size=\(size)","index=\(index)")
   } catch SomeError.outOfMemory {
      print("å†…å­˜æº¢å‡º")
   } catch {
      print("å…¶ä»–é”™è¯¯")
   }
  
   // æˆ–è€…
   //do {
   //  
   //} catch let error as SomeError {
   //  
   //}
  // åˆæˆ–è€…
  // do {
  //  
  // } catch is SomeError {
  //  
  // }
   print("4")
}
test()
// 1
// 2
// å‚æ•°å¼‚å¸¸: 0ä¸èƒ½ä½œä¸ºé™¤æ•°
// 4
 
 
func test1() throws {
   print("1")
   print(try divide(20,0))
   print("2")
}
try test1()
```

## å¤„ç†Error

å¤„ç†Errorçš„2ç§æ–¹å¼

1. é€šè¿‡do-catchæ•æ‰Error, doå¯ä»¥ä¸è·Ÿdo-catchä¸€èµ·ç”¨ï¼Œå¯ä»¥å•ç‹¬ä½¿ç”¨,do{ }  // å®šä¹‰ä¸€ä¸ªå±€éƒ¨ä½œç”¨åŸŸ è·Ÿ OCçš„ä¸€ä¸ª{ }ä¸€æ ·
2. ä¸æ•æ‰Errorï¼Œåœ¨å½“å‰å‡½æ•°å¢åŠ throwså£°æ˜,Errorå°†è‡ªåŠ¨æŠ›ç»™ä¸Šå±‚å‡½æ•°
3. å¦‚æœæœ€é¡¶å±‚å‡½æ•°(mainå‡½æ•°)ä¾ç„¶æ²¡æœ‰æ•æ‰Errorï¼Œé‚£ä¹ˆç¨‹åºå°†ç»ˆæ­¢

## try?ã€try!

```swift
func test(){
   print("1")
   var result1 = try? divide(20,10) // Optional(2), Int?
   var result2 = try? divide(20,0) // nil
   var result3 = try? divide(20,10) // 2, Int
   print("2")
 
 
   // aå’Œbç­‰ä»·
   var a = try? divide(20, 0)
   var b: Int?
   do {
      b = try divide(20, 0)
   } catch { }
}
test()
```

## rethrows

rethrowsè¡¨æ˜: å‡½æ•°æœ¬èº«ä¸ä¼šæŠ›å‡ºé”™è¯¯ï¼Œä½†è°ƒç”¨é—­åŒ…å‚æ•°æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆå®ƒä¼šå°†é”™è¯¯å‘ä¸ŠæŠ›

```swift
// æ¥æ”¶ä¸€ä¸ªä¼šæŠ›å‡ºå¼‚å¸¸çš„æ–¹æ³•ï¼Œ
func exec(_ fn: (Int, Int) throws -> Int, _ num1: Int, _ num2: Int) rethrows {
   print(try fn(num1,num2))
}
try exec(divide, 20, 0)
```

##defer

1. deferè¯­å¥: ç”¨æ¥å®šä¹‰ä»¥ä»»ä½•æ–¹å¼(æŠ›é”™è¯¯ã€returnç­‰)ç¦»å¼€ä»£ç å—å‰å¿…é¡»è¦æ‰§è¡Œçš„ä»£ç 
2. deferè¯­å¥å°†å»¶è¿Ÿè‡³å½“å‰ä½œç”¨åŸŸç»“æŸä¹‹å‰æ‰§è¡Œ
3. deferè¯­å¥çš„æ‰§è¡Œé¡ºåºä¸å®šä¹‰é¡ºåºç›¸å(ä»¥å¤§æ‹¬å·ä»ä¸‹å¾€ä¸Šæ‰§è¡Œ)

```swift
class Person {
   static func run() {
    
    defer {
        print(1)
        print(2)
        print(3)
    }
    defer {
        print(11)
        print(22)
        print(33)
    }
     print("hhhhhhh")
   }
}
Person.run()
// æ‰“å°
//hhhhhhh
//11
//22
//33
//1
//2
//3
```

##assert(æ–­è¨€)

1. å¾ˆå¤šç¼–ç¨‹è¯­è¨€éƒ½æœ‰æ–­è¨€æœºåˆ¶: ä¸ç¬¦åˆæŒ‡å®šæ¡ä»¶å°±æŠ›å‡ºè¿è¡Œæ—¶é”™è¯¯ï¼Œå¸¸ç”¨äºè°ƒè¯•(Debug)é˜¶æ®µçš„æ¡ä»¶åˆ¤æ–­
2. é»˜è®¤æƒ…å†µä¸‹ï¼ŒSwiftçš„æ–­è¨€åªä¼šåœ¨Debugæ¨¡å¼ä¸‹ç”Ÿæ•ˆï¼ŒReleaseæ¨¡å¼ä¸‹ä¼šå¿½ç•¥
3. ä½†æ˜¯ä¸èƒ½é€šè¿‡do-catchæ•æ‰
4. ä¿®æ”¹Swift Flagesæ–­è¨€çš„é»˜è®¤è¡Œä¸º
   1. åœ¨Build Settingä¸‹æœç´¢other Swiftï¼Œ
   2. åœ¨Other Swift Flagesä¸‹çš„Debugä¸‹è¾“å…¥-assert-config Release : å¼ºåˆ¶å…³é—­æ–­è¨€
   3. åœ¨Other Swift Flagesä¸‹çš„Releaseä¸‹è¾“å…¥-assert-configDebug : å¼ºåˆ¶å¼€å¯æ–­è¨€

##fatalError

1. å¦‚æœé‡åˆ°ä¸¥é‡é—®é¢˜ï¼Œå¸Œæœ›ç»“æŸç¨‹åºè¿è¡Œæ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨fatalErrorå‡½æ•°æŠ›å‡ºé”™è¯¯(è¿™æ˜¯æ— æ³•é€šè¿‡do-catchæ•æ‰çš„é”™è¯¯)
2. ä½¿ç”¨äº†fatalErrorå‡½æ•°ï¼Œå°±ä¸éœ€è¦å†å†™return
3. åœ¨æŸäº›ä¸å¾—ä¸å®ç°ï¼Œä½†ä¸å¸Œæœ›åˆ«äººè°ƒç”¨çš„æ–¹æ³•ï¼Œå¯ä»¥è€ƒè™‘å†…éƒ¨ä½¿ç”¨fatalErrorå‡½æ•°
   1. æ¯”å¦‚è¯´å­ç±»ç»§æ‰¿çˆ¶ç±»çš„required initæ–¹æ³•æ—¶ï¼Œä½†æ˜¯ä¸å¸Œæœ›åˆ«äººè°ƒç”¨ï¼Œå¯ä»¥åœ¨inité‡Œé¢å†™fatalErrorå‡½æ•°

# æ³›å‹(Generic)

1. æ³›å‹å¯ä»¥å°†ç±»å‹å‚æ•°åŒ–ï¼Œæé«˜ä»£ç å¤ç”¨ç‡ï¼Œå‡å°‘ä»£ç é‡
2. æ³›å‹å‡½æ•°èµ‹å€¼ç»™å˜é‡
3. æ³›å‹ç±»å‹

```swift
 var n1 = 10
 var n2 = 20
// æ³›å‹å¯ä»¥å°†ç±»å‹å‚æ•°åŒ–
 func swapValues<T>(_ a: inout T, _ b: inout T) {
    (a,b) = (b,a)
 }
 swapValues(&n1,&n2) // ä»æ±‡ç¼–å¯ä»¥çœ‹å‡ºï¼Œè™½ç„¶æ³›å‹çš„ç±»å‹ä¸åŒï¼Œä½†æ˜¯å¯ä»¥çœ‹å‡ºä¸¤ä¸ªå‡½æ•°çš„åœ°å€éƒ½æ˜¯åŒä¸€ä¸ªï¼Œè°ƒç”¨çš„åŒä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥åŒºåˆ†ä¸åŒç±»å‹è¿›è¡Œè®¡ç®—ï¼Œä¸»è¦æ˜¯é metadataä¹Ÿå°±æ˜¯å…ƒç±»å‹æ¥å®ç°çš„
  
 // æ³›å‹å‡½æ•°èµ‹å€¼ç»™å˜é‡
 func test<T1,T2>(_ t1:T1,_ t2:T2) { }
 var fn: (Int,Double) -> () = test
  
  
 // æ³›å‹ç±»å‹
 class Stack<E> {
    var elements = [E]()
    func push(_ element: E) { elements.append(element) }
    func pop() -> E { elements.removeLast() }
 }
 // ç»§æ‰¿ä¸€ä¸ªæ³›å‹ç±»å‹
 class SubStack<E>: Stack<E> { }
  
  
 enum Score<T> {
    case point(T)
    case grade(String)
 }
 let score3 = Score<Int>.grade("A") // å³ä½¿è¿™é‡Œæ²¡æœ‰ç”¨pointï¼Œä¹Ÿéœ€è¦æŒ‡æ˜è¿™ä¸ªTæ˜¯ä»€ä¹ˆç±»å‹ï¼Œä¸ç„¶æ— æ³•åˆ†é…åˆé€‚çš„å†…å­˜
```

## å…³è”ç±»å‹

1. å…³è”ç±»å‹çš„ä½œç”¨: ç»™åè®®ä¸­ç”¨åˆ°çš„ç±»å‹å®šä¹‰ä¸€ä¸ªå ä½åç§°(associatedtype)
2. åè®®ä¸­å¯ä»¥æ‹¥æœ‰å¤šä¸ªå…³è”ç±»å‹

```swift
protocol Stackable {
   associatedtype Element // å…³è”ç±»å‹
   mutating func push(_ element: Element)
   mutating func pop() -> Element
   func top() -> Element
   func size() -> Int
 }
  
  
 // å®ç°
 class StringStack: Stackable {
     // ç»™å…³è”ç±»å‹è®¾å®šçœŸå®ç±»å‹
     // typealias Element = String  // å¯ä»¥çœç•¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ¤æ–­å‡ºæ¥,è¿™é‡Œçš„Stringä¹Ÿå¯ä»¥æ”¹æˆæŒ‡å®šä¸ºæ³›å‹
     var elements = [String]()
    func push(_ element: String) {   }
     func pop() -> String { "" }
     func top() -> String { elements.last! }
     func size() -> Int { elements.count }
 }

// å®ç°
class TStack<T>: Stackable {
    
    typealias Element = T 
  
    var elements = [T]()
    func push(_ element: T) {   }
    func pop() -> T { elements.first!}
    func top() -> T { elements.last! }
    func size() -> Int { elements.count }
}
```

## ç±»å‹çº¦æŸ

```swift
// è¿™ä¸ªæ³›å‹éµå®ˆRunableåè®®å¹¶ä¸”æ˜¯Personçš„å­ç±»
func swapValue<T: Person & Runable>(_ a: inout T, _ b: inout T) { }

// å¤šä¸ªæ³›å‹ç»“åˆwhereçš„å¤æ‚çº¦æŸï¼š
// S1å’ŒS2ä¸¤ä¸ªæ³›å‹éƒ½éµå®ˆStackableåè®®ï¼Œå¹¶ä¸”S1å’ŒS2çš„Elementå±äºåŒä¸€ç±»å‹ï¼ŒS1çš„Elementéµå®ˆHashableåè®®
func equal<S1: Stackable, S2: Stackable>(_ s1: S1, _ s2: S2) -> Bool where S1.Element == S2.Element, S1.Element : Hashable{
    return true
}

```

### ç±»å‹çº¦æŸæ³¨æ„ç‚¹

1. å¦‚æœåè®®ä¸­æœ‰å…³è”ç±»å‹ï¼Œé‚£ä¹ˆå°±ä¸èƒ½ç”¨åšè¿”å›å€¼æˆ–è€…å‚æ•°ï¼Œå› ä¸ºæ— æ³•åœ¨ç¼–è¯‘æ—¶ç¡®å®šå…³è”ç±»å‹çš„å€¼

```swift
 protocol Runable {
   associatedtype Speed // å…³è”ç±»å‹
    var speed: Speed { get }
 }
  
  
 // å®ç°
 class Person: Runable  {
      
    var speed: Double { 1.1 }
 }

// å®ç°
class Car: Runable {
    
    var speed: Double { 100 }
}

// æŠ¥é”™-æ— æ³•åœ¨ç¼–è¯‘æ—¶ç¡®å®šå…³è”ç±»å‹çš„å€¼
func get(_ type: Int) -> Runable { // å¦‚æœåè®®ä¸­æœ‰å…³è”ç±»å‹ï¼Œé‚£ä¹ˆå°±ä¸èƒ½ç”¨åšè¿”å›å€¼æˆ–è€…å‚æ•°ï¼Œ

    if type == 0 {
        return Person()
    }
    return Car()
}

// æŠ¥é”™-æ— æ³•åœ¨ç¼–è¯‘æ—¶ç¡®å®šå…³è”ç±»å‹çš„å€¼
func get(_ type: Runable)  {
    
}

// æ–¹æ¡ˆ1ä¿®æ”¹,ä»¥ä¸‹ä¸ä¼šæŠ¥é”™
func get<T: Runnable>(_ type: Int) -> T {
    if type == 0 {
        return Person() as! T
        
    }
    return Car() as! T
    
}
var r2: Car = get(1) // è¿™é‡Œçš„Carä¼šæŠ¥å‘Šç¼–è¯‘å™¨Speedæ˜¯ä»€ä¹ˆç±»å‹(Int)ï¼Œè°ƒç”¨è°ƒç”¨getçš„æ—¶å€™ï¼Œå‘Šè¯‰getéµå®ˆRunnableçš„Tè¿™é‡Œæ˜¯Car

// æ–¹æ¡ˆ2ä¿®æ”¹,ä½¿ç”¨ä¸é€æ˜ç±»å‹some, ä½†æ˜¯ä»–é™åˆ¶åªèƒ½è¿”å›ä¸€ç§ç±»å‹
func get(_ type: Int) -> some Runnable { // ç”±äºé™åˆ¶åªè¿”å›ä¸€ç§ç±»å‹ï¼Œå¦‚æœæœ‰Personåˆæœ‰Carå°±ä¼šæŠ¥é”™return Car()

    return Car()  
}
```

### someçš„ä½¿ç”¨

1. ä¸é€æ˜ç±»å‹someï¼Œä½†æ˜¯ä»–é™åˆ¶åªèƒ½è¿”å›ä¸€ç§ç±»å‹
2. someé™¤äº†ç”¨åœ¨è¿”å›å€¼ç±»å‹ä¸Šï¼Œä¸€èˆ¬è¿˜å¯ä»¥ç”¨åœ¨å±æ€§ç±»å‹ä¸Š

```swift
protocol Runnable {
    
    associatedtype Speed
}

class Dog: Runnable {
    
    typealias Speed = Double
}

class Person {
    
    var pet: some Runnable {
        return Dog()
    }
}
```

# æ±‡ç¼–åˆ†æStringã€Arrayåº•å±‚

## String

1. ä¸€ä¸ªStringå˜é‡å ç”¨å¤šå°‘å†…å­˜ï¼Ÿ
2. ä¸€ä¸ªé•¿Stringå’Œä¸€ä¸ªçŸ­Stringï¼Œåº•å±‚å­˜å‚¨æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ
3. å¦‚æœå¯¹Stringè¿›è¡Œæ‹¼æ¥æ“ä½œï¼ŒStringå˜é‡çš„å­˜å‚¨ä¼šå‘é€ä»€ä¹ˆå˜åŒ–ï¼Ÿ

![å†…å­˜åœ°å€](/Swiftå…¥é—¨åˆ°ç²¾é€šç¬”è®°/å†…å­˜åœ°å€.png)

```swift
var str1 = "0123456789"

print(Mems.memStr(ofVal: &str1))

// é€šè¿‡æ±‡ç¼–çŸ¥é“ç”¨äº†16ä¸ªå­—èŠ‚å­˜å‚¨è¿™ä¸ªstr1ï¼Œé€šè¿‡æ‰“å°åœ°å€çœ‹è¯¥åœ°å€çš„å†…å®¹ï¼ŒçŸ¥é“Str1åœ°å€ä¸‹å­˜å‚¨å†…å®¹ä¸ºï¼š// 0x3736353433323130 0xea0000000000003938

// å¯çŸ¥å­˜å‚¨çš„æ˜¯ASCIIç ä¸Šæ•°å­—æ‰€å¯¹åº”çš„å€¼ï¼Œ0xeæ˜¯ä¸€ç§æ ¼å¼ï¼Œè¡¨ç¤ºæ˜¯ç›´æ¥å°†å†…å®¹å­˜å‚¨åœ¨åœ°å€ä¸‹ï¼Œaè¡¨ç¤ºå®é™…å€¼å­˜å‚¨ç”¨äº†å¤šé•¿// æ­¤ç§æŠ€æœ¯ç±»ä¼¼äºOcçš„targer pointer
// çœ‹æ±‡ç¼–Swift.String.init æ–¹æ³•é‡Œæœ‰ä¸€ä¸ªæŒ‡ä»¤: cmpq $0xf, %rsi æ„æ€æ˜¯æ‹¿15å’Œrsiæ¯”è¾ƒé•¿åº¦ï¼Œè¿™ä¸ªrsiå°±æ˜¯å­—ç¬¦ä¸²é•¿åº¦ï¼Œ<=15çš„è¯ï¼Œå†…å®¹ä¼šç›´æ¥å­˜åœ¨16ä¸ªå­—èŠ‚é‡Œå¤´ï¼Œ

// >15çš„è¯æ¯”å¦‚stræ˜¯"0123456789ABCDEF"ï¼Œçœ‹æ±‡ç¼–å¯ä»¥çœ‹è§strå†…å®¹ä¸º0xd000000000000010 0x80000001000056e0 ï¼›ç”±æ±‡ç¼–å¯çŸ¥ å­—ç¬¦ä¸²çš„çœŸå®åœ°å€+0x7FFFFFFFFFFFFFE0 = 0x80000001000056e0(åé¢8ä¸ªå­—èŠ‚) æ‰€ä»¥å­—ç¬¦ä¸²çœŸå®å†…å®¹å­˜æ”¾ä½ç½®æ˜¯0x100005700ï¼Œé€šè¿‡x 0x100005700æŸ¥çœ‹å†…å®¹å¯ä»¥çœ‹åˆ°0x100005700: 30 31 32 33 34 35 36 37 38 39 41 42 43 44 45 46 0123456789ABCDEFï¼›// å¦å¤–ä»0xd000000000000010 0x80000001000056e0 è¿˜å¯ä»¥å¾—çŸ¥ç¬¬ä¸€ä¸ª8ä¸ªå­—èŠ‚ï¼Œçš„æœ€å1ä¸ªå­—èŠ‚ç”¨æ¥å­˜å‚¨å­—ç¬¦ä¸²é•¿åº¦
```

4. é€šè¿‡çœ‹MachOViewé‡Œçš„Section64(_TEXT, _cstring)çš„pFileæ˜¯00005700çš„valueæ˜¯0123456789ABCDEFï¼Œæ˜¯å­—ç¬¦ä¸²çš„çœŸå®åœ°å€ï¼Œæ‰€ä»¥å­—ç¬¦ä¸²æ”¾åœ¨Section64(_TEXT, _cstring)è¿™ä¸ªåŒº(å¸¸é‡åŒº)
5. è™½ç„¶è¯´é€šè¿‡æ±‡ç¼–ï¼Œçœ‹åˆ°çš„æ˜¯0x938e(%rip)å³rip+ä¸€ä¸ªå¾ˆå¤§çš„å€¼, è¿™æ˜¯å› ä¸ºå­—ç¬¦ä¸²çš„è¿™ä¸ªå¸¸é‡åŒºçš„åœ°å€å’Œå…¨å±€åŒºSection64(_DATA _data)çš„åœ°å€å¾ˆè¿‘(å¯ä»¥é€šè¿‡MachOViewçœ‹å‡ºæ¥)
6. ä¸ç®¡è¿™ä¸ªå­—ç¬¦ä¸²å¤šé•¿ï¼ŒçœŸå®åœ°å€éƒ½æ˜¯åœ¨å¸¸é‡åŒºï¼Œåªæ˜¯å°‘äº15çš„æ—¶å€™ï¼ŒStrå­˜å‚¨çš„å†…å®¹å°±ç›´æ¥æ˜¯å¸¸é‡å€¼ï¼Œä¾¿äºè®¿é—®ï¼Œå¤§äº15çš„ï¼Œç”±äº16ä¸ªå­—èŠ‚æ”¾ä¸ä¸‹ï¼Œæ‰€ä»¥stråé¢8ä¸ªå­—èŠ‚å­˜å‚¨çš„æ˜¯å­—ç¬¦ä¸²çš„çœŸå®åœ°å€+0x7FFFFFFFFFFFFFE0ï¼Œå‰é¢8ä¸ªå­—èŠ‚çš„æœ€åä¸€ä¸ªå­—èŠ‚ç”¨æ¥å­˜å‚¨å­—ç¬¦ä¸²é•¿åº¦ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚å¯ä»¥è®¤ä¸ºæ˜¯ä»£è¡¨Strå­˜å‚¨çš„æ˜¯åœ°å€çš„ä¸€ç§æ ‡ç¤ºä½

![Stringåº•å±‚1](/Swiftå…¥é—¨åˆ°ç²¾é€šç¬”è®°/Stringåº•å±‚1.jpeg)

![Stringåº•å±‚2](/Swiftå…¥é—¨åˆ°ç²¾é€šç¬”è®°/Stringåº•å±‚2.jpeg)

###ä»ç¼–ç åˆ°å¯åŠ¨APP

1. ä»å›¾å¯ä»¥çœ‹å‡ºæˆ‘ä»¬å¹³å¸¸ç¼–å†™çš„ä»£ç å¸¸é‡åŒºã€å †åŒºã€ä»£ç åŒºç­‰å†…å­˜éƒ½åœ¨Mach-Oä½ç½®
2. æ‰€ä»¥ä¹Ÿå¯ä»¥é€šè¿‡çœ‹mach-Oæ–‡ä»¶çš„å†…å®¹æ¥åˆ¤æ–­å†™çš„æŸä¸ªå†…å®¹åœ¨å“ªä¸ªä½ç½®
3. æŸ¥çœ‹mach-Oæ–‡ä»¶å·¥å…·---- machOView
4. ç”¨MachOViewæ‰“å¼€ä¼šçœ‹åˆ°Section64(_TEXT, _text)è¿™é‡Œé¢å°±æ˜¯å†™çš„ä»£ç æ®µï¼Œå†™çš„ä»£ç éƒ½åœ¨è¿™é‡Œ
5. å¦‚æœåœ¨MachOViewé‡Œçš„Section64(_TEXT, _cstring)çœ‹åˆ°çš„ç¬¬ä¸€å¥æ˜¯00005700(ç¬¬ä¸€è¡Œçš„pFile)ï¼Œæˆ‘ä»¬åœ¨ä»£ç ä¸­æˆ–æ±‡ç¼–ä¸­çœ‹åˆ°çš„æŒ‡ä»¤ä¼šæ˜¯0x100005700
6. é€šè¿‡çœ‹MachOViewé‡Œçš„Section64(_TEXT, _cstring)çš„pFileæ˜¯00005700çš„valueæ˜¯0123456789ABCDEFï¼Œæ˜¯å­—ç¬¦ä¸²çš„çœŸå®åœ°å€ï¼Œæ‰€ä»¥å­—ç¬¦ä¸²æ”¾åœ¨Section64(_TEXT, _cstring)è¿™ä¸ªåŒº(å¸¸é‡åŒº)
7. Section64(_TEXT, ..)éƒ½å¯ä»¥è®¤ä¸ºæ˜¯ä»£ç æ®µ,å†ç»†åˆ†çš„è¯Section64(_TEXT, _cstring)å°±æ˜¯å­—ç¬¦ä¸²å¸¸é‡åŒº

![ç¼–è¯‘é“¾æ¥å†…å­˜](/Swiftå…¥é—¨åˆ°ç²¾é€šç¬”è®°/ç¼–è¯‘é“¾æ¥å†…å­˜.png)

```swift
var str0 = "0123"
print(Mems.memStr(ofVal: &str0)) // 0x0000000033323130 0xe400000000000000
str0.append("4")
print(Mems.memStr(ofVal: &str0))  // 0x0000004733323130 0xe500000000000000


// ç”±æ­¤å¯è§ï¼Œåªè¦è¿˜æ”¾å¾—ä¸‹ï¼Œè¿˜æ˜¯ä¼šç›´æ¥å­˜å‚¨å†…å®¹
var str1 = "0123456789ABCDEF"
print(Mems.memStr(ofVal: &str1)) // 0xd000000000000010 0x80000001000056c0
// çœŸå®å­—ç¬¦ä¸²åœ°å€: 0x80000001000056c0-0x7FFFFFFFFFFFFFE0 ç­‰ä»·äº8æ”¹ä¸º0 0x00000001000056c0+0x20 = 0x1000056E0
str1.append("G") // é€šè¿‡çœ‹æ±‡ç¼–å¯ä»¥çœ‹åˆ°å½“è°ƒç”¨.append()æ–¹æ³•æ—¶åˆè°ƒç”¨äº†ä¸€æ¬¡Stringçš„initï¼Œå‚æ•°æ˜¯Gï¼Œè¿™æ˜¯åœ¨åˆå§‹åŒ–Gï¼Œä¼šæŠŠGå˜æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ
print(Mems.memStr(ofVal: &str1))  // 0xf000000000000011 0x0000000100702830
 

// çœŸå®å­—ç¬¦ä¸²åœ°å€: 0x0000000100702830+0x20 = 0x100702850 é€šè¿‡x 0x100702850 å¯ä»¥è¯»å–é‡Œé¢çš„å†…å®¹æ­£æ˜¯å­—ç¬¦ä¸²å†…å®¹ï¼Œ å¯¹äºä¸€ä¸ª8ä½8å­—èŠ‚ï¼Œå¦‚æœå‰é¢4ä¸ªéƒ½æ˜¯0ï¼Œè¯´æ˜ä»–åœ¨å †ç©ºé—´;
// è¯æ˜æ–¹å¼: é€šè¿‡allocä¸€ä¸ªå¯¹è±¡ï¼Œæ‰¾åˆ°mallocæ–¹æ³•ï¼Œåœ¨è¯¥æ±‡ç¼–å¤„æ‰“ä¸Šæ–­ç‚¹ï¼Œç„¶åçœ‹str1.appendæœ‰æ²¡æœ‰ä¹Ÿè°ƒç”¨åˆ°è¿™ä¸ªæ–­ç‚¹ï¼Œåˆ°è¿™ä¸ªæ–­ç‚¹çš„æ—¶å€™æ§åˆ¶å°è¾“å…¥btå¯ä»¥çœ‹åˆ°è°ƒç”¨æ ˆå°±æœ‰swift_slowAllocå’Œmallocç­‰æ–¹æ³•è°ƒç”¨æ ˆè¿˜æœ‰ä¸€ä¸ªSwift._StringGuts.append(....ï¼Œæ‰€ä»¥è¯´æ˜str1.appendåº•å±‚ä¼šè°ƒç”¨mallocï¼Œè°ƒç”¨mallocçš„åœ¨å †ç©ºé—´ï¼Œmallocè¿”å›çš„æ˜¯å †ç©ºé—´åœ°å€å€¼ï¼Œè¿”å›å€¼æ˜¯raxè¡¨ç¤ºï¼Œé€šè¿‡æ§åˆ¶å°è¾“å…¥register read raxå¾—åˆ°çš„å€¼åˆšå¥½å°±æ˜¯é€šè¿‡0x0000000100702830ï¼Œè¿™å°±æ˜¯å †ç©ºé—´åœ°å€å€¼ï¼Œè¿™ä¸ªåœ°å€å€¼+0x20(è·³è¿‡32ä¸ªå­—èŠ‚)å°±æ˜¯å­—ç¬¦ä¸²çœŸå®åœ°å€
```

```swift
// å­—ç¬¦ä¸²é•¿åº¦ <= 0xF,å­—ç¬¦ä¸²å†…å®¹ç›´æ¥å­˜æ”¾åœ¨str1å˜é‡çš„å†…å­˜ä¸­
var str1 = "0123456789"
 
// å­—ç¬¦ä¸²é•¿åº¦ > 0xF, å­—ç¬¦ä¸²å†…å®¹å­˜æ”¾åœ¨_TEXT, _cstringä¸­(å¸¸é‡åŒº)
// å­—ç¬¦ä¸²çš„åœ°å€å€¼ä¿¡æ¯å­˜æ”¾åœ¨str2å˜é‡çš„å8ä¸ªå­—èŠ‚ä¸­
var str2 = "0123456789ABCDEFGHIJ"
 
// ç”±äºå­—ç¬¦ä¸²é•¿åº¦ <= 0xF, æ‰€ä»¥å­—ç¬¦ä¸²å†…å®¹ä¾ç„¶å­˜æ”¾åœ¨str1å˜é‡çš„å†…å­˜ä¸­
str1.append("ABCDE")
// å¼€è¾Ÿå †ç©ºé—´
str1.append("F")
// å¼€è¾Ÿå †ç©ºé—´
str2.append("F")
```

###dyld_stub_binder

1. stubç¬¦å·ï¼šstub_binderï¼šç¬¦å·ç»‘å®š
2. åœ¨machOViewæ–‡ä»¶çš„Load Commandsé‡Œå°±æœ‰æ‰€æœ‰è½½å…¥å†…å­˜çš„æ‰€æœ‰ä¾èµ–çš„åŠ¨æ€åº“
3. initå‡½æ•°å°±æ˜¯åŠ¨æ€åº“ä¸­çš„æ–¹æ³•ï¼Œä½†æ˜¯åŠ¨æ€åº“çš„æ–¹æ³•æ˜¯åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æ‰è½½å…¥çš„ï¼Œæ‰€ä»¥æ–¹æ³•åœ°å€æ˜¯è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šçš„ï¼Œä½†æ˜¯ç¼–è¯‘çš„æ—¶å€™å°±éœ€è¦ç¡®å®šæ–¹æ³•åœ°å€ï¼Œæ‰€ä»¥æ±‡ç¼–çœ‹åˆ°çš„è¯¥åœ°å€æ˜¯ä¸€ä¸ªå ä½åœ°å€ï¼Œå¹¶ä¸æ˜¯çœŸå®æ–¹æ³•åœ°å€ï¼Œæ”¹å ä½åœ°å€æ–¹æ³•æœ‰ä¸€ä¸ªjmpqï¼Œè¿™ä¸ªæŒ‡ä»¤ä¼šè·³è½¬åˆ°ä¸€ä¸ªæ•°æ®æ®µåœ°å€ï¼Œè¿™ä¸ªåœ°å€ä¼šæŒ‡å¼•ä»–å»dyld_stub_binderé‡Œ
4. è¿™ä¸ªå ä½åœ°å€æ–¹æ³•é‡Œé¢ä¼šè°ƒç”¨åˆ°dyld_stub_binderåº“é‡Œï¼Œè¿™é‡Œåœ¨åšç¬¦å·ç»‘å®šï¼Œå°†çœŸæ­£åœ°å€å€¼(ä¸€ä¸ªè¶…å¤§çš„åœ°å€å€¼0x7f)æ›´æ–°åˆ°æ•°æ®æ®µåœ°å€é‡Œå­˜å‚¨çš„å†…å®¹

## Array

###å…³äºArrayçš„æ€è€ƒ

1. 1ä¸ªArrayå˜é‡å ç”¨å¤šå°‘å†…å­˜ï¼Ÿ
2. æ•°ç»„ä¸­çš„æ•°æ®å­˜æ”¾åœ¨å“ªé‡Œï¼Ÿ
3. è¯æ˜æ–¹æ³•å’ŒStringä¸€æ ·ï¼Œ
4. ç»“è®º:
   1. å†…å®¹æ”¾åœ¨å †ç©ºé—´
   2. ![Arrayåº•å±‚](/Swiftå…¥é—¨åˆ°ç²¾é€šç¬”è®°/Arrayåº•å±‚.png)
   3. è¿™ä¸ªå®¹é‡å¹¶ä¸æ˜¯ä¸€ä¸ªä¸€ä¸ªå¢åŠ çš„ï¼Œæ˜¯ä»¥8ä¸ºå€æ•°å¢åŠ 

     ## æ€»ç»“

### æ€»ç»“

1. è™½ç„¶è¯´Arrayå’ŒStringæ˜¯å€¼ç±»å‹ï¼Œæœ‰å€¼ç±»å‹çš„ç‰¹æ€§è¡Œä¸ºï¼Œæ¯”å¦‚ä¿®æ”¹å†…å®¹éœ€è¦åŠ mutatingï¼›
2. ä½†æ˜¯ä»æ±‡ç¼–çœ‹ï¼ŒArrayå’ŒStringæ˜¯åˆ†é…äº†å †ç©ºé—´çš„ï¼Œåº•å±‚æ˜¯å¼•ç”¨ç±»å‹

# å¯é€‰é¡¹ã€é«˜çº§è¿ç®—ç¬¦ã€æ‰©å±•

## å¯é€‰é¡¹çš„æœ¬è´¨

1. å¯é€‰é¡¹çš„æœ¬è´¨æ˜¯enumç±»å‹
2. Wrappedå«å…³è”å€¼

```swift
public enum Optional<Wrapped> : ExpressibleByNilLiteral {
    case none
    case some(Wrapped)
    public init(_ some: Wrapped)
}
 

var age1: Optional<Int> = .some(10)
age1 = .none
age2 = .some(20)
 
 
switch age {
   // væ˜¯ä¸å¸¦ï¼Ÿçš„ç±»å‹ï¼Œå¦‚æœè¿™é‡Œæ˜¯v?,ä¸æ˜¯vï¼Œé‚£ä¹ˆè¿™ä¸ªvæ˜¯å¯é€‰é¡¹ï¼Œå’Œå¯é€‰é¡¹ç»‘å®šä¸åŒ
   case let v?:
     print("some",v)
   case nil:
     print("none")
}
 
 
var age_: Int? = 10
var age: Int?? = age_
// å³:
var age_ = Optional.some(Optional.some(10))
var age: Optional<Optional> = .some(.some(10))
```

##é«˜çº§è¿ç®—ç¬¦

###æº¢å‡ºè¿ç®—ç¬¦

1. Swiftçš„ç®—æ•°è¿ç®—ç¬¦å‡ºç°æº¢å‡ºæ—¶ä¼šæŠ›å‡ºè¿è¡Œæ—¶é”™è¯¯
2. Swiftæœ‰æº¢å‡ºè¿ç®—ç¬¦(&+ã€&-ã€&*),ç”¨æ¥æ”¯æŒæº¢å‡ºè¿ç®—

```swift
var v1 = UInt8.max  // UInt8 0---255
var v2 = v1 &+ 1  // v2 = 0
```

###è¿ç®—ç¬¦é‡è½½

1. ç±»ã€ç»“æ„ä½“ã€æšä¸¾å¯ä»¥ä¸ºç°æœ‰çš„è¿ç®—ç¬¦æä¾›è‡ªå®šä¹‰çš„å®ç°ï¼Œè¿™ä¸ªæ“ä½œå«åš: è¿ç®—ç¬¦é‡è½½

```swift
struct Point {
   static func +(p1: Point, p2: Point) -> Point {
      Point(x: p1.x + p2.x, y: p1.y + p2.y)
   }
   static prefix func -(p: Point) -> Point {
      Point(x: - p.x, y: - p.y)
   }
   static func +=(p1: inout Point, p2: Point) {
      p1 = p1 + p2
   }
}
 
var p1 = Point(x: 10, y: 20)
var p2 = Point(x: 11, y: 22)
let p3 = -p2   // å‰ç¼€è¿ç®—ç¬¦ç”¨æ³•
p1 += p2
```

###Equatable

1. éµå®ˆEquatableåè®®ï¼Œå®ç°==ï¼Œ !=å°±è‡ªåŠ¨æœ‰æ•ˆèƒ½ç”¨
2. Swiftä¸ºä»¥ä¸‹ç±»å‹æä¾›é»˜è®¤çš„Equatableå®ç°
   1. æ²¡æœ‰å…³è”ç±»å‹çš„æšä¸¾(åè®®éƒ½å¯ä»¥ä¸ç”¨å†™)
   2. åªæ‹¥æœ‰éµå®ˆEquatableåè®®å…³è”ç±»å‹çš„æšä¸¾(éœ€è¦éµå®ˆåè®®)
   3. åªæ‹¥æœ‰éµå®ˆEquatableåè®®å­˜å‚¨å±æ€§çš„ç»“æ„ä½“
3. å¼•ç”¨ç±»å‹æ¯”è¾ƒå­˜å‚¨çš„åœ°å€å€¼æ˜¯å¦ç›¸ç­‰(æ˜¯å¦å¼•ç”¨ç€åŒä¸€ä¸ªå¯¹è±¡)ï¼Œä½¿ç”¨æ’ç­‰è¿ç®—ç¬¦ ===ã€!==

```swift
enum Answer: Equatable {
   case wrong(Int)
   case right
}
var s1 = Answer.wrong(10)
var s2 = Answer.wrong(10)
print(s1 == s2)  // true
```

###Comparable

1. è¦æƒ³æ¯”è¾ƒ2ä¸ªå®ä¾‹çš„å¤§å°ï¼Œä¸€èˆ¬åšæ³•æ˜¯:
   1. éµå®ˆComparableåè®®
   2. é‡è½½ç›¸åº”çš„è¿ç®—ç¬¦

###è‡ªå®šä¹‰è¿ç®—ç¬¦

1. å¯ä»¥è‡ªå®šä¹‰æ–°çš„è¿ç®—ç¬¦: åœ¨å…¨å±€ä½œç”¨åŸŸä½¿ç”¨operatorè¿›è¡Œå£°æ˜
2. [Appleæ–‡æ¡£å‚è€ƒ: ](https://developer.apple.com/documentation/swift/swift_standard_library/operator_declarations)

```swift
prefix operator +++   // å‰ç¼€è¿ç®—ç¬¦
postfix operator ---  // åç¼€è¿ç®—ç¬¦
infix operator +-: PlusMinusPrecedence  // ä¸­ç¼€è¿ç®—ç¬¦ï¼š ä¼˜å…ˆçº§ç»„
precedencegroup PlusMinusPrecedence {
 
    associativity: none  // ç»“åˆæ€§(left\right\none) ï¼Œ å³ç”¨å¤šä¸ªè¿™ä¸ªè¿ç®—ç¬¦æ—¶å€™ï¼Œä»å·¦è¾¹è¿˜æ˜¯å³è¾¹å¼€å§‹ç®—ï¼Œå¦‚æœæ˜¯noneï¼Œè¯´æ˜ä¸å…è®¸å¤šä¸ªè¿™ä¸ªè¿ç®—ç¬¦æ¯”å¦‚ a1+a2+a3å°±æ˜¯leftç»“åˆæ€§
    higherThan: AdditionPrecedence  // æ¯”è°çš„ä¼˜å…ˆçº§ä½
    lowerThan: MultiplicationPrecedence  // æ¯”è°çš„ä¼˜å…ˆçº§é«˜
    assignment: true  // ä»£è¡¨åœ¨å¯é€‰é“¾æ“ä½œä¸­æ‹¥æœ‰è·Ÿèµ‹å€¼è¿ç®—ç¬¦ä¸€æ ·çš„ä¼˜å…ˆçº§
}
 
prefix func +++ (_ i: inout Int) {
    i += 2
}
var age = 10
+++age
print(age)
```

###æ‰©å±•

1. Swiftçš„æ‰©å±•ï¼Œæœ‰ç‚¹ç±»ä¼¼äºOcä¸­çš„åˆ†ç±»
2. æ‰©å±•å¯ä»¥ä¸ºæšä¸¾ã€ç»“æ„ä½“ã€ç±»ã€åè®®æ·»åŠ æ–°åŠŸèƒ½
   1. å¯ä»¥æ·»åŠ æ–¹æ³•ã€è®¡ç®—å±æ€§ã€ä¸‹æ ‡ã€(ä¾¿æ·)åˆå§‹åŒ–å™¨ã€åµŒå¥—ç±»å‹ã€åè®®ç­‰ç­‰
3. æ‰©å±•ä¸èƒ½åŠåˆ°çš„äº‹æƒ…
   1. ä¸èƒ½è¦†ç›–åŸæœ‰çš„åŠŸèƒ½
   2. ä¸èƒ½æ·»åŠ å­˜å‚¨å±æ€§ï¼Œä¸èƒ½å‘å·²æœ‰çš„å±æ€§æ·»åŠ å±æ€§è§‚å¯Ÿå™¨
   3. ä¸èƒ½æ·»åŠ çˆ¶ç±»
   4. ä¸èƒ½æ·»åŠ æŒ‡å®šåˆå§‹åŒ–å™¨ï¼Œä¸èƒ½æ·»åŠ ååˆå§‹åŒ–å™¨
   5. ç±»éµå®ˆåè®®å®ç°çš„requiredåˆå§‹åŒ–å™¨ï¼Œä¸èƒ½å†™åœ¨æ‰©å±•ä¸­
   6. ...
4. æ‰©å±•å¯ä»¥ç»™åè®®æä¾›é»˜è®¤å®ç°ï¼Œé—´æ¥å®ç°å¯é€‰åè®®çš„æ•ˆæœ
5. æ‰©å±•å¯ä»¥ç»™åè®®æ‰©å…… åè®®ä¸­ä»æœªå£°æ˜è¿‡çš„æ–¹æ³•

```swift
extension Array {
 
 subscript(nullable idx: Int) -> Element? {
 if (startIndex ..< endIndex).contains(idx) {
 return self[idx]
 }
 return nil
 }
}
 
 
extension Int {
 func repeates(task: () -> Void) {
 for _ in 0..<self { task() }
 }
}
 
 
2.repeates {
 print("1")
}
```

###æ‰©å±•å¸¦æ³›å‹çš„

```swift
class Stack<E> {
 var elements = [E]()
 func push(_ element: E) {
 elements.append(element)
 }
}
 
// æ‰©å±•ä¸­ä¾ç„¶å¯ä»¥ä½¿ç”¨åŸç±»å‹ä¸­çš„æ³›å‹ç±»å‹
extension Stack {
 func top() -> E {
 elements.last!
 }
}
 
// ç¬¦åˆæ¡ä»¶æ‰æ‰©å±•
extension Stack: Equatable where E: Equatable {
 static func == (left: Stack, right: Stack) -> Bool {
 left.elements == right.elements
 }
}
```

#è®¿é—®æ§åˆ¶ã€å†…å­˜ç®¡ç†

## è®¿é—®æ§åˆ¶

1. åœ¨è®¿é—®æƒé™æ§åˆ¶è¿™å—ï¼ŒSwiftæä¾›äº†5ä¸ªä¸åŒçš„è®¿é—®çº§åˆ«(ä»¥ä¸‹æ˜¯ä»é«˜åˆ°ä½æ’åˆ—ï¼Œå®ä½“æŒ‡è¢«è®¿é—®çº§åˆ«ä¿®é¥°çš„å†…å®¹)
2. open: å…è®¸åœ¨å®šä¹‰å®ä½“çš„æ¨¡å—ã€å…¶ä»–æ¨¡å—ä¸­è®¿é—®ï¼Œå…è®¸ä»–ä»¬æ¨¡å—è¿›è¡Œç»§æ‰¿ã€é‡å†™(openåªèƒ½ç”¨åœ¨ç±»ã€ç±»æˆå‘˜ä¸Š)
3. public: å…è®¸åœ¨å®šä¹‰å®ä½“çš„æ¨¡å—ã€å…¶ä»–æ¨¡å—ä¸­è®¿é—®ï¼Œä¸å…è®¸ä»–ä»¬æ¨¡å—è¿›è¡Œç»§æ‰¿ã€é‡å†™
4. internal: åªå…è®¸åœ¨å®šä¹‰å®ä½“çš„æ¨¡å—ä¸­è®¿é—®ï¼Œä¸å…è®¸åœ¨ä»–ä»¬æ¨¡å—ä¸­è®¿é—®
5. fileprivate:åªå…è®¸åœ¨å®šä¹‰å®ä½“çš„æºæ–‡ä»¶ä¸­è®¿é—®
6. private: åªå…è®¸åœ¨å®šä¹‰å®ä½“çš„å°é—­å£°æ˜ä¸­è®¿é—®
7. ç»å¤§éƒ¨åˆ†å®ä½“é»˜è®¤éƒ½æ˜¯internalçº§åˆ«

### è®¿é—®çº§åˆ«çš„ä½¿ç”¨å‡†åˆ™

1. ä¸€ä¸ªå®ä½“ä¸å¯ä»¥è¢«æ›´ä½è®¿é—®çº§åˆ«çš„å®ä½“å®šä¹‰

### å…ƒç»„ç±»å‹çš„è®¿é—®çº§åˆ«

1.  å…ƒç»„ç±»å‹çš„è®¿é—®çº§åˆ«æ˜¯æ‰€æœ‰æˆå‘˜ç±»å‹æœ€ä½çš„é‚£ä¸ª

### æ³›å‹ç±»å‹çš„è®¿é—®çº§åˆ«

1.  æ³›å‹ç±»å‹çš„è®¿é—®çº§åˆ«æ˜¯ ç±»å‹çš„è®¿é—®çº§åˆ« ä»¥åŠ æ‰€æœ‰æ³›å‹ç±»å‹å‚æ•°çš„è®¿é—®çº§åˆ« ä¸­æœ€ä½çš„å“ªä¸ª

```swift
internal class Car { }
fileprivate class Dog { }
public class Person<T1, T2> { }
 
// Person<Car, Dog> çš„è®¿é—®çº§åˆ«æ˜¯fileprivate
fileprivate var p = Person<Car, Dog>()
```

### æˆå‘˜ã€åµŒå¥—ç±»å‹çš„è®¿é—®çº§åˆ«

1. ç±»å‹çš„è®¿é—®çº§åˆ«ä¼šå½±å“æˆå‘˜(å±æ€§ã€æ–¹æ³•ã€åˆå§‹åŒ–å™¨ã€ä¸‹æ ‡)ã€åµŒå¥—ç±»å‹çš„é»˜è®¤è®¿é—®çº§åˆ«
2. ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç±»å‹ä¸ºprivateæˆ–fileprivateï¼Œé‚£ä¹ˆæˆå‘˜\åµŒå¥—ç±»å‹é»˜è®¤ä¹Ÿæ˜¯privateæˆ–fileprivate(å’Œç±»å‹ä¸€æ ·ä½œç”¨åŸŸ)
3. ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç±»å‹ä¸ºinternalæˆ–publicï¼Œé‚£ä¹ˆæˆå‘˜\åµŒå¥—ç±»å‹é»˜è®¤æ˜¯internal

### ä¾‹å­

1. ç›´æ¥åœ¨å…¨å±€ä½œç”¨åŸŸä¸‹å®šä¹‰çš„privateç­‰ä»·äºfileprivate
2. ä¾‹å­: 

```swift
// ä¼šæŠ¥é”™
// å› ä¸ºprivateè¡¨ç¤ºåªå…è®¸åœ¨å®šä¹‰å®ä½“çš„å°é—­å£°æ˜ä¸­è®¿é—®ï¼Œé‚£ä¹ˆå®ƒçš„ä½œç”¨åŸŸæ˜¯testå¤§æ‹¬å·é‡Œï¼Œè¿™ç§æƒ…å†µä¸‹ï¼ŒCarä¸‹çš„å±æ€§ä¼šé»˜è®¤æ˜¯privateæƒé™çº§åˆ«ä½†æ˜¯æ˜¯å’ŒCarä½œç”¨åŸŸç›¸åŒï¼Œå³testå¤§æ‹¬å·é‡Œ
// fileprivate:åªå…è®¸åœ¨å®šä¹‰å®ä½“çš„æºæ–‡ä»¶ä¸­è®¿é—®ï¼Œ è¿™æ•´ä¸ª.swiftéƒ½å¯ä»¥è®¿é—®
// åˆç”±äºä¸€ä¸ªå®ä½“ä¸å¯ä»¥è¢«æ›´ä½è®¿é—®çº§åˆ«çš„å®ä½“å®šä¹‰ï¼Œæ‰€ä»¥Car>=Dogæ‰è¡Œï¼Œæ‰€ä»¥è¿™é‡ŒæŠ¥é”™
class test {
     
    private class Car { }
    fileprivate class Dog : Car { }
}
 
// ä¸ä¼šæŠ¥é”™
// Carä½œç”¨åŸŸåœ¨æ•´ä¸ªæ–‡ä»¶,è¿™ç§æƒ…å†µä¸‹ï¼ŒCarä¸‹çš„å±æ€§ä¼šé»˜è®¤æ˜¯filePrivateæƒé™çº§åˆ«ï¼ŒDogä¹Ÿæ˜¯æ•´ä¸ªæ–‡ä»¶
private class Car { }
fileprivate class Dog : Car { }
```

### getterã€setter

1. getterã€setteré»˜è®¤è‡ªåŠ¨æ¥æ”¶å®ƒä»¬æ‰€å±ç¯å¢ƒçš„è®¿é—®çº§åˆ«
2. å¯ä»¥ç»™setterå•ç‹¬è®¾ç½®ä¸€ä¸ªæ¯”getteræ›´ä½çš„è®¿é—®çº§åˆ«ï¼Œç”¨ä»¥é™åˆ¶å†™çš„æƒé™

```swift
class Person {
    // è®¾ç½®setterçš„çº§åˆ«æ˜¯privateï¼Œ
    // getterçš„çº§åˆ«é»˜è®¤è‡ªåŠ¨æ¥æ”¶æ‰€å±ç¯å¢ƒçš„è®¿é—®çº§åˆ«ä¹Ÿå°±æ˜¯å’ŒPersonç›¸åŒ
    // æ‰€ä»¥æ•ˆæœæ˜¯å¤–ç•Œå¯ä»¥è®¿é—®ageï¼Œä½†æ˜¯æ›´æ”¹ä¸äº†age
    private(set) var age = 0
}
```

###åˆå§‹åŒ–å™¨

1. å¦‚æœä¸€ä¸ªpublicç±»æƒ³åœ¨å¦ä¸€ä¸ªæ¨¡å—è°ƒç”¨ç¼–è¯‘ç”Ÿæˆçš„é»˜è®¤æ— å‚åˆå§‹åŒ–å™¨ï¼Œå¿…é¡»æ˜¾ç¤ºæä¾›publicçš„æ— å‚åˆå§‹åŒ–å™¨
2. requiredåˆå§‹åŒ–å™¨å¿…é¡»è·Ÿå®ƒæ‰€å±ç±»æ‹¥æœ‰ç›¸åŒçš„è®¿é—®çº§åˆ«
3. å¦‚æœç»“æ„ä½“æœ‰private\fileprivateçš„å­˜å‚¨å®ä¾‹å±æ€§ï¼Œé‚£ä¹ˆå®ƒçš„æˆå‘˜åˆå§‹åŒ–å™¨ä¹Ÿæ˜¯private\fileprivateï¼ˆæˆå‘˜åˆå§‹åŒ–å™¨å°±æ˜¯å¸¦åˆå§‹åŒ–æˆå‘˜çš„ï¼‰,å¦åˆ™é»˜è®¤å°±æ˜¯internal

###æšä¸¾

1. ä¸èƒ½ç»™enumçš„æ¯ä¸ªcaseå•ç‹¬è®¾ç½®è®¿é—®çº§åˆ«
2. æ¯ä¸ªcaseè‡ªåŠ¨æ¥æ”¶enumçš„è®¿é—®çº§åˆ«
   1. public enumå®šä¹‰çš„caseä¹Ÿæ˜¯public

###åè®®

1. åè®®ä¸­å®šä¹‰çš„è¦æ±‚è‡ªåŠ¨æ¥æ”¶åè®®çš„è®¿é—®çº§åˆ«ï¼Œä¸èƒ½å•ç‹¬è®¾ç½®è®¿é—®çº§åˆ«
2. publicåè®®å®šä¹‰çš„è¦æ±‚ä¹Ÿæ˜¯public
3. åè®®å®ç°çš„è®¿é—®çº§åˆ«å¿…é¡» >= ç±»å‹çš„è®¿é—®çº§åˆ«ï¼Œæˆ–è€… >= åè®®çš„è®¿é—®çº§åˆ«

###æ‰©å±•

1. å¦‚æœæœ‰æ˜¾ç¤ºè®¾ç½®æ‰©å±•çš„è®¿é—®çº§åˆ«ï¼Œæ‰©å±•æ·»åŠ çš„æˆå‘˜è‡ªåŠ¨æ¥æ”¶æ‰©å±•çš„è®¿é—®çº§åˆ«
2. å¦‚æœæ²¡æœ‰æ˜¾ç¤ºè®¾ç½®æ‰©å±•çš„è®¿é—®çº§åˆ«ï¼Œæ‰©å±•æ·»åŠ çš„æˆå‘˜çš„é»˜è®¤è®¿é—®çº§åˆ«ï¼Œè·Ÿç›´æ¥åœ¨ç±»å‹ä¸­å®šä¹‰çš„æˆå‘˜ä¸€æ ·
3. å¯ä»¥å•ç‹¬ç»™æ‰©å±•æ·»åŠ çš„æˆå‘˜è®¾ç½®è®¿é—®çº§åˆ«
4. ä¸èƒ½ç»™ç”¨äºéµå®ˆåè®®çš„æ‰©å±•æ˜¾ç¤ºè®¾ç½®æ‰©å±•çš„è®¿é—®çº§åˆ«
5. åœ¨åŒä¸€æ–‡ä»¶ä¸­çš„æ‰©å±•ï¼Œå¯ä»¥å†™æˆç±»ä¼¼å¤šä¸ªéƒ¨åˆ†çš„ç±»å‹å£°æ˜
   1. åœ¨åŸæœ¬çš„å£°æ˜ä¸­å£°æ˜ä¸€ä¸ªç§æœ‰æˆå‘˜ï¼Œå¯ä»¥åœ¨åŒä¸€æ–‡ä»¶çš„æ‰©å±•ä¸­è®¿é—®å®ƒ
   2. åœ¨æ‰©å±•ä¸­å£°æ˜ä¸€ä¸ªç§æœ‰æˆå‘˜ï¼Œå¯ä»¥åœ¨åŒä¸€æ–‡ä»¶çš„å…¶ä»–æ‰©å±•ä¸­ã€åŸæœ¬å£°æ˜ä¸­è®¿é—®å®ƒ

###å°†æ–¹æ³•èµ‹å€¼ç»™var\let

1. å¦‚æœæœ‰æ˜¾ç¤ºè®¾ç½®æ‰©å±•çš„è®¿é—®çº§åˆ«ï¼Œæ‰©å±•æ·»åŠ çš„æˆå‘˜è‡ªåŠ¨æ¥æ”¶æ‰©å±•çš„è®¿é—®çº§åˆ«
2. å¦‚æœæ²¡æœ‰æ˜¾ç¤ºè®¾ç½®æ‰©å±•çš„è®¿é—®çº§åˆ«ï¼Œæ‰©å±•æ·»åŠ çš„æˆå‘˜çš„é»˜è®¤è®¿é—®çº§åˆ«ï¼Œè·Ÿç›´æ¥åœ¨ç±»å‹ä¸­å®šä¹‰çš„æˆå‘˜ä¸€æ ·

```swift
struct Person {
   var age: Int
   func run(_ v: Int) { print("djlsjflj") }
   static eat(_ v: Int) { print("eat") }
}
// fn1 çš„ç±»å‹æ˜¯ (Person) -> ((Int) ->()) // æ¥æ”¶ä¸€ä¸ªPersonå®ä¾‹ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªå‡½æ•°
var fn1 = Person.run
var fn2 = fn1(Person(age: 10))
fn2(20)
 
 
// ç±»å‹æ–¹æ³•ä¸éœ€è¦ä¼ å®ä¾‹
var fn3 = Person.eat
fn3(20)
```

## å†…å­˜ç®¡ç†

1.  è·ŸOCä¸€æ ·ï¼ŒSwiftä¹Ÿæ˜¯é‡‡å–åŸºäºå¼•ç”¨è®¡æ•°çš„ARCå†…å­˜ç®¡ç†æ–¹æ¡ˆ(é’ˆå¯¹å †ç©ºé—´)
2. Swiftçš„ARCæœ‰3ç§å¼•ç”¨
   1. å¼ºå¼•ç”¨: é»˜è®¤æƒ…å†µä¸‹ï¼Œå¼•ç”¨éƒ½æ˜¯å¼ºå¼•ç”¨
   2. å¼±å¼•ç”¨: é€šè¿‡weakå®šä¹‰å¼±å¼•ç”¨
      1. å¿…é¡»æ˜¯å¯é€‰ç±»å‹çš„varï¼Œå› ä¸ºå®ä¾‹é”€æ¯åï¼ŒARCä¼šè‡ªåŠ¨å°†å¼±å¼•ç”¨è®¾ç½®ä¸ºnil
      2. ARCè‡ªåŠ¨ç»™å¼±å¼•ç”¨è®¾ç½®nilæ—¶ï¼Œä¸ä¼šè§¦å‘å±æ€§è§‚å¯Ÿå™¨
   3. æ— ä¸»å¼•ç”¨: é€šè¿‡unownedå®šä¹‰æ— ä¸»å¼•ç”¨
      1. ä¸ä¼šäº§ç”Ÿå¼ºå¼•ç”¨ï¼Œå®ä¾‹é”€æ¯æ—¶ä»ç„¶å­˜å‚¨ç€å®ä¾‹çš„å†…å­˜åœ°å€(ç±»ä¼¼äºOCä¸­çš„unsage_unretained)
      2. è¯•å›¾åœ¨å®ä¾‹é”€æ¯åè®¿é—®æ— ä¸»å¼•ç”¨ï¼Œä¼šäº§ç”Ÿè¿è¡Œæ—¶é”™è¯¯(é‡æŒ‡é’ˆ)

###weakã€unownedçš„ä½¿ç”¨é™åˆ¶

1.  weakã€unownedåªèƒ½ç”¨åœ¨ç±»å®ä¾‹ä¸Šé¢

###Autorelesepool

1.  è‡ªå·±åˆ›å»ºå†…å­˜é‡Šæ”¾æ± ï¼Œç¼“è§£å†…å­˜å‹åŠ›

```swift
autoreleasepool {
   let p = MJPerson(age: 20, name: "jack")
   p.run()
}
```

### å¾ªç¯å¼•ç”¨

1.  weakã€unownedéƒ½èƒ½è§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œunownedè¦æ¯”weakå°‘ä¸€äº›æ€§èƒ½æ¶ˆè€—
   1. åœ¨ç”Ÿå‘½å‘¨æœŸä¸­å¯èƒ½ä¼šå˜ä¸ºnilçš„ä½¿ç”¨weak
   2. åˆå§‹åŒ–èµ‹å€¼åå†ä¹Ÿä¸ä¼šå˜æˆnilçš„ä½¿ç”¨unowned

###é—­åŒ…çš„å¾ªç¯å¼•ç”¨

1.  é—­åŒ…è¡¨è¾¾å¼é»˜è®¤ä¼šå¯¹ç”¨åˆ°çš„å¤–å±‚å¯¹è±¡äº§ç”Ÿé¢å¤–çš„å¼ºå¼•ç”¨(å¯¹å¤–å±‚å¯¹è±¡è¿›è¡Œäº†retainæ“ä½œ)

```swift
class Person {
     
    var fn: (()->())?
    func run() {
        print("run")
    }
    deinit {
        print("deinit")
    }
}
func test() {
    let p = Person()
    p.fn = {
        [weak p] in
        p?.run()
    }
}
test()
```

2. å¦‚æœæƒ³åœ¨å®šä¹‰é—­åŒ…å±æ€§çš„åŒæ—¶å¼•ç”¨selfï¼Œè¿™ä¸ªé—­åŒ…å¿…é¡»æ˜¯lazy(å› ä¸ºåœ¨å®ä¾‹åˆå§‹åŒ–å®Œæ¯•ä¹‹åæ‰èƒ½å¼•ç”¨self)
3. å¦‚æœlazyå±æ€§æ˜¯é—­åŒ…è°ƒç”¨çš„ç»“æœï¼Œé‚£ä¹ˆä¸ç”¨è€ƒè™‘å¾ªç¯å¼•ç”¨çš„é—®é¢˜(å› ä¸ºé—­åŒ…è°ƒç”¨åï¼Œé—­åŒ…çš„ç”Ÿå‘½å‘¨æœŸå°±ç»“æŸäº†)

###@escaping

1. éé€ƒé€¸é—­åŒ…ã€é€ƒé€¸é—­åŒ…ï¼Œä¸€èˆ¬éƒ½æ˜¯å½“ä½œå‚æ•°ä¼ é€’ç»™å‡½æ•°
2. éé€ƒé€¸é—­åŒ…: é—­åŒ…è°ƒç”¨å‘ç”Ÿåœ¨å‡½æ•°ç»“æŸå‰ï¼Œé—­åŒ…è°ƒç”¨åœ¨å‡½æ•°ä½œç”¨åŸŸå†…
3. é€ƒé€¸é—­åŒ…: é—­åŒ…æœ‰å¯èƒ½åœ¨å‡½æ•°ç»“æŸåè°ƒç”¨ï¼Œé—­åŒ…è°ƒç”¨é€ƒç¦»äº†å‡½æ•°çš„ä½œç”¨åŸŸï¼Œéœ€è¦é€šè¿‡@escapingå£°æ˜
4. é€ƒé€¸é—­åŒ…ä¸å¯ä»¥æ•è·inoutå‚æ•°

```swift
typealias Fn = () -> ()

func test1(_ fn: Fn) {
    fn()
}

var gFn: Fn?
func test2(_ fn: @escaping Fn) {
    
    gFn = fn
}

func test(value: inout Int) {

    test1 {
        value += 1
    }
    test2 { // ä¼šæŠ¥é”™
        value += 1
    }
}


do {
    var a = 10
    test2{
        a += 1
    }
//    test(value: &a)  // å½“è¿™ä¸ªå¤§æ‹¬å·æ‰§è¡Œå®Œï¼Œaå·²ç»é”€æ¯äº†ï¼Œè¿™æ—¶å€™gFnä¿å­˜çš„åœ°å€å€¼å·²ç»é”€æ¯ï¼Œ
}

if gFn != nil { // number ä½œç”¨åŸŸåªåœ¨è¿™ä¸ªå¤§é˜”å·é‡Œ

    gFn!()
    print("1000hhhhh")
}
```

### å†…å­˜è®¿é—®å†²çª(å¼ºåˆ¶ç‹¬å æ€§åŸåˆ™)

ä¸ºäº†å®ç° [å†…å­˜å®‰å…¨](https://docs.swift.org/swift-book/LanguageGuide/MemorySafety.html)ï¼ŒSwift éœ€è¦å¯¹å˜é‡è¿›è¡Œç‹¬å è®¿é—®æ—¶æ‰èƒ½ä¿®æ”¹è¯¥å˜é‡ã€‚æœ¬è´¨ä¸Šæ¥è¯´ï¼Œå½“ä¸€ä¸ªå˜é‡ä½œä¸º `inout` å‚æ•°æˆ–è€… `mutating` æ–¹æ³•ä¸­çš„ `self` è¢«ä¿®æ”¹æ—¶ï¼Œä¸èƒ½é€šè¿‡ä¸åŒçš„åç§°è¢«è®¿é—®çš„ã€‚

[æ‰€æœ‰æƒå®£è¨€ - Swift å®˜æ–¹æ–‡ç«  Ownership Manifesto è¯‘æ–‡è¯„æ³¨ç‰ˆ](https://onevcat.com/2017/02/ownership/)

1. å†…å­˜è®¿é—®å†²çªä¼šåœ¨ä¸¤ä¸ªè®¿é—®æ»¡è¶³ä¸‹åˆ—æ¡ä»¶æ—¶å‘ç”Ÿ
   1. è‡³å°‘ä¸€ä¸ªæ˜¯å†™å…¥æ“ä½œ
   2. ä»–ä»¬è®¿é—®çš„æ˜¯åŒä¸€å—å†…å­˜
   3. ä»–ä»¬çš„è®¿é—®æ—¶é—´é‡å (æ¯”å¦‚åœ¨åŒä¸€ä¸ªå‡½æ•°å†…)
2. å¦‚æœä¸‹é¢çš„æ¡ä»¶å¯ä»¥æ»¡è¶³ï¼Œå°±è¯´æ˜é‡å è®¿é—®ç»“æ„ä½“çš„å±æ€§æ˜¯å®‰å…¨çš„
   1. ä½ åªè®¿é—®å®ä¾‹å­˜å‚¨å±æ€§ï¼Œä¸æ˜¯è®¡ç®—å±æ€§æˆ–è€…ç±»å±æ€§
   2. ç»“æ„ä½“æ˜¯å±€éƒ¨å˜é‡è€Œéå…¨å±€å˜é‡
   3. ç»“æ„ä½“è¦ä¹ˆæ²¡æœ‰è¢«é—­åŒ…æ•è·è¦ä¹ˆåªè¢«éé€ƒé€¸é—­åŒ…æ•è·

```swift
// ä¸å­˜åœ¨å†…å­˜è®¿é—®å†²çª
func plus(_ num: inout Int) -> Int {
    num + 1
}
var number = 1
number = plus(&number)  // å°†numberåœ°å€ä¼ å…¥ï¼Œè¿”å›å€¼ä¹‹åèµ‹å€¼ç»™è‡ªå·±


// å­˜åœ¨å†…å­˜è®¿é—®å†²çªï¼Œè¿è¡Œç›´æ¥å´©æºƒ
// Simultaneous accesses to 0x1000071f8, but modification requires exclusive access.
// Previous access (a modification) started at SwiftTest`main + 171 (0x10000103b).
// Current access (a read) started at:
//var step = 1
//func increment(_ num: inout Int) { num += step } // numå°±æ˜¯ä¼ è¿›æ¥çš„stepï¼Œè¿™å¥ç­‰äºstep += step
//increment(&step)


// æ²¡é—®é¢˜
var a = 1
a += a
print(a)
```

# æŒ‡é’ˆ

1. Swiftä¸­ä¹Ÿæœ‰ä¸“é—¨çš„æŒ‡é’ˆç±»å‹ï¼Œè¿™äº›éƒ½è¢«å®šæ€§ä¸º"Unsafe"ï¼Œå¸¸è§çš„æœ‰

   1. UnsafePointer<Pointee>ç±»ä¼¼äºconst Pointee*   // Pointeeè¡¨ç¤ºæ³›å‹
   2. UnsafeMutablePointer<Pointee>ç±»ä¼¼äºPointee*   // å¯ä»¥ä¿®æ”¹æŒ‡é’ˆæŒ‡å‘çš„å€¼
   3. UnsafeRawPointer ç±»ä¼¼äº const void*   // æ™®é€šæŒ‡é’ˆï¼ŒæŒ‡å‘çš„æ˜¯ä»€ä¹ˆä¸ç¡®å®š
   4. UnsafeMutableRawPointer ç±»ä¼¼äº void*

2. å¸¦æ³›å‹çš„ï¼Œé€šè¿‡ptr.pointeeè®¿é—®æˆ–ä¿®æ”¹æŒ‡é’ˆæŒ‡å‘çš„å€¼ï¼Œä¸å¸¦æ³›å‹çš„é€šè¿‡

   ptr.load(as: Int.**self**)è·å–å€¼ï¼Œé€šè¿‡ptr.storeBytes(of: 30, as: Int.**self**)å­˜å‚¨å€¼ï¼ŒInt.selfæ ¹æ®éœ€è¦ä¿®æ”¹

3. è¿ç”¨:

4.  

   ```swift
   var arr = NSArray(objects: 11,22,33,44)
   arr.enumerateObjects { (element, idx, stop) in
      print(idx,element)
    if idx == 2 {
        stop.pointee = true
      }
   }    
   // æ›´å¥½çš„éå†æ–¹å¼
   for (idx, element) in arr.enumerated() {
      print(idx,element)
   if idx == 2 {
    break
    }
    }
    
    
   // åˆ›å»ºä¸€ä¸ªpointer
   var age = 10
   var ptr = withUnsafePointer(to: &age) { &0 }
   // æ­¤æ—¶pträ¼šæ˜¯ä¸€ä¸ªUnsafePointer<Int>ç±»å‹
   ```

5. è·å¾—æŸä¸ªå˜é‡çš„æŒ‡é’ˆ

6.  

   ```swift
   var age = 10
   var ptr = withUnsafePointer(to: &age) { &0 }
   // æ­¤æ—¶pträ¼šæ˜¯ä¸€ä¸ªUnsafePointer<Int>ç±»å‹var ptr1 = withUnsafePointer(to: &age) { UnsafeRawPointer{&0} }
   // æ­¤æ—¶ptr1ä¼šæ˜¯ä¸€ä¸ªUnsafeRawPointerç±»å‹ // pæ˜¯æŒ‡å‘ageçš„æŒ‡é’ˆï¼Œ Resultæ˜¯è¿”å›ç»™å¤–ç•Œçš„æ³›å‹, è¿”å›å€¼æ˜¯é—­åŒ…é‡Œçš„æ‰§è¡Œç»“æœ
   // withUnsafePointer(to: &age) { (p) -> Result in
   // <#code#>
   // }
    var ptr = withUnsafePointer(to: &age) { (p) -> Int in
    20
    }
    // æ­¤æ—¶ptrå°±æ˜¯20
   ```

7. è·å–æŒ‡å‘å †ç©ºé—´å®ä¾‹çš„æŒ‡é’ˆ

8.  

   ```swift
   class Person {
     
    var age: Int
    init(age: Int) {
    self.age = age
    }
   }
    
   var person = Person(age: 21)
   var ptr1 = withUnsafePointer(to: &person) { UnsafeRawPointer($0) } // personå˜é‡åœ°å€å€¼
   var address = ptr1.load(as: UInt.self) // è·å–personå˜é‡æ‰€æŒ‡å‘çš„å€¼==å †ç©ºé—´åœ°å€å€¼
   var allocPer = UnsafeMutableRawPointer(bitPattern: address) // æ ¹æ®åœ°å€å€¼å¾—åˆ°ä¸€ä¸ªæŒ‡é’ˆ
    
    
   // åŒ
   var allocPer2 = unsafeBitCast(person, to: UnsafeRawPointer.self)  //  allocPerå’ŒallocPer2ç›¸åŒï¼Œéƒ½æ˜¯æŒ‡å‘å †ç©ºé—´çš„æŒ‡é’ˆ
     
   print(allocPer) // Optional(0x0000000100732750)
   print(ptr1) // 0x0000000100008398 ptr1æŒ‡å‘personå˜é‡çš„åœ°å€
    
    
   print(Mems.ptr(ofVal: &person)) // 0x0000000100008398 personå˜é‡çš„åœ°å€
   print(Mems.ptr(ofRef: person)) // 0x0000000100732750 å †ç©ºé—´Personå¯¹è±¡çš„åœ°å€å€¼
   ```

9.  åˆ›å»ºä¸€ä¸ªæŒ‡é’ˆ

10.  

    ```swift
    // æ–¹å¼ä¸€:
    var ptr = malloc(16)  // è¿”å›å€¼ UnsafeMutableRawPointer!
    ptr?.storeBytes(of: 10, as: Int.self)  // å‰8ä¸ªå­—èŠ‚èµ‹å€¼10
    ptr?.storeBytes(of: 20, toByteOffset: 8, as: Int.self) // åé¢8ä¸ªå­—èŠ‚èµ‹å€¼20
     
     
    ptr?.load(as: Int.self) // å–å‡ºå‰8ä¸ª
    ptr?.load(fromByteOffset: 8, as: Int.self) // å–å‡ºå8ä¸ª
     
     
    // é”€æ¯
    free(ptr)
     
     
    // æ–¹å¼äºŒ:
    var ptr1 = UnsafeMutableRawPointer.allocate(byteCount: 16, alignment: 1)
    // ptr1.advanced(by: 8)  // æŒ‡é’ˆå¾€åç§»åŠ¨8ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¸€ä¸ªæ–°åœ°å€
    ptr1.storeBytes(of: 11, as: Int.self)
    ptr1.advanced(by: 8).storeBytes(of: 22, as: Int.self)
     
     
    ptr?.load(as: Int.self) // å–å‡ºå‰8ä¸ª
    ptr?.advanced(by: 8).load(as: Int.self) // å–å‡ºå8ä¸ª
     
     
    // é”€æ¯
    ptr1.deallocate()
     
     
    var ptr2 = UnsafeMutablePointer<Int>.allocate(capacity: 3) // ç›¸å½“äº24ä¸ªå­—èŠ‚
    ptr2.initialize(to: 10) // å¦‚æœæ˜¯æ³›å‹çš„è¯å»ºè®®ç”¨initializeæ¥åˆå§‹åŒ–ï¼Œè¿™é‡Œåˆå§‹åŒ–äº†å‰8ä¸ªå­—èŠ‚ä¸º10
    //ptr2.successor()  // åè®°ï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªInt
    ptr2.successor().initialize(to: 20)
    ptr2.successor().successor().initialize(to: 20)
     
     
    print(ptr2.pointee) // 11
    print((ptr2+1).pointee)  // 22
    print(ptr2[2])  // 33
    print(ptr2.successor().successor().pointee)  // 33
     
     
    // é”€æ¯
    ptr2.deinitialize(count: 3) // ä¸€å®šè¦å†™ï¼Œä¸ç„¶ä¼šå†…å­˜æ³„æ¼
    ptr2.deallocate()
    ```

11.  æŒ‡é’ˆä¹‹é—´çš„è½¬æ¢

    1. unsafeBitCastæ˜¯å¿½ç•¥æ•°æ®ç±»å‹çš„å¼ºåˆ¶è½¬æ¢ï¼Œä¸ä¼šå› ä¸ºæ•°æ®ç±»å‹çš„å˜åŒ–è€Œæ”¹å˜åŸæ¥çš„å†…å­˜æ•°æ®
    2. ç±»ä¼¼äºC++ä¸­çš„reinterpret_cast

12.  

    ```swift
    var ptr = UnsafeMutableRawPointer.allocate(byteCount: 16, alignment: 1)
    defer {
      ptr.deallocate()
    }
     
     
    //è¡¨ç¤ºå‡æƒ³å®ƒä¸ºIntç±»å‹ï¼Œptr1æ˜¯UnsafeMutableRawPointer<Int>ç±»å‹,
    var ptr1 = ptr.assumingMemoryBound(to: Int.self)
    (ptr+8).assumingMemoryBound(to: Double.self).pointee = 22 // è¿™é‡Œçš„+8æ˜¯åŠ ä¸Š8ä¸ªå­—èŠ‚,å’Œptr1ä¸åŒ
    // å› ä¸ºptr1æ˜ç¡®äº†ç±»å‹ï¼Œå®ƒ+1å°±æ˜¯åªåŠ 1ä¸ªIntå­—èŠ‚,ä»¥ç±»å‹ä¸ºå•ä½ï¼Œè€Œpträ¸æ˜ç¡®ç±»å‹ï¼Œå®ƒæ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½
     
     
    // è¡¨ç¤ºå¼ºåˆ¶è½¬æ¢, ptr2æ˜¯UnsafeMutableRawPointer<Int>ç±»å‹,
    var ptr2 = unsafeBitCast(ptr, to: UnsafeMutablePointer<Int>.self)
    ```

# å­—é¢é‡(Literal)

1. å¸¸è§çš„å­—é¢é‡é»˜è®¤ç±»å‹

   1. **public** **typealias** IntegerLiteralType = Int
   2. **public** **typealias** FloatLiteralType = Double
   3. **public** **typealias** BooleanLiteralType = Bool
   4. **public** **typealias** StringLiteralType = String

2. å¯ä»¥é€šè¿‡typealiasä¿®æ”¹å­—é¢é‡çš„é»˜è®¤ç±»å‹

3. 1. **typealias** IntegerLiteralType = Double
   2. **typealias** FloatLiteralType = Int

4. Swiftè‡ªå¸¦çš„ç»å¤§éƒ¨åˆ†ç±»å‹ï¼Œéƒ½æ”¯æŒç›´æ¥é€šè¿‡å­—é¢é‡è¿›è¡Œåˆå§‹åŒ–

5. Swiftè‡ªå¸¦ç±»å‹ä¹‹æ‰€ä»¥èƒ½å¤Ÿé€šè¿‡å­—é¢é‡åˆå§‹åŒ–ï¼Œæ˜¯å› ä¸ºå®ƒä»¬éµå®ˆäº†å¯¹åº”çš„åè®®

   1. Bool: ExpressibleByBooleanLiteral
   2. Intã€Floatã€Dictionaryã€Stringã€Arrayã€Setéƒ½æœ‰éµå®ˆå¯¹åº”åè®®

6. å­—é¢é‡åè®®åº”ç”¨

   1. æœ‰ç‚¹ç±»ä¼¼c++çš„è½¬æ¢æ„é€ å‡½æ•°

```swift
extension Int: ExpressibleByBooleanLiteral {
 
    public typealias BooleanLiteralType = Bool
 
    public init(booleanLiteral value: Self.BooleanLiteralType) {
 
        self = value ? 1 : 0
    }
}
 
var  num: Int = true
print(num)
```

# æ¨¡å¼

1. æ¨¡å¼æ˜¯ç”¨äºåŒ¹é…çš„è§„åˆ™ï¼Œæ¯”å¦‚switchçš„caseã€æ•æ‰é”™è¯¯çš„catchã€if\guard\while\forè¯­å¥çš„æ¡ä»¶ç­‰
2. ç†è§£æ¨¡å¼æœ‰åˆ©äºå†™å‡ºæ›´ç²¾ç®€çš„ä»£ç 

## é€šé…ç¬¦æ¨¡å¼(Wildcard Pattern)

1. _ åŒ¹é…ä»»ä½•å€¼
2. _?åŒ¹é…énilå€¼

## æ ‡è¯†ç¬¦æ¨¡å¼(Identifier Pattern)

1. ç»™å¯¹åº”çš„å˜é‡ã€å¸¸é‡åèµ‹å€¼ (å˜é‡ã€å¸¸é‡åå°±æ˜¯æ ‡è¯†ç¬¦)

## å…ƒç¥–æ¨¡å¼(Tuple Pattern)

1. (0,1)

## æšä¸¾Caseæ¨¡å¼(Enumeration Case Pattern)

1. if caseè¯­å¥ç­‰ä»·äºåªæœ‰1ä¸ªcaseçš„switchè¯­å¥
2. åˆ¤æ–­ageæ˜¯å¦å¤§äº0å°äº10ã€åˆ¤æ–­agesæ•°ç»„ä¸­æ˜¯å¦æœ‰nilå€¼

```swift
var age = 2
// åŸæ¥æ–¹æ³•
 if age > 0 && age <= 9 {
     print("ï¼ˆ0~9ã€‘")
 }
 
 
// æ›´ä¼˜é›…çš„åŠæ³•
if case 0...9 = age { 
   print("ï¼ˆ0~9ã€‘") 
}   
// åˆ¤æ–­agesæ•°ç»„ä¸­æ˜¯å¦æœ‰nilå€¼
let ages:[Int?] = [2,3,nil,5]
        for case nil in ages {
            print("æœ‰nilå€¼")
            break
        }  
// å¾ªç¯
let points = [(1,0),(2,0),(3,0)]
for (x,y) in points {
   print(x,y)
}
for (x,0) in points {  //ä¼šæŠ¥é”™
}
for case let (x,0) in points {
   print(x)
}
```

## å¯é€‰æ¨¡å¼(Optional Pattern)

1. if case let x? = age { print(x) }  // åˆ¤æ–­ageä¸ºénilï¼Œå¹¶å°†ageè¿›è¡Œè§£åŒ…ï¼Œå°†è§£åŒ…åçš„å€¼æ‰“å°
2. åŒ:  if case .some(let x) = age { print(x) } 

## ç±»å‹è½¬æ¢æ¨¡å¼(Type-Casting Pattern)

```swift
let num1: Any = 6
        switch num1 {
        case is Int:
            print("is Int",num1)
        case let n as Double:  // næ˜¯Doubleç±»å‹
            print("is Double",n)
        default:
            break
        }
```

## è¡¨è¾¾å¼æ¨¡å¼(Expression Pattern)

1. è¡¨è¾¾å¼æ¨¡å¼ç”¨åœ¨caseä¸­

2.  

   ```swift
   switch point {
      case (-2...2, -2...2):  // è¡¨è¾¾å¼æ¨¡å¼
         print("å“ˆå“ˆå“ˆå“ˆ")
      defaultï¼š
        break
   }
   ```

3. è‡ªå®šä¹‰è¡¨è¾¾å¼æ¨¡å¼

   1. å¯ä»¥é€šè¿‡é‡è½½è¿ç®—ç¬¦ï¼Œè‡ªå®šä¹‰è¡¨è¾¾å¼æ¨¡å¼çš„åŒ¹é…è§„åˆ™

   2.  

      ```swift
      struct Student {
          var score = 0, name = ""
       
          // pattern: case åé¢çš„å†…å®¹
          // valueï¼š switchåé¢çš„å†…å®¹
          static func ~= (pattern: Int, value: Student) -> Bool {
              value.score >= pattern
          }
          static func ~= (pattern: Range<Int>, value: Student) -> Bool {
              pattern.contains(value.score)
          }
       
          static func ~= (pattern: ClosedRange<Int>, value: Student) -> Bool {
              pattern.contains(value.score)
          }
       
      }
       
       
      // ä½¿ç”¨
       var stu = Student(score: 88, name: "Jack")
              switch stu {
              case 100:
                  print(">=100")
              case 90...100:
                  print(">=90")
              case 80..<90:
                  print("[80-90)")
              default:break
              }
      ```

   3. è¿ç”¨2

   4. ```swift
      extension String {
       
          static func ~= (pattern: (String) -> Bool, value: String) -> Bool {
       
              pattern(value)
          }
      }
       
      func hasPrefix(_ prefix: String) -> ((String) -> Bool) { { $0.hasPrefix(prefix) } }
      func hasSuffix(_ suffix: String) -> ((String) -> Bool) { { $0.hasSuffix(suffix) } }
       
      let str = "123456899"
      switch str {
      case hasPrefix("123"),hasSuffix("456"):
          print("ä»¥123å¼€å¤´æˆ–è€…ä»¥456jç»“å°¾")
      default:
          break
      }
      ```

## where

1. å¯ä»¥ä½¿ç”¨whereä¸ºæ¨¡å¼åŒ¹é…å¢åŠ åŒ¹é…æ¡ä»¶

```swift
var ages1 = [10,20,44,23,55]
        for age1 in ages1 where  age1 > 30 {
            print(age1)
        }
```

#ä»Ocåˆ°Swift

## MARKã€TODOã€FIXME

1. // MARK: ç±»ä¼¼äºOcä¸­çš„ #pragma mark 
2. // MARK: - ç±»ä¼¼äºOcä¸­çš„ #pragma mark -
3. // TODO: ç”¨äºæ ‡è®°æœªå®Œæˆçš„ä»»åŠ¡
4. // FIXME: ç”¨äºæ ‡è®°å¾…ä¿®å¤çš„é—®é¢˜
5. // #warning("undo")  ç”¨TODOä¸æ˜¯ç‰¹æ˜æ˜¾ï¼Œä¹Ÿå¯ä»¥ç”¨è­¦å‘Š

## æ¡ä»¶ç¼–è¯‘

```swift
// è‡ªå®šä¹‰ç¼–è¯‘æ ‡è®°ï¼š Build Setting ä¸‹æœ swift compiler - custom
// æ–¹æ³•ä¸€:æœ¬æ¥æœ‰ä¸€ä¸ªDEBUGï¼Œä¹Ÿå¯ä»¥è‡ªå·±åŠ ï¼Œç©ºæ ¼+åå­—ï¼Œå°±å®šä¹‰äº†è‡ªå·±åå­—çš„æ ‡è®°
// æ–¹æ³•äºŒ: åœ¨Other Swift Flagsä¸‹æ·»åŠ  -D+ç©ºæ ¼+åå­—
 
 
// æ“ä½œç³»ç»Ÿ: macOS\iOS\tvOS\watchOS\Linux\Android\Windows\FreeBSD
#if os(macOS) || os(iOS)
 
 
// CPUæ¶æ„: i386\x86_64\arm\arm64
#elseif arch(arm64) || arch(x86_64)
 
 
// swiftç‰ˆæœ¬
#elseif swift(<5) && swift(>=3)
 
 
// æ¨¡æ‹Ÿå™¨
#elseif targetEnvironment(simulator)
 
 
// å¯ä»¥å¯¼å…¥æŸæ¨¡å—
#elseif canImport(Foundation)
 
 
#else
#endif
```

## logçš„å°è£…

```swift
// #file , #function, #line  // æ‰€åœ¨æ–‡ä»¶ã€æ–¹æ³•ã€å‡½æ•°
func log<T>(_ msg: T,
            file: NSString = #file,
            line: Int = #line,
            fn: String = #function) {
 
    #if DEBUG
    let prefix = "\(file.lastPathComponent)_\(line)_\(fn):"
    print(prefix, msg)
    #endif
}
```

## ç³»ç»Ÿç‰ˆæœ¬æ£€æµ‹

```swift
if #available(iOS 10, macOS 10.12, *) {
 
    // å¯¹äºiOSå¹³å°ï¼Œåªåœ¨iOS10åŠä»¥ä¸Šç‰ˆæœ¬æ‰§è¡Œ
    // å¯¹äºmacOSå¹³å°ï¼Œåªåœ¨macOS 10.12åŠä»¥ä¸Šç‰ˆæœ¬æ‰§è¡Œ
    // æœ€åçš„*è¡¨ç¤ºåœ¨å…¶ä»–æ‰€æœ‰å¹³å°éƒ½æ‰§è¡Œ
}
```

## APIå¯ç”¨æ€§è¯´æ˜

```swift
// personè¿™ä¸ªç±»åªèƒ½iOS10ï¼ŒmacOS 10.15ä»¥ä¸Šæ‰èƒ½ç”¨
@available(iOS 10, macOS 10.15,*)
class Person {
     
    // å½“è°ƒç”¨study_()çš„æ—¶å€™ä¼šæŠ¥é”™ï¼Œè¯´è¿™ä¸ªæ–¹æ³•å·²ç»æ”¹åäº†ï¼Œæ”¹ä¸ºstudy
    @available(*,unavailable,renamed: "study")
    func study_()  { }
    func study()  { }
    
    @available(iOS, deprecated: 11)
    @available(macOS,deprecated: 10.12)
    func run() { }  // è¿™ä¸ªæ–¹æ³•è¿‡æœŸäº†
}
```

## iOSç¨‹åºçš„å…¥å£

1. åœ¨AppDelegateä¸Šé¢é»˜è®¤æœ‰ä¸ª

   @UIApplicationMain

   æ ‡è®°ï¼Œè¿™è¡¨ç¤º

   1. ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆå…¥å£ä»£ç (mainå‡½æ•°ä»£ç ),è‡ªåŠ¨è®¾ç½®AppDelegateä¸ºAppçš„ä»£ç†

2. ä¹Ÿå¯ä»¥åˆ æ‰

   @UIApplicationMainï¼Œ

   è‡ªå®šä¹‰å…¥å£ä»£ç :

   1. æ–°å»ºç«‹ä¸€ä¸ªmain.swiftæ–‡ä»¶

   ```swift
   import UIKit
   // å¯ä»¥è‡ªå·±è‡ªå®šä¹‰ä¸ªUIApplication
   class MJApplication: UIApplication{}
   UIApplicationMain(CommandLine.argc,
                     CommandLine,unsafeArgv,
                     NSStringFromClass(MJApplication.self), // ä½œä¸º
                     NSStringFromClass(appDelegate.sel)) // ä½œä¸ºä»£ç†
   ```

## Swiftè°ƒç”¨OC

1. æ–°å»ºä¸€ä¸ªæ¡¥æ¥å¤´æ–‡ä»¶ï¼Œæ–‡ä»¶åæ ¼å¼é»˜è®¤ä¸º:{targetName}-Bridging-Header.h

2. Build Settingä¸‹æœbridgingï¼Œæ‰¾åˆ°Objective-C Bridging HeaderæŠŠè¿™ä¸ªæ–‡ä»¶è·¯å¾„æ”¾å…¥

3. ä¹Ÿå¯ä»¥ç”±ç³»ç»Ÿå¸®å¿™ç”Ÿæˆï¼ŒSwifté¡¹ç›®é‡Œæ–°å»ºç«‹Ocæ–‡ä»¶ï¼Œä¼šè‡ªåŠ¨å¼¹å‡ºè®©é€‰bridging

4. åœ¨{targetName}-Bridging-Header.hæ–‡ä»¶ä¸­#import  .hæ–‡ä»¶ï¼Œå°±å¯ä»¥åœ¨Swiftä¸­ä½¿ç”¨äº†

5. MJPerson(age: 20, name: "20")ä¼šå…ˆæ‰¾Ocä¸­è¯¥ç±»çš„å®ä¾‹æ–¹æ³•ï¼Œæ²¡æœ‰å†æ‰¾ç±»æ–¹æ³•ï¼Œç±»æ–¹æ³•ç›´æ¥é€šè¿‡ç±».functionè°ƒç”¨ï¼Œå®ä¾‹æ–¹æ³•é€šè¿‡å®ä¾‹.functionè°ƒç”¨

6. 

7. å¦‚æœCè¯­è¨€æš´éœ²ç»™Swiftçš„å‡½æ•°åè·ŸSwiftä¸­çš„å…¶ä»–å‡½æ•°åå†²çªäº†

8. 1. å¯ä»¥åœ¨Swiftä¸­ä½¿ç”¨**@_silgen_name**ä¿®æ”¹Cå‡½æ•°å
   2. **@_silgen_name("sum")** **func** swift_sum(**_** v1: Int32, **_** v2: Int32) -> Int32 // å°†Ocä¸­Cè¯­è¨€æ–¹æ³•sumæ–¹æ³•ä¿®æ”¹åˆ«åä¸ºSwift_sum

9.  

10. Ocè°ƒç”¨Swiftå’ŒSwiftè°ƒç”¨Ocäº’è°ƒä¸€æ ·

## OCè°ƒç”¨Swift

1. Xcodeå·²ç»é»˜è®¤ç”Ÿæˆä¸€ä¸ªç”¨äºOCè°ƒç”¨Swiftçš„å¤´æ–‡ä»¶ï¼Œæ–‡ä»¶åæ ¼å¼æ˜¯:{targetName}-Swift.h
2. Build Settingä¸‹æœgenerated interfaceï¼Œæ‰¾åˆ°Objective-C Generated interface Header Nameæœ‰è¿™ä¸ªæ–‡ä»¶è·¯å¾„
3. Swiftç±»è¦æƒ³æš´éœ²ç»™Ocï¼Œéœ€è¦ç»§æ‰¿NSObjectï¼Œç±»é‡Œå“ªäº›ä¸œè¥¿éœ€è¦æš´éœ²ç»™Ocï¼Œéœ€è¦åœ¨æ–¹æ³•ã€å±æ€§å‰é¢åŠ ä¸Š@objc,Swiftç±»å‰é¢åŠ ä¸Š@objcMembersè¯´æ˜è¯¥ç±»é‡Œæ‰€æœ‰å±æ€§éƒ½æš´éœ²ç»™Ocï¼Œå°±å¯ä»¥

```swift
// @objc(MJCar)  // å¦‚æœå†™ä¸Šè¿™å¥ï¼ŒOCè°ƒç”¨è¿™ä¸ªç±»ä¼šå½“æˆMJCaræ¥è°ƒç”¨
// åŸæœ¬swiftä¸­ç±»å‰é¢8ä¸ªè‡ªå·±å°±ä¸å†æ˜¯MetalTypeæ•°æ®ï¼Œç¬¬äºŒä¸ªæ˜¯å¼•ç”¨è®¡æ•°ï¼Œç„¶åä¾æ¬¡æ˜¯æˆå‘˜å˜é‡
// ç»§æ‰¿è‡ªNSObjectåï¼Œå‰8ä¸ªæ˜¯isaï¼Œç„¶åä¾æ¬¡æ˜¯æˆå‘˜å˜é‡ï¼Œæ‰€ä»¥å¤§å°ä¼šæ¯”swiftæ–¹å¼å°ä¸€ç‚¹
@objcMembers class Car: NSObject {
    var price: Double
    // @objc(name) // Ocä¸­ä½¿ç”¨bandå±æ€§é€šè¿‡.name
    var band: String
    @objc init(price: Double, band: String) {
        self.price = price
        self.band = band
    }
    // @objc(drive) // Ocä¸­è°ƒç”¨runæ–¹æ³•é€šè¿‡drive
   // @objc(exec:v2:) // Ocä¸­è°ƒç”¨runæ–¹æ³•é€šè¿‡ [c exec:10 v2:20]
    func run() { print(price, band, "run") }
    static func  run() { print("Car run") }
}
 
 
// åœ¨OCä¸­ä½¿ç”¨
Car *car = [[Car alloc] initWithPrice:10 band:@"20"];
[car run];  // runæ–¹æ³•ä¸éœ€è¦é¢å¤–å†™@objc,è€Œä¸”Swiftä¸­çš„æ‰©å±•ä¼šå˜æˆOCä¸­çš„åˆ†ç±»
```

4. å¯ä»¥é€šè¿‡@objcé‡å‘½åSwiftæš´éœ²ç»™Ocçš„ç¬¦å·å(ç±»åã€å±æ€§åã€å‡½æ•°åç­‰)
5. Ocè°ƒç”¨Swiftå’ŒSwiftè°ƒç”¨Ocäº’è°ƒä¸€æ ·

### é€‰æ‹©å™¨(Selector)

1. Swiftä¸­ä¾ç„¶å¯ä»¥ä½¿ç”¨é€‰æ‹©å™¨ï¼Œä½¿ç”¨#selector(name)å®šä¹‰ä¸€ä¸ªé€‰æ‹©å™¨
   1. å¿…é¡»æ˜¯è¢«@objcMembersæˆ–@objcä¿®é¥°çš„æ–¹æ³•æ‰å¯ä»¥å®šä¹‰é€‰æ‹©å™¨

## æ€è€ƒ

1. ä¸ºä»€ä¹ˆSwiftæš´éœ²ç»™OCçš„ç±»æœ€ç»ˆéƒ½è¦ç»§æ‰¿è‡ªNSObject?
   1. å› ä¸ºOCè°ƒç”¨æ–¹æ³•æ˜¯é€šè¿‡isaæŒ‡é’ˆï¼Œæ‰€ä»¥å¿…é¡»ç»§æ‰¿NSObjectï¼Œæ‰èƒ½æœ‰isaæŒ‡é’ˆ
2. Swiftè°ƒç”¨OCæ–¹æ³•åº•å±‚æ˜¯æ€ä¹ˆæ“ä½œçš„?
   1. çº¯Swiftè°ƒç”¨æ–¹æ³•é€šè¿‡è™šè¡¨æœºåˆ¶
   2. Swiftè°ƒç”¨OCæ–¹æ³•ï¼Œåº•å±‚æ˜¯è°ƒç”¨msg_sendï¼Œruntimeæœºåˆ¶
3. OCè°ƒç”¨Swiftæ–¹æ³•åº•å±‚æ€ä¹ˆæ“ä½œï¼Ÿ
   1. åº•å±‚æ˜¯è°ƒç”¨msg_sendï¼Œruntimeæœºåˆ¶ï¼Œå› ä¸ºä»–ç»§æ‰¿äº†NSObject
4. Swiftä¸­è°ƒç”¨äº†@objcMembersä»¥åŠç»§æ‰¿NSObject(å³èƒ½è¢«OCè°ƒç”¨)çš„æ–¹æ³•åº•å±‚æ˜¯æ€ä¹ˆè°ƒç”¨çš„?
   1. Swiftè°ƒç”¨ä¾ç„¶æ˜¯é€šè¿‡è™šè¡¨æœºåˆ¶(æ¯”è°ƒç”¨runtimeæœºåˆ¶æ€§èƒ½è¦å¥½ï¼Œå› ä¸ºä¸ç”¨é€šè¿‡isaæ‰¾æ–¹æ³•)
   2. å¦‚æœæƒ³èµ°runtimæœºåˆ¶ï¼Œåœ¨æ–¹æ³•å‰é¢åŠ ä¸Šä¿®é¥°ç¬¦: dynamic

## String

1. OCè°ƒç”¨Swiftçš„Stringä¼šæŠŠå®ƒè½¬æ¢æˆNSStringï¼Œ Swiftè°ƒç”¨Ocçš„NSStringä¼šæŠŠå®ƒè½¬æ¢æˆString
2. Swiftçš„å­—ç¬¦ä¸²Stringå’ŒOCçš„NSStringï¼Œåœ¨APIè®¾è®¡ä¸Šå·®å¼‚è¾ƒå¤§

```swift
var str: String = "1"
str.append("-2")
str = str + "-3" // Stringé‡è½½äº†è¿ç®—ç¬¦
str += "-4"  // Stringé‡è½½äº†è¿ç®—ç¬¦
str = "\(str)-5" // æ’å€¼
print(str,str.count) // é•¿åº¦
str.hasPrefix("123") // å‰ç¼€
str.hasSuffix("456") // åç¼€
 
 
// å’ŒOCå·®å¼‚è¾ƒå¤§
// Stringçš„æ’å…¥å’Œåˆ é™¤
str = "1-2"
// str.startIndex æ˜¯ String.Indexï¼Œæ˜¯ç»“æ„ä½“Stringå†…éƒ¨å®šä¹‰äº†ç»“æ„ä½“Index
// str.startIndex æ˜¯1çš„ä½ç½®
// str.endIndex æ˜¯2åé¢çš„ä½ç½®ï¼Œä¸æ˜¯2çš„ä½ç½®
print(str,str.startIndex,str.endIndex) // 1-2 Index(_rawBits: 1) Index(_rawBits: 196609)
str.insert("_", at: str.endIndex)  // 1-2-
str.insert(contentsOf: "3-4", at: str.endIndex) // 1-2-3-4
str.insert(contentsOf: "666", at: str.index(after: str.startIndex)) // 1666-2-3-4
str.insert(contentsOf: "888", at: str.index(before: str.endIndex)) // 1666-2-3-8884
str.insert(contentsOf: "hello", at: str.index(str.startIndex, offsetBy: 4)) // 1666hello-2-3-8884
 
 
str.remove(at: str.firstIndex(of: "1")!) // 666hello-2-3-8884
str.removeAll{ $0 == "6" } // hello-2-3-8884
var range = str.index(str.endIndex, offsetBy: -4)..<str.index(before: str.endIndex)
str.removeSubrange(range) // hello-2-3-4
```

## Substring

1. Stringå¯ä»¥é€šè¿‡ä¸‹æ ‡ã€prefixã€suffixç­‰æˆªå–å­ä¸²ï¼Œå­ä¸²ç±»å‹ä¸æ˜¯Stringï¼Œè€Œæ˜¯Substring
2. Substringä¹Ÿæœ‰æ‹¼æ¥ç­‰æ–¹æ³•
3. åº•å±‚SubStringå’ŒStringæ˜¯å…±ç”¨ä¸€å—åœ°å€ï¼Œè®°ç€è‡ªå·±çš„é‚£ä¸€æˆªä½ç½®ï¼Œå¹¶æ²¡æœ‰æ·±æ‹·è´ï¼Œå½“Substringè°ƒç”¨æ‹¼æ¥ç­‰æ–¹æ³•æ”¹å˜æ•°æ®å†…å®¹æ—¶ï¼Œå°±ä¼šæ·±æ‹·è´ä¸€ä»½

```swift
var str = "1-2-3-4-5"
var subStr1 = str.prefix(3) // 1-2
var subStr2 = str.suffix(3) // 4-5
 
var range = str.startIndex ..< str.index(str.startIndex, offsetBy: 3)
var subStr3 = str[range] // 1-2
 
print(subStr3.base)  //  æœ€åˆçš„1-2-3-4-5
 
var str2 = String(subStr3) // SubString -> String åˆ›å»ºæ–°String
print(str2)
```

## Stringç›¸å…³çš„åè®®

1. BidirectionalCollection åè®®åŒ…å«çš„éƒ¨åˆ†å†…å®¹
   1. startIndexã€endIndexå±æ€§ã€indexæ–¹æ³•
   2. Stringã€Arrayéƒ½éµå®ˆäº†è¿™ä¸ªåè®®
2. RangeReplaceableCollectionåè®®åŒ…å«çš„éƒ¨åˆ†å†…å®¹
   1. appendã€insertã€removeæ–¹æ³•
   2. Stringã€Arrayéƒ½éµå®ˆäº†è¿™ä¸ªåè®®

## å¤šè¡ŒString

1. BidirectionalCollection åè®®åŒ…å«çš„éƒ¨åˆ†å†…å®¹
2. å¤šè¡ŒStringï¼Œä»¥""" å¼€å¤´ """ç»“å°¾ï¼Œä¸­é—´åŒ…å«çš„æ‰€æœ‰åŒ…æ‹¬ç©ºæ ¼ã€æ¢è¡Œéƒ½æ˜¯Stringçš„ç»„æˆ

```swift
let str = """
  1"
   "2"
 jfldsj
        -3-
"""  // ç»“å°¾çš„ç¬¬ä¸€ä¸ª"ä¼šè®¤ä¸ºæ˜¯èµ·å§‹ä½ç½®ï¼Œé”ç€è¿™é‡Œ1"å‰é¢æ˜¯æœ‰ç©ºæ ¼çš„
```

## Stringä¸NSString

1. Stringä¸NSStringä¹‹é—´å¯ä»¥éšæ—¶éšåœ°æ¡¥æ¥è½¬æ¢ // ç”¨as æˆ– var str: NSString å°±å¯ä»¥
2. Stringè½¬NSStringæ±‡ç¼–å¯çœ‹åˆ°åº•å±‚è°ƒç”¨Swift.String.bridgeToObjectiveC()
3. æ¡¥æ¥è½¬æ¢ä¹‹åï¼Œç”Ÿæˆçš„æ–°stræ˜¯æ·±æ‹·è´ï¼Œå¦‚var str3 = str1 as NSString // str3å’Œstr1åœ°å€ä¸ä¸€æ ·ï¼Œstr1æ˜¯Stringç±»å‹ï¼Œå¯ä»¥æ‹¼æ¥ï¼Œstr3æ˜¯ä¸å¯å˜çš„ï¼Œå®ƒçš„appendæ–¹æ³•æ˜¯è¿”å›äº†ä¸€ä¸ªæ–°str
4. String ç”¨ === ï¼ŒNSStringä½¿ç”¨isEqualæ–¹æ³•ä¹Ÿå¯ä»¥===(æœ¬è´¨è¿˜æ˜¯è°ƒç”¨äº†isEqual)ï¼Œæ¥æ¯”è¾ƒå†…å®¹æ˜¯å¦ç­‰ä»·
5. Stringä¸èƒ½è½¬NSMutableStringï¼ŒNSMutableStringå¯ä»¥è½¬String
6. åŒç†Arrayå’ŒNSArrayã€NSMutableArrayï¼ŒDictionaryã€Setç­‰

#åè®®

## åªèƒ½è¢«classç»§æ‰¿çš„åè®®

1. **protocol** Runable1: AnyObject { }
2. **protocol** Runable2: class { }
3. **@objc** **protocol** Runable3{ }  // è¢«@objcä¿®é¥°çš„åè®®ï¼Œè¿˜å¯ä»¥æš´éœ²ç»™Ocå»éµå®ˆå®ç°

## å¯é€‰åè®®

1. å¯ä»¥é€šè¿‡@objcå®šä¹‰å¯é€‰åè®®ï¼Œè¿™ç§åè®®åªèƒ½è¢«classéµå®ˆ

## dynamic

1. è¢«@objc dynamicä¿®é¥°çš„å†…å®¹ä¼šå…·æœ‰åŠ¨æ€æ€§ï¼Œæ¯”å¦‚è°ƒç”¨æ–¹æ³•ä¼šèµ°runtimeé‚£ä¸€å¥—æµç¨‹

## KVC\KVO

1. è¢«Swiftæ”¯æŒkv\kvoçš„æ¡ä»¶
   1. å±æ€§æ‰€åœ¨çš„ç±»ã€ç›‘å¬å™¨æœ€ç»ˆç»§æ‰¿è‡ªNSObject
   2. ç”¨@objc dynamicä¿®é¥°å¯¹åº”çš„å±æ€§

### blockæ–¹å¼çš„KVO

```swift
class Person: NSObject {
   @objc dynamic var age = 10
    var weight = 20
    var height = 100
 
    var observer: Observer = Observer()
    override init() {
        super.init()
        observe(\Person.age, options: .new) { (person, change) in
            print(change.newValue as Any)
        }
        self.addObserver(observer, forKeyPath: "height", options: .new, context: nil)
    }
 
}
 
 
class Observer: NSObject {
 
    override class func observeValue(forKeyPath keyPath: String?, of object: Any?, change: [NSKeyValueChangeKey : Any]?, context: UnsafeMutableRawPointer?) {
        print("observeValue", change?[.newKey] as Any)
    }
}
```

## å…³è”å¯¹è±¡

1. åœ¨Swiftä¸­ï¼Œclassä¾ç„¶å¯ä»¥ä½¿ç”¨å…³è”å¯¹è±¡
   1. é»˜è®¤æƒ…å†µä¸‹ï¼Œswiftä¸­æ‰©å±•ä¸èƒ½æ·»åŠ æˆå‘˜å±æ€§ï¼Œåªèƒ½æ·»åŠ è®¡ç®—å±æ€§
2. å€ŸåŠ©å…³è”å¯¹è±¡ï¼Œå¯ä»¥å®ç°ç±»ä¼¼extensionä¸ºclasså¢åŠ å­˜å‚¨å±æ€§çš„æ•ˆæœ

```swift
class Person: NSObject {
 
}
 
 
extension Person {
 
    private static var AGE_KEY: Bool = false  // ä¹Ÿå¯ä»¥ç”¨voidï¼Œéƒ½åªå ç”¨ä¸€ä¸ªå­—èŠ‚ï¼Œçœå†…å­˜
 
    var age: Int {
        get {
            print(Mems.memStr(ofVal: &Self.AGE_KEY))
           return objc_getAssociatedObject(self, &Self.AGE_KEY) as? Int ?? -1
        }
        set {
 
            objc_setAssociatedObject(self, &Self.AGE_KEY, newValue, .OBJC_ASSOCIATION_ASSIGN)
        }
    }
}
```

### èµ„æºåç®¡ç†

1. æ–¹æ³•ä¸€: å‚è€ƒAndroidçš„èµ„æºåç®¡ç†æ–¹å¼

```swift
enum R {
    enum string: String {
       case add = "æ·»åŠ "
    }
    enum image: String {
       case logo   // åŸå§‹å€¼ï¼Œé»˜è®¤æ˜¯"logo"
       case cancel
    }
    enum seque: String {
       case login_main // åŒä¸Š
    }
}
// ä½¿ç”¨èµ„æº: R.string.add
```

2. æ›´å¤šä¼˜ç§€çš„æ€è·¯å‚è€ƒ https://github.com/mac-cain13/R.swift å’Œ https://github.com/SwiftGen/SwiftGen

# å¤šçº¿ç¨‹

## å¤šçº¿ç¨‹å¼€å‘-å¼‚æ­¥-å»¶è¿Ÿ

1. å¦‚ï¼šDispatchQueue.global().async

### DispatchWorkItemç”¨æ³•

```swift
struct Asyncs {
    public typealias Task = () -> Void
 
    public static func async(_ task: @escaping Task) {
 
        _async(task)
    }
 
 
    public static func async(_ task: @escaping Task,
                             _ mainTask: @escaping Task) {
          _async(task,mainTask)
    }
 
 
    public static func _async(_ task: @escaping Task,
                             _ mainTask: Task? = nil) {
        let item = DispatchWorkItem(block: task)
        DispatchQueue.global().async(execute: item)
        if let main = mainTask {
            item.notify(queue: DispatchQueue.main, execute: main) // é€šçŸ¥ä¸»é˜Ÿåˆ—æ‰§è¡Œä»»åŠ¡main
        }
    }
    // å»¶è¿Ÿæ–¹æ³•
    public static func delay(_ seconds: Double,
                             _ block: @escaping Task) -> DispatchWorkItem {
        let item = DispatchWorkItem(block: block)
        DispatchQueue.main.asyncAfter(deadline: DispatchTime.now()+seconds, execute: item)
        return item
    }
 
    // å¼‚æ­¥å»¶è¿Ÿæ–¹æ³•
    public static func asyncDelay(_ seconds: Double,
                             _ block: @escaping Task,
                             _ mainTask: Task? = nil) -> DispatchWorkItem {
        let item = DispatchWorkItem(block: block)
        DispatchQueue.global().asyncAfter(deadline: DispatchTime.now()+seconds, execute: item)
        if let main = mainTask {
            item.notify(queue: DispatchQueue.main, execute: main) // é€šçŸ¥ä¸»é˜Ÿåˆ—æ‰§è¡Œä»»åŠ¡main
        }
        return item
    }
}
// ä½¿ç”¨
Asyncs.async({
            print("å­çº¿ç¨‹å¹²çš„äº‹æƒ…")
        }) {
           print("ä¸»çº¿ç¨‹å¹²çš„äº‹æƒ…")
        }
let item = Asyncs.delay(2) {
            print("å»¶è¿Ÿ2ç§’æ‰§è¡Œ")
        }
       // item.cancel() // å–æ¶ˆè¿™ä¸ªitemä»»åŠ¡
```

## å¤šçº¿ç¨‹å¼€å‘-once

1. dispatch_onceåœ¨Swiftä¸­å·²è¢«åºŸå¼ƒï¼Œå–è€Œä»£ä¹‹
   1. å¯ä»¥ç”¨ ç±»å‹å±æ€§ æˆ–è€… å¸¸é‡å˜é‡\å¸¸é‡
   2. é»˜è®¤è‡ªå¸¦ lazy+dispatch_onceæ•ˆæœ

```swift
var age1: Int = {
    print(2)
    return 0
}()
 
 
class ViewController: UIViewController {
 
 
    // staticè¡¨ç¤ºæ˜¯é™æ€çš„(æœ¬è´¨å…¨å±€å˜é‡)ï¼Œåªä¼šåˆå§‹åŒ–ä¸€æ¬¡ï¼Œ
    static var age: Int = {
       print(1)
       return 0
    }()
 
    override func viewDidLoad() {
        super.viewDidLoad()
        // è™½ç„¶è°ƒç”¨å¤šæ¬¡ï¼Œä½†æ˜¯ageé‡Œçš„print(1)åªè°ƒç”¨1æ¬¡
        print(Self.age) // 1 0
        print(Self.age) // 0
        print(Self.age)  // 0
 
        print(age1) // 2 0
        print(age1)  // 0
    }
}
```

## å¤šçº¿ç¨‹å¼€å‘-åŠ é”

#å‡½æ•°å¼ç¼–ç¨‹

1. å‡½æ•°å¼ç¼–ç¨‹æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œä¹Ÿå°±æ˜¯å¦‚ä½•ç¼–å†™ç¨‹åºçš„æ–¹æ³•è®º
2. ä¸»è¦æ€æƒ³: æŠŠè®¡ç®—è¿‡ç¨‹å°½é‡åˆ†è§£æˆä¸€ç³»åˆ—å¯å¤ç”¨å‡½æ•°çš„è°ƒç”¨
3. ä¸»è¦ç‰¹å¾: å‡½æ•°æ˜¯"ç¬¬ä¸€ç­‰å…¬æ°‘"
4. å‡½æ•°ä¸å…¶ä»–æ•°æ®ç±»å‹ä¸€æ ·çš„åœ°ä½ï¼Œå¯ä»¥èµ‹å€¼ç»™å…¶ä»–å˜é‡ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå‡½æ•°å‚æ•°ã€å‡½æ•°è¿”å›å€¼
5. å‡½æ•°å¼ç¼–ç¨‹ä¸­å‡ ä¸ªå¸¸ç”¨çš„æ¦‚å¿µ
   1. Higher-Order Functionã€Function Curring
   2. Functorã€Applicative Functorã€Monad
6. å‡½æ•°å¼å†™æ³•

```swift
// å‡è®¾xè¦å®ç°ä»¥ä¸‹åŠŸèƒ½: [(num+3)*5-1]%10/2]
let num = 1
 
 
// æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªå‡½æ•°,é«˜é˜¶å‡½æ•°ã€æŸ¯é‡ŒåŒ–
func add(_ v: Int) -> (Int) -> Int { { $0 + v } }  // $0æ˜¯è¿”å›çš„å‡½æ•°çš„å‚æ•°ï¼Œ
func sub(_ v: Int) -> (Int) -> Int { { $0 - v } }
func multiple(_ v: Int) -> (Int) -> Int { { $0 * v } }
func divide(_ v: Int) -> (Int) -> Int { { $0 / v } }
func mod(_ v: Int) -> (Int) -> Int { { $0 % v } }
 
let fn1 = add(3)
let fn2 = multiple(5)
let fn3 = sub(1)
let fn4 = mod(10)
let fn5 = divide(2)
 
// æ•ˆæœ: fn5(fn4(fn3(fn2(fn1(num)))))
 
// ä¼˜åŒ–ç¬¬ä¸€æ­¥
// å‡½æ•°åˆæˆ
func composite(_ f1: @escaping (Int) -> Int,
               _ f2: @escaping (Int) -> Int) -> (Int) -> Int {
 
    return  { f2(f1($0))}
}
let fn21 = composite(add(3), multiple(5))
 
// ä¼˜åŒ–ç¬¬äºŒæ­¥
infix operator >>> : AdditionPrecedence // ä¼˜å…ˆçº§å’ŒåŠ æ³•ä¸€æ ·
//func >>>(_ f1: @escaping (Int) -> Int,
//         _ f2: @escaping (Int) -> Int) -> (Int) -> Int {
//
//    return  { f2(f1($0))}
//}
// è¿›ä¸€æ­¥ä¼˜åŒ–
func >>><A, B, C>(_ f1: @escaping (A) -> B,
                  _ f2: @escaping (B) -> C) -> (A) -> C {
 
    return  { f2(f1($0))}
}
let fn31 = add(3) >>> multiple(5) >>> sub(1) >>> mod(10) >>> divide(2)
print(fn31(num))
```

## é«˜é˜¶å‡½æ•°(Higher-Order Function)

1.  é«˜é˜¶å‡½æ•°æ˜¯è‡³å°‘æ»¡è¶³ä¸‹åˆ—ä¸€ä¸ªæ¡ä»¶çš„å‡½æ•°ï¼š
   1. æ¥å—ä¸€ä¸ªæˆ–å¤šä¸ªå‡½æ•°ä½œä¸ºè¾“å…¥(mapã€filterã€reduceç­‰)
   2. è¿”å›ä¸€ä¸ªå‡½æ•°

## æŸ¯é‡ŒåŒ–(Currying)

1.  ä»€ä¹ˆå«æŸ¯é‡ŒåŒ–ï¼š
   1. å°†ä¸€ä¸ªæ¥å—å¤šå‚æ•°çš„å‡½æ•°å˜æ¢æˆä¸€ç³»åˆ—åªæ¥å—å•ä¸ªå‚æ•°çš„å‡½æ•°
   2. Arrayã€Optionalçš„mapæ–¹æ³•æ¥æ”¶çš„å‚æ•°å°±æ˜¯ä¸€ä¸ªæŸ¯é‡ŒåŒ–å‚æ•°
2. ä¾‹å­:

```swift
func add22(_ v1: Int) -> (Int) -> ((Int) -> Int) {
          {
            v2 in {
                print(v1,v2,$0)  // 1 2 3
                return v1 + $0 + v2
            }
          }
        }
 
 
        let fn1 = add22(1)(2)(3)
        print(fn1)  // 6
```

3. æŸ¯é‡ŒåŒ–æ¨¡ç‰ˆï¼Œè‡ªåŠ¨å°†æ¥æ”¶2ä¸ªå‡½æ•°çš„æ–¹æ³•è½¬æˆæŸ¯é‡ŒåŒ–æ–¹å¼

```swift
func currying<A, B, C>(_ fn: @escaping (A, B) -> C) -> (B) -> (A) -> C {
 
            return { b in
                return { a in
                    return fn(a,b)
                }
            }
        }
```

## å‡½å­(Functor)

1.  åƒArrayã€Optionalè¿™æ ·æ”¯æŒmapè¿ç®—çš„ç±»å‹ï¼Œç§°ä¸ºå‡½å­
2. å¤åˆå…¬å¼: **func** map<T>(**_** fn: (Inner) -> T) -> Type<T>éƒ½å¯ä»¥ç§°ä¸ºå‡½å­ // InneræŒ‡é‡Œå¤´åŒ…è£…çš„ä¸œè¥¿
   1. Array: **func**map<T>(**_** fn: (Element) -> T) -> Array<T>
   2. Optional: **func**map<T>(**_** fn: (Wrapped) -> T) -> Optional<T>
3. èµ„æ–™
   1. http://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html
   2. http://www.mokacoding.com/blog/functor-applicative-monads-in-pictures/

## é€‚ç”¨å‡½å­(Applicative Functor)

1. å¯¹ä»»æ„ä¸€ä¸ªå‡½å­Fï¼Œå¦‚æœèƒ½æ”¯æŒä»¥ä¸‹è¿ç®—ï¼Œè¯¥å‡½å­å°±æ˜¯ä¸€ä¸ªé€‚ç”¨å‡½å­

   1. **func** pure<A>(**_** value: A) -> F<A> // éšä¾¿ç»™ä¸€ä¸ªå€¼ï¼Œéƒ½å¯ä»¥è¿”å›è‡ªå·±
   2. **func** <*><A,B>(fn:F<(A)->B>, value: F<A>) -> F<B>

2. Optionalå¯ä»¥æˆä¸ºé€‚ç”¨å‡½å­

   1. ```swift
      func pure<A>(_ value: A) -> A? { value }
      infix operator <*> : AdditionPrecedence
      func <*><A, B>(fn: ((A)->B)?, value: A?) -> B? {
         ``guard let f = fn, let v = value ``else` `{ ``return` `nil }
         ``return` `f(v)
      }
      // é€‚ç”¨
      var value: Int? = ``10
      var fn: ((Int) -> Int)? = { $``0` `* ``2` `}
      // Optional(20)
      print( fn <*> value as Any )
      ```

3. Arrayå¯ä»¥æˆä¸ºé€‚ç”¨å‡½å­

## å•å­(Monad)

1. å¯¹ä»»æ„ä¸€ä¸ªç±»å‹Fï¼Œå¦‚æœèƒ½æ”¯æŒä»¥ä¸‹è¿ç®—ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç§°ä¸ºæ˜¯ä¸€ä¸ªå•å­
   1. **func** pure<A>(**_** value: A) -> F<A> // éšä¾¿ç»™ä¸€ä¸ªå€¼ï¼Œéƒ½å¯ä»¥è¿”å›è‡ªå·±
   2. **func** flatMap<A,B>(_ value: F<A>,_ fn:F<(A)->B>) -> F<B>
2. Optionalã€Arrayéƒ½å¯ä»¥ç§°ä¸ºå•å­

## å‡½æ•°å¼ç¼–ç¨‹(POP)

1. æ˜¯Swiftçš„ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼ŒAppleäº2015å¹´WWDCæå‡º
2. åœ¨Swiftçš„æ ‡å‡†åº“ä¸­ï¼Œ èƒ½è§åˆ°å¤§é‡POPçš„å½±å­
3. åŒæ—¶Swiftä¹Ÿæ˜¯ä¸€é—¨é¢å¯¹å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€(OOP)
   1. åœ¨Swiftå¼€å‘ä¸­ï¼ŒOOPå’ŒPOPæ˜¯ç›¸è¾…ç›¸æˆçš„ï¼Œä»»ä½•ä¸€æ–¹å¹¶ä¸èƒ½å–ä»£å¦ä¸€æ–¹
4. é¢å‘åè®®æ€æƒ³ä¼˜å…ˆè€ƒè™‘çš„ä¸æ˜¯å†™ä¸€ä¸ªçˆ¶ç±»ç»§æ‰¿ï¼Œè€Œä¸”åè®®

## åˆ©ç”¨åè®®

1. æ˜¯Swiftçš„ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼ŒAppleäº2015å¹´WWDCæå‡º
2. åœ¨
3. åˆ©ç”¨åè®®å®ç°å‰ç¼€æ•ˆæœ

```swift
protocol MJCompatible { }
extension MJCompatible {
//    var mj: MJ<Self> { MJ(self) } // åªè¯»è®¡ç®—å±æ€§ï¼Œä¸ä¼šäº§ç”Ÿå¼ºå¼•ç”¨ï¼Œä½†æ˜¯ä¸èƒ½ä¿®æ”¹ï¼Œä¹Ÿå°±æ˜¯æ‰©å±•åŠŸèƒ½ä¸èƒ½æ˜¯mutatingæ–¹æ³•
    var mj: MJ<Self> {
        set {}
        get { MJ(self) }
    } // è¯»å†™è®¡ç®—å±æ€§ï¼Œä¸ä¼šäº§ç”Ÿå¼ºå¼•ç”¨
    static var mj: MJ<Self>.Type { MJ.self }  // è¿”å›ç±»
}
// è®©Stringæ‹¥æœ‰mjå‰ç¼€å±æ€§
extension String: MJCompatible { }
extension NSString: MJCompatible { }
 
var str = "123rrr"
struct MJ<Base> {
    var base: Base
    init(_ base: Base) {
        self.base = base
    }
}
// æ‰©å±•åŠŸèƒ½
//extension MJ where Base == String {
extension MJ where Base == ExpressibleByStringLiteral {
    var numberCount: Int {
        var count = 0
        for c in (base as! String) where ("0"..."9").contains(c) {
            count += 1
        }
        return count
    }
    mutating func change() {
 
    }
    static func test() {
 
    }
}
"123".mj.numberCount
var str: NSString = "123"
str.mj.change()
```

4. åˆ©ç”¨åè®®å®ç°ç±»å‹åˆ¤æ–­ ï¼ˆåè®®æœ€ç»ˆå°±æ˜¯ä¸ªå…·ä½“ç±»å‹ï¼‰

```swift
protocol ArrayType {
 
}
extension Array: ArrayType { }
extension NSArray: ArrayType { }
 
func isArrayType(_ type: Any.Type) -> Bool { type is ArrayType.Type }
 
print(isArrayType([Int].self)) // true
print(isArrayType([Any].self)) // true
print(isArrayType(NSArray.self)) // true
```

## Arrayçš„å¸¸è§æ“ä½œ

```swift
let arr = [1,2,3,4]
let arr2 = arr.map { $0 * 2 } // éå†æ‰€æœ‰å€¼*2
print(arr2,arr)  // [2, 4, 6, 8] [1, 2, 3, 4]
let arr3 = arr.filter{ $0 % 2 == 0 } // è¿‡æ¥èƒ½è¢«2æ•´é™¤çš„æ•°
print(arr3,arr)  // [2, 4] [1, 2, 3, 4]
 
// å¯ç®€å†™; let result = arr.reduce(0,+)
let result = arr.reduce(0) { (result, element) -> Int in  // è¿™é‡Œçš„Intå’Œ0ä¸€å®šæ˜¯åŒä¸€ä¸ªç±»å‹ï¼Œ
      return result + element
}  // å…ˆæ˜¯0å’Œç¬¬ä¸€ä¸ªå…ƒç´ ç›¸åŠ ï¼Œå¾—åˆ°çš„å€¼ç»™resultï¼Œç„¶åç¬¬äºŒä¸ªå…ƒç´ å’Œè¿™ä¸ªresultç›¸åŠ ï¼Œç”Ÿæˆæ–°result,ä»¥æ­¤ç±»æ¨ã€‚ã€‚ã€‚
print(result)  // 10
 
// mapæ–¹æ³•è¿˜å¯ä»¥è¿™æ ·ä½¿ç”¨
func double(_ i: Int) -> Int { i*2 }
print(arr.map(double))  // å› ä¸ºarré‡Œçš„å…ƒç´ æ˜¯intç±»å‹ï¼Œæ‰€ä»¥doubleçš„å‚æ•°ä¹Ÿéœ€è¦æ˜¯intï¼Œè¿”å›å€¼å¯ä»¥ä»»æ„
// Array.init(repeating: $0, count: $0)æŒ‡åˆ›å»º$0ä¸ªå•ä½æ•°ç»„ï¼Œæ¯ä¸ªå€¼æ˜¯$0
 var arr5 = arr.map{ Array.init(repeating: $0, count: $0) } // [[1], [2, 2], [3, 3, 3], [4, 4, 4, 4]]
 
// ä¼šæŠŠå¤šä¸ªæ•°ç»„æ•´åˆæˆä¸€ä¸ªæ•°ç»„
var arr6 = arr.flatMap{ Array.init(repeating: $0, count: $0) } // [1, 2, 2, 3, 3, 3, 4, 4, 4, 4]
let arr7 = ["123","test","-30"]
let arr8 = arr7.map{ Int($0) }  // [Optional(123), nil, Optional(-30)]
// å°†æ•°ç»„é‡Œçš„åŸå§‹è½¬æˆIntï¼Œè½¬ä¸äº†çš„æ¸…ç©º
let arr9 = arr7.compactMap{ Int($0) } //[123, -30]
print(arr8,arr9)
```

## lazyçš„ä¼˜åŒ–

1. arr.lazy.map // æ˜¯ä¸€ç§ä¼˜åŒ–ï¼Œå½“ç”¨åˆ°åé¢çš„æ•°æ®æ—¶å€™ï¼Œå†å¾ªç¯é‚£ä¸ªä½ç½®

## Optionalçš„mapå’ŒflatMap

1. Optionalä¹Ÿå¯ä»¥ä½¿ç”¨mapï¼Œå®ƒä¼šå…ˆè§£åŒ…ï¼Œå¦‚æœæœ‰å€¼å°†è§£åŒ…åçš„å€¼å†è°ƒç”¨é—­åŒ…é‡Œçš„æ–¹æ³•ï¼Œå¦‚æœè§£åŒ…åæ— çŸ¥ï¼Œç›´æ¥è¿”å›nil
2. å½“è°ƒç”¨Optionalçš„flatMapï¼Œé—­åŒ…é‡Œæ˜¯åŒ…è£…ä¸€ä¸ªå¯é€‰é¡¹ï¼Œé‚£ä¹ˆå¦‚æœè°ƒç”¨æ–¹è‡ªå·±å°±æ˜¯Optionalï¼Œå°±ä¸ä¼šå†åŒ…è£…ï¼Œè€Œç›´æ¥ç”¨map,å°±ä¼šç¼–ç¨‹Optional(Optional(å€¼))ç±»å‹

# å“åº”å¼ç¼–ç¨‹

## å“åº”å¼ç¼–ç¨‹(Reactive Programming)RP

1. äº1997å¹´æå‡ºï¼Œå¯ä»¥ç®€åŒ–å¼‚æ­¥ç¼–ç¨‹ï¼Œæä¾›æ›´ä¼˜é›…çš„æ•°æ®ç»‘å®š
2. ä¸€èˆ¬ä¸å‡½æ•°å¼èåˆåœ¨ä¸€èµ·ï¼Œæ‰€ä»¥ä¹Ÿä¼šå«åš: å‡½æ•°å“åº”å¼ç¼–ç¨‹(Functional Reactive Programming) FRP
3. æ¯”è¾ƒè‘—åã€æˆç†Ÿçš„å“åº”å¼æ¡†æ¶
   1. ReactiveCocoaï¼š
      1. ç®€ç§°RACï¼Œæœ‰Ocã€Swiftç‰ˆæœ¬
   2. ReactiveX
      1. ç®€ç§°Rxï¼Œæœ‰ä¼—å¤šç¼–ç¨‹è¯­è¨€çš„ç‰ˆæœ¬ï¼ŒRxJavaã€RxKotlinã€RxGoã€RxJSã€RxCppã€RxCppã€RxSwiftç­‰ç­‰

## RxSwift

1. ReactiveXçš„Swiftç‰ˆæœ¬
2. æºç : https://github.com/ReactiveX/RxSwift
3. ä¸­æ–‡æ–‡æ¡£: https://beeth0ven.github.io/RxSwift-Chinese-Documentation/
4. æ¨¡å—è¯´æ˜
   1. RxSwiftï¼š Rxæ ‡å‡†APIçš„Swiftå®ç°ï¼Œä¸åŒ…æ‹¬ä»»ä½•iOSç›¸å…³çš„å†…å®¹
   2. RxCocoa: åŸºäºRxSwiftï¼Œç»™iOS UIæ§ä»¶æ‰©å±•äº†å¾ˆå¤šRxç‰¹æ€§

### RxSwiftçš„æ ¸å¿ƒè§’è‰²

1. Observable:è´Ÿè´£å‘é€äº‹ä»¶(Event)
2. Observer:è´Ÿè´£è®¢é˜…Observableï¼Œç›‘å¬Observableå‘é€çš„äº‹ä»¶(Event) 

![RxSwift](/Swiftå…¥é—¨åˆ°ç²¾é€šç¬”è®°/RxSwift.png)

### åˆ›å»ºè®¢é˜…Observable

1. Observable:è´Ÿè´£å‘é€äº‹ä»¶(Event)

```swift
import UIKit
import Foundation
 
 
import RxSwift
import RxCocoa
  
    
class ViewController: UIViewController {
      
    var label: UILabel = UILabel(frame: CGRect(x: 100, y: 100, width: 100, height: 100))
     
    let bag = DisposeBag()
     
    override func viewDidLoad() {
        super.viewDidLoad()
         
        self.view.addSubview(label)
         
        // å¸¸è§æ¶ˆæ¯
        var observable = Observable<Int>.create { (observer) -> Disposable in
             
            observer.onNext(1)
             observer.onNext(2)
             observer.onNext(3)
            observer.onCompleted()
            return Disposables.create()
        }
        // å¦ä¸€ç§æ ¼å¼
//        observable = Observable.just(1)  // åªå‘ä¸€ä¸ªï¼ŒåŒ¹é…ä¸€ä¸ªonNextå’Œä¸€ä¸ªonCompleted
//        observable = Observable.of(1,2,3)  // å¯ä»¥å‘å¤šæ¬¡ï¼ŒåŒ¹é…å¤šä¸ªä¸ªonNextå’Œä¸€ä¸ªonCompleted
//        observable = Observable.from([1,2])  // å¯ä»¥å‘å¤šæ¬¡ï¼ŒåŒ¹é…å¤šä¸ªä¸ªonNextå’Œä¸€ä¸ªonCompleted
//
        // 2ç§’ä¹‹åæ¯éš”1ç§’å‘é€ä¸€ä¸ªæ¶ˆæ¯
        let observable2 = Observable<Int>.timer(.seconds(2), period: .seconds(1), scheduler: MainScheduler.instance)
         
         
        // è®¢é˜…,è®¢é˜…å¤šä¸ªï¼Œå¤šä¸ªéƒ½ä¼šèµ°
        observable.subscribe{ event in
            print(event)
        }.dispose()
          
        observable.subscribe(onNext: {
            print("next",$0)
        }, onError: {
            print("error",$0)
        }, onCompleted: {
            print("completed")
        }, onDisposed: {
            print("dispose")
        }).dispose()
         
        observable.subscribe(onNext: {
            print("next",$0)
        }, onError: {
            print("error",$0)
        }, onCompleted: {
            print("completed")
        }, onDisposed: {
            print("dispose")
            }).disposed(by: bag) // å½“bagé”€æ¯æ—¶ï¼Œè°ƒç”¨Disposableå®ä¾‹çš„dispose, è¿™é‡Œæ˜¯å½“è¿™ä¸ªé¡µé¢é”€æ¯æ—¶ï¼Œbagå°±é”€æ¯äº†
         
        // å½“selfé”€æ¯æ—¶ï¼Œè°ƒç”¨Disposableå®ä¾‹çš„dispose
       let _ = observable.takeUntil(self.rx.deallocated).subscribe(onNext: {
            print("next",$0)
        }, onError: {
            print("error",$0)
        }, onCompleted: {
            print("completed")
        }, onDisposed: {
            print("dispose")
            })
         
        // å…ˆç”¨mapå°†æ¥æ”¶åˆ°çš„å€¼åŒ…è£…æˆå­—ç¬¦ä¸²ï¼Œå†å°†å€¼ç»‘å®šåˆ°labelä¸Šï¼Œè¿™æ ·labelå°±æœ‰è®¡æ—¶æ•°å­—å€¼
      let _ = observable2.takeUntil(self.rx.deallocated).map{ "\($0)" }.bind(to: label.rx.text)
    }
}
```

### Disposable

1. æ¯å½“Observableè¢«è®¢é˜…æ—¶ï¼Œéƒ½ä¼šè¿”å›ä¸€ä¸ªDisposableå®ä¾‹ï¼Œå½“è°ƒç”¨Disposableçš„disposeï¼Œå°±ç›¸å½“äºå–æ¶ˆè®¢é˜…,ä¸Šä¾‹ä¸­æœ‰3ç§æ–¹å¼å–æ¶ˆè®¢é˜…

## åˆ›å»ºObserver

1. é™¤äº†Observableè®¢é˜…çš„æ–¹å¼ï¼Œä¹Ÿå¯ä»¥è‡ªå·±åˆ›å»ºObserverå®ç°ç›‘å¬

```swift
let observer = AnyObserver<Int>.init{ event in
     switch event {
        case .next(let data):
          print(data)
        case .completed:
          print("completed")
        case .error(let error):
          print("error",error)
        }
}
Observable.just(1).subscribe(observer).dispose()
 
let binder = Binder<String>(label) { label, text in
    label.text = text
}
Observable.just(1).map{ "\($0)" }.subscribe(binder).dispose()
```

## RxSwiftçš„çŠ¶æ€ç›‘å¬

1. UIæ§ä»¶ï¼ŒtableViewéƒ½å¯ä»¥åˆ©ç”¨RxSwiftå†™ï¼Œå†ä¹Ÿä¸ç”¨å†™tableview.delegate = **selfï¼Œ**å¦‚æœtableViewç”¨äº†RxSwiftå°±ä¸èƒ½ç”¨tableview.delegate = selfï¼Œå¦åˆ™RxSwiftä¼šæ— æ•ˆ

## å³æ˜¯Observableã€åˆæ˜¯Observer

1. è¯¸å¦‚UISlider.rx.valueã€UITextField.rx.textè¿™ç±»å±æ€§å€¼ï¼Œå³æ˜¯Observableã€åˆæ˜¯Observer
2. å®ƒä»¬æ˜¯RxCocoa.ControlPropertyç±»å‹

