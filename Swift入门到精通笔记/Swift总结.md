---
typora-root-url: ../../StudyNotes
---

[TOC]

# åŸºæœ¬è¯­æ³•

## åŸºç¡€

###ABI

ä»Swift5.0å¼€å§‹ABIç¨³å®šäº†

####æè¿°

ABIï¼ˆApplication Binary Interfaceï¼‰ï¼šåº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£ï¼Œæè¿°äº†åº”ç”¨ç¨‹åºå’Œæ“ä½œç³»ç»Ÿä¹‹é—´ï¼Œä¸€ä¸ªåº”ç”¨å’Œå®ƒçš„åº“ä¹‹é—´ï¼Œæˆ–è€…åº”ç”¨çš„ç»„æˆéƒ¨åˆ†ä¹‹é—´çš„ä½æ¥å£ã€‚ABIæ¶µç›–äº†å„ç§ç»†èŠ‚ï¼Œå¦‚ï¼š

+ æ•°æ®ç±»å‹çš„å¤§å°ã€å¸ƒå±€å’Œå¯¹é½
+ è°ƒç”¨çº¦å®šï¼ˆæ§åˆ¶ç€å‡½æ•°çš„å‚æ•°å¦‚ä½•ä¼ é€ä»¥åŠå¦‚ä½•æ¥å—è¿”å›å€¼ï¼‰ï¼Œä¾‹å¦‚ï¼Œæ˜¯æ‰€æœ‰çš„å‚æ•°éƒ½é€šè¿‡æ ˆä¼ é€’ï¼Œè¿˜æ˜¯éƒ¨åˆ†å‚æ•°é€šè¿‡å¯„å­˜å™¨ä¼ é€’ï¼›å“ªä¸ªå¯„å­˜å™¨ç”¨äºå“ªä¸ªå‡½æ•°å‚æ•°ï¼›é€šè¿‡æ ˆä¼ é€’çš„ç¬¬ä¸€ä¸ªå‡½æ•°å‚æ•°æ˜¯æœ€å…ˆpushåˆ°æ ˆä¸Šè¿˜æ˜¯æœ€å
+ ç³»ç»Ÿè°ƒç”¨çš„ç¼–ç å’Œä¸€ä¸ªåº”ç”¨å¦‚ä½•å‘æ“ä½œç³»ç»Ÿè¿›è¡Œç³»ç»Ÿè°ƒç”¨
+ ä»¥åŠåœ¨ä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»ŸABIä¸­ï¼Œç›®æ ‡æ–‡ä»¶çš„äºŒè¿›åˆ¶æ ¼å¼ã€ç¨‹åºåº“ç­‰ç­‰ã€‚

####ABIå’ŒAPIçš„åŒºåˆ«

+ APIæ˜¯Application Programming Interfaceçš„ç¼©å†™ï¼Œå³åº”ç”¨ç¨‹åºæ¥å£ã€‚ ä¸€ä¸ªAPIæ˜¯ä¸åŒä»£ç ç‰‡æ®µçš„è¿æ¥çº½å¸¦ã€‚å®ƒå®šä¹‰äº†ä¸€ä¸ªå‡½æ•°çš„å‚æ•°ï¼Œå‡½æ•°çš„è¿”å›å€¼ï¼Œä»¥åŠä¸€äº›å±æ€§æ¯”å¦‚ç»§æ‰¿æ˜¯å¦è¢«å…è®¸ã€‚ å› æ­¤**APIæ˜¯ç”¨æ¥çº¦æŸç¼–è¯‘å™¨çš„**ï¼šä¸€ä¸ªAPIæ˜¯ç»™ç¼–è¯‘å™¨çš„ä¸€äº›æŒ‡ä»¤ï¼Œå®ƒè§„å®šäº†æºä»£ç å¯ä»¥åšä»¥åŠä¸å¯ä»¥åšå“ªäº›äº‹ã€‚
+ ABIæ˜¯Application Binary Interfaceçš„ç¼©å†™ï¼Œåº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£ã€‚ ä¸€ä¸ªABIæ˜¯ä¸åŒäºŒè¿›åˆ¶ç‰‡æ®µçš„è¿æ¥çº½å¸¦ã€‚ å®ƒå®šä¹‰äº†å‡½æ•°è¢«è°ƒç”¨çš„è§„åˆ™ï¼šå‚æ•°åœ¨è°ƒç”¨è€…å’Œè¢«è°ƒç”¨è€…ä¹‹é—´å¦‚ä½•ä¼ é€’ï¼Œè¿”å›å€¼æ€ä¹ˆæä¾›ç»™è°ƒç”¨è€…ï¼Œåº“å‡½æ•°æ€ä¹ˆè¢«åº”ç”¨ï¼Œä»¥åŠç¨‹åºæ€ä¹ˆè¢«åŠ è½½åˆ°å†…å­˜ã€‚ å› æ­¤**ABIæ˜¯ç”¨æ¥çº¦æŸé“¾æ¥å™¨çš„**ï¼šä¸€ä¸ªABIæ˜¯æ— å…³çš„ä»£ç å¦‚ä½•åœ¨ä¸€èµ·å·¥ä½œçš„è§„åˆ™ã€‚ ä¸€ä¸ªABIä¹Ÿæ˜¯ä¸åŒè¿›ç¨‹å¦‚ä½•åœ¨ä¸€ä¸ªç³»ç»Ÿä¸­å…±å­˜çš„è§„åˆ™ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨Linuxç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªABIå¯èƒ½å®šä¹‰ä¿¡å·å¦‚ä½•è¢«æ‰§è¡Œï¼Œè¿›ç¨‹å¦‚ä½•è°ƒç”¨syscallï¼Œä½¿ç”¨å¤§ç«¯è¿˜æ˜¯å°ç«¯ï¼Œä»¥åŠæ ˆå¦‚ä½•å¢é•¿

###ç¼–è¯‘æµç¨‹

![ç¼–è¯‘æµç¨‹](/Swiftå…¥é—¨åˆ°ç²¾é€šç¬”è®°/ç¼–è¯‘æµç¨‹.png)

ocå’Œswiftçš„ç¼–è¯‘å™¨å‰ç«¯(clangå’Œswiftc)éƒ½å­˜æ”¾åœ¨Xcodeå†…éƒ¨(Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin)

1. ç”Ÿæˆè¯­æ³•æ ‘: swiftc -dump-ast main.swift
2. ç”Ÿæˆæœ€ç®€æ´çš„SILä»£ç : swiftc -emit-sil main.swift
3. ç”ŸæˆLLVM IRä»£ç : swiftc -emit-ir main.swift
4. ç”Ÿæˆæ±‡ç¼–ä»£ç : swiftc -emit-assembly main.swift 

###PlayGround

1. print("hello \(a)") // aæ˜¯å¸¸é‡æˆ–å˜é‡
2. Command+Shift+Enter è¿è¡Œæ•´ä¸ªplayGround
3. Shift+Enter åªè¿è¡Œåˆ°é¼ æ ‡ä½ç½®å¤„ä»£ç 
4. import PlaygroundSupport    å†PlaygroundPage.current.liveView = view ï¼ˆå¯ä»¥å°†viewå±•ç¤ºå†playgroundä¸Šï¼‰
5. æ˜¾ç¤ºmarkUpæ•ˆæœï¼Œ Editor ---> Show Rendered Markup

```swift
//:# ä¸€çº§æ ‡é¢˜
/*:
##åŸºç¡€è¯­æ³•
-å˜é‡
-å¸¸é‡
[è‹¹æœå®˜ç½‘](www.apple.com)
[ä¸‹ä¸€é¡µ](@next)
*/
```

## æ•°æ®ç±»å‹

```swift
var num = 10
num+= 20
 
let age: Int
age = num // å¸¸é‡ä¸è¦æ±‚åœ¨ç¼–è¯‘æ—¶ç¡®å®šï¼Œåªè¦ä½¿ç”¨ä¹‹å‰èµ‹å€¼å°±è¡Œ
// å¸¸é‡ã€å˜é‡åœ¨åˆå§‹åŒ–ä¹‹å‰ï¼Œéƒ½ä¸èƒ½ä½¿ç”¨
//æ ‡è¯†ç¬¦(å¸¸é‡åã€å˜é‡åã€æ–¹æ³•å)å¯ä»¥æ˜¯ä»»ä½•å­—ç¬¦,è¡¨æƒ…ä¹Ÿå¯ä»¥
//Floatï¼Œ 32ä½ï¼Œç²¾åº¦åªæœ‰6ä½ï¼›Doubleï¼Œ64ä½ç½®ï¼Œç²¾åº¦è‡³å°‘15ä½
```

### å¸¸è§æ•°æ®ç±»å‹

![å¸¸è§æ•°æ®ç±»å‹](/Swiftå…¥é—¨åˆ°ç²¾é€šç¬”è®°/å¸¸è§æ•°æ®ç±»å‹.png)

### å­—é¢é‡

å­—é¢é‡ä¹Ÿè¾ƒç«‹å³æ•°

```swift
let character: Character = "ğŸ¶"
// æ•´æ•°
let intDecimal = 17  // åè¿›åˆ¶
let intBinary = 0b10001 // äºŒè¿›åˆ¶
let intOctal = 0O21 // å…«è¿›åˆ¶
let intHextadecimal = 0x11 // åå…­è¿›åˆ¶
//æµ®ç‚¹æ•°
let doubleDecimal = 125.0 // åè¿›åˆ¶
let doubleHexadecimal1 = 0xFp2  // åå…­è¿›åˆ¶,15*2^2,ç›¸å½“äºåè¿›åˆ¶çš„60.0
let doubleHexadecimal2 = 0xFp-2  // åå…­è¿›åˆ¶,15*2^-2ï¼Œç›¸å½“äºåè¿›åˆ¶çš„3.75
// æ•´æ•°å’Œæµ®ç‚¹æ•°å¯ä»¥æ·»åŠ é¢å¤–çš„é›¶æˆ–è€…æ·»åŠ ä¸‹åˆ’çº¿æ¥å¢å¼ºå¯è¯»æ€§
100_0000.000_000_1, 000123.456
//ç±»å‹è½¬æ¢
let int1: UInt16 = 2_000
let int2: UInt8 = 1
let int3 = int1 + UInt16(int2)
// å…ƒç»„
let error = (404, "Not Find")
error.0 // 404
error.1  // Not Find
let(code,message) = error
code // 404
let(code,_) = error // å¿½ç•¥Not Find
let http200Status = (statusCode:200,description:"OK")
http200Status.statusCode
```

## æµç¨‹æ§åˆ¶

### if-else

+ ifåé¢çš„æ¡ä»¶å¯ä»¥çœç•¥å°æ‹¬å·ã€åªèƒ½æ˜¯Boolç±»å‹
+ æ¡ä»¶åé¢çš„å¤§æ‹¬å·ä¸å¯ä»¥çœç•¥çš„

### while

### repeat{}whileæ¡ä»¶

+ ç›¸å½“äºCè¯­éŸ³ä¸­çš„do-while

### ~~++~~

ä¸å†æ”¯æŒï¼›æŠ¥é”™ Use of unresolved operator '++'; did you mean '+= 1'?

+ å¯¹äºvar age = 10; ++age + ++age
+ å¾®è½¯ç¼–è¯‘å™¨ç»“æœ:  12+12
+ Xcodeç¼–è¯‘å™¨ç»“æœ: 11+12

### for

+ é—­åŒºé—´è¿ç®—ç¬¦: a...b, a<= å–å€¼ <=b

  ```swift
  for i in 0...3 {
     print(names[i])  // 1 2 3 4
  }
  let rang = 1...3
  for i in rang {
    print(names[i]) // 2 3 4
  }
  // ié»˜è®¤æ˜¯let,æœ‰éœ€è¦æ—¶å¯ä»¥å£°æ˜ä¸ºvar
  for var i in 1...3 {
    i += 5
    print(i)  // 6 7 8
  }
  for _ in 1...3 {
     print("123") // 123 123 123
  }
  // åŒºé—´è¿ç®—ç¬¦ç”¨åœ¨æ•°ç»„ä¸Š
  for name in names[0...3] {
    print(name)  // 1 2 3 4
  }
  // å•ä¾§åŒºé—´:è®©åŒºé—´æœä¸€ä¸ªæ–¹å‘å°½å¯èƒ½çš„è¿œ
  for name in names[2...] { // 2ã€3ã€4
     print(name)  // 3 4 5
  }
  for name in names[...2] { // 0ã€1ã€2
     print(name) // 1 2 3
  }
  for name in names[..<2] { // 0ã€1
     print(name) // 1 2
  }
  
  let range = ...5 // è´Ÿæ— ç©·-5
  range.contains(-3) // true
  // åŒºé—´ç±»å‹
  let range1: Range<Int> = 1..<3
  // å­—ç¬¦ã€å­—ç¬¦ä¸²ä¹Ÿèƒ½ä½¿ç”¨åŒºé—´è¿ç®—ç¬¦ã€ä½†é»˜è®¤ä¸èƒ½ç”¨åœ¨for-inä¸­
  let stringRange1 = "cc"..."ff"
  stringRange1.contains("cb")  // false
  stringRange1.contains("dz")  // true
  stringRange1.contains("fg")  // false
  // \0-ï½æ‰€æœ‰å¯èƒ½ç”¨åˆ°çš„ASCIIå­—ç¬¦
  let characterRange: ClosedRange<Character> = "\0"..."~"
  // å¸¦é—´éš”çš„åŒºé—´å€¼
  let hours = 11
  let hourInterval = 2
  // tickMarkçš„å–å€¼:ä»4å¼€å§‹,ç´¯åŠ 2ï¼Œä¸è¶…è¿‡11
  for tickMark in stride(from:4,through:hours,by:hourInterval) {
     print(tickMark) // 4 6 8 10
  }
  
  // å°†æ‰€æœ‰æ­£æ•°åŠ èµ·æ¥
  var numbers = [10,20,-10,-20,30,-30]
  var sum = 0
  for num in numbers where num>0 {
    sum += num
  } // 60
  print(sum) // 60 ; where num>0ç›¸å½“äºä¸ç¬¦åˆæ¡ä»¶continue
  ```

### switch

1. caseã€defaultåé¢ä¸èƒ½å†™å¤§æ‹¬å·{}
2. é»˜è®¤å¯ä»¥ä¸å†™breakï¼Œå¹¶ä¸ä¼šè´¯ç©¿åˆ°åé¢çš„æ¡ä»¶
3. ä½¿ç”¨fallthroughå¯ä»¥å®ç°è´¯ç©¿æ•ˆæœ
4. switchå¿…é¡»è¦ä¿è¯èƒ½å¤„ç†æ‰€æœ‰æƒ…å†µ
5. caseã€defaultåé¢è‡³å°‘è¦æœ‰ä¸€æ¡è¯­å¥
6. å¦‚æœèƒ½ä¿è¯å·²å¤„ç†æ‰€æœ‰æƒ…å†µï¼Œä¹Ÿå¯ä»¥ä¸å¿…ä½¿ç”¨default
7. switchä¹Ÿæ”¯æŒCharacterã€Stringç±»å‹
8. å¦‚æœä¸æƒ³åšä»»ä½•äº‹ï¼ŒåŠ ä¸ªbreakæ—¢å¯

```swift
let names = [1,2,3,4,5]
var number = 1
switch number {
  case 1:
     print("number is 1")
     break
  case 2:
     print("number is 2")
     fallthrough  // ä¼šè´¯ç©¿åˆ°ä¸‹ä¸€ä¸ªåˆ¤æ–­
  default:
     print("number is 2")
} // number is 1

let string = "jack"
switch string {
  case "jack":
    fallthrough
  case "Rose":
    print("12")
  default:
    break
}   // 12

// åŒºé—´åŒ¹é…
let count = 62
switch count {
  case 0:
    print("none")
  case 1..<5:
    print("a few")
  default:
    print("many")
} // many

// å…ƒç»„åŒ¹é…
var point = (1,1)
switch point {
  case (0,0):
    print("the origin")
  case (_,0):
    print("on the x-axis") // å·¦è¾¹ä»€ä¹ˆå€¼éƒ½å¯ä»¥
  case(-2...2,-2...2):
    print("inside the box")
  default:
    print("outside the box")
} // inside the box

// å€¼ç»‘å®š
point = (2,0)
switch point {
  case (let x,0):
    print("on the x-axis with an x value of \(x)")
  case let(x,y):
    print("somewhere else at (\(x),\(y))")
} // on the x-axis with an x value of 2


// æ ‡ç­¾è¯­å¥
outer: for i in 1...4 {
  for k in 1...4 {
    if k==3 {
      continue outer
    }
    if i==3 {
      break outer
    }
    print("i==\(i),k==\(k)")
  }
} // i==1,k==1   i==1,k==2   i==2,k==1   i==2,k==2
```

#å‡½æ•°

1. å½¢å‚é»˜è®¤æ˜¯letï¼Œä¹Ÿåªèƒ½æ˜¯let

2. éšå¼è¿”å›ï¼Œå¦‚æœæ•´ä¸ªå‡½æ•°ä½“æ˜¯ä¸€ä¸ªå•ä¸€è¡¨è¾¾å¼,é‚£ä¹ˆå‡½æ•°ä¼šéšå¼è¿”å›æ•´ä¸ªè¡¨è¾¾å¼

   ```swift
   func sum(v1: Int, v2: Int) -> Int {
     v1+v2 // ä¸ç”¨å†™return,éšå¼è¿”å›
   }
   // è¿”å›å…ƒç»„ï¼Œå®ç°è¿”å›å¤šè¿”å›å€¼
   func calculate(v1: Int, v2:Int) -> (sum:Int,difference:Int,average:Int) {
     let sum = v1+v2;
     return (sum,v1-v2,sum>>1)
   }
   let result = calculate(v1:20,v2:10)
   result.sum
   result.difference
   result.average
   ```

3. å‡½æ•°çš„æ–‡æ¡£æ³¨é‡Š(é¼ æ ‡åœ¨æ–¹æ³•ä¸ŠæŒ‰ä½optionæ—¢å¯å‡ºç°)[æ›´å¤šè¯­æ³•è§„èŒƒ](https://swift.org/documentation/api-design-guidelines/)

   ```swift
   /// æ±‚å’Œ[æ¦‚è¿°]
   ///
   /// å°†2ä¸ªæ•´æ•°ç›¸åŠ [æ›´è¯¦ç»†çš„æè¿°]
   ///
   /// - Parameter v1: ç¬¬ä¸€ä¸ªæ•´æ•°
   /// - Parameter v2: ç¬¬äºŒä¸ªæ•´æ•°
   /// - Returns : 2ä¸ªæ•´æ•°çš„å’Œ
   ///
   /// - Note:ä¼ å…¥2ä¸ªæ•´æ•°æ—¢å¯[æ‰¹æ³¨]
   ///
   func sum(v1: Int, v2: Int) -> Int {
     v1+v2 
   }
   ```

4. å‚æ•°æ ‡ç­¾ã€é»˜è®¤å‚æ•°å€¼

   ```swift
   // å‚æ•°æ ‡ç­¾
   func goToWork(at time: String) {
     print("this time is \(time)")
   }
   goToWork(at: "08:00")
    
   // é»˜è®¤å‚æ•°å€¼,c++ä¹Ÿå¯ä»¥è®¾ç½®é»˜è®¤å€¼ï¼Œåªæ˜¯c++é»˜è®¤å‚æ•°å€¼å¿…é¡»åœ¨æœ€å³è¾¹ï¼Œswiftå› ä¸ºæœ‰å‚æ•°æ ‡ç­¾ä¸é™åˆ¶ï¼Œæ‰€ä»¥çœç•¥äº†å‚æ•°æ ‡ç­¾ï¼Œc++çš„é—®é¢˜å°±éœ€è¦ç‰¹åˆ«æ³¨æ„
   // å› ä¸ºc++è°ƒç”¨å‡½æ•°å‚æ•°æ˜¯å¯¹å·å…¥åº§çš„ï¼Œ
   func check(name: String = "nobody", age: Int, job:String="none"){
     print("name=\(name),age=\(age),job=\(job)")
   }
   check(name:"Rose",age:18)
    
   // å¦‚æœåªæƒ³ç»™middleèµ‹å€¼ï¼Œè¿™é‡Œçš„middleä¸å¯ä»¥çœç•¥æ ‡ç­¾
   func test(_ first: Int = 10, middle: Int, _ last: Int = 30) {
       print("first=\(first),middle=\(middle),last=\(last)")
   }
   test(middle: 20)
   ```

5. å¯å˜å‚æ•°

   + ä¸€ä¸ªå‡½æ•°æœ€å¤šåªèƒ½æœ‰1ä¸ªå¯å˜å‚æ•°
   + ç´§è·Ÿåœ¨å¯å˜å‚æ•°åé¢çš„å‚æ•°ä¸èƒ½çœç•¥å‚æ•°æ ‡ç­¾

   ```swift
   // ä¸€ä¸ªå‡½æ•°æœ€å¤šåªèƒ½æœ‰1ä¸ªå¯å˜å‚æ•°
   // ç´§è·Ÿåœ¨å¯å˜å‚æ•°åé¢çš„å‚æ•°ä¸èƒ½çœç•¥å‚æ•°æ ‡ç­¾
   func sum(_ numbers: Int...) -> Int {
     var total = 0
     for number in numbers {
       total += number
     }
     return total
   }
   sum(10,20,30,40)
   ```

## printå‡½æ•°

```swift
// public func print(_ items:Any...,separator:String=" ",terminator:String="\n") æ¥æ”¶å¤šä¸ªå‚æ•°ï¼Œè¿™äº›å‚æ•°é»˜è®¤ä»¥" "è¿æ¥ï¼Œç»“æœæ˜¯\n
print("1","2","3") //1 2 3\n
print("1","2","3",separator:"_",terminator:"")//1_2_3
```

##è¾“å…¥è¾“å‡ºå‡½æ•°(In-Out Parameter)

1. å¯ä»¥ç”¨inoutå®šä¹‰ä¸€ä¸ªè¾“å…¥è¾“å‡ºå‚æ•°: å¯ä»¥åœ¨å‡½æ•°å†…éƒ¨ä¿®æ”¹å¤–éƒ¨å®å‚çš„å€¼
2. å¯å˜å‚æ•°ä¸èƒ½æ ‡è®°ä¸ºinout
3. inoutå‚æ•°ä¸èƒ½æœ‰é»˜è®¤å€¼
4. inoutå‚æ•°çš„æœ¬è´¨æ˜¯åœ°å€ä¼ é€’(å¼•ç”¨ä¼ é€’)
   1. å¦‚æœä¼ é€’ç»™inout
5. inoutåªæ¥å—å¯ä»¥è¢«å¤šæ¬¡èµ‹å€¼çš„

```swift
var number = 10
func add(_ num: inout Int) {
   num = 20
}
add(&number) // numberä¸èƒ½æ˜¯letï¼Œä¸èƒ½è¢«å¤šæ¬¡èµ‹å€¼
print(number) // 20ï¼Œ
```

### æ±‡ç¼–éƒ¨åˆ†

1. callq åé¢è·Ÿç€å‡½æ•°åœ°å€ã€leaqç”¨äºåšåœ°å€ä¼ é€’ç”¨
2. %å¼€å¤´çš„æ˜¯å¯„å­˜å™¨,  
3. leaq   0x10da(%rip),%rdi  // (å°†0x10da+ripåœ°å€çš„å’Œèµ‹å€¼ç»™rdi,æ‰€ä»¥rdiå­˜å‚¨çš„æ˜¯åœ°å€å€¼)
   1. ripå­˜å‚¨çš„æ˜¯æŒ‡ä»¤çš„åœ°å€ï¼Œå­˜çš„å†…å®¹æ˜¯ä¸‹ä¸€ä¸ªæ±‡ç¼–æŒ‡ä»¤çš„å‰é¢æ ‡è®°çš„åœ°å€
   2. CPUè¦æ‰§è¡Œçš„ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€å°±å­˜å‚¨åœ¨ripä¸­
4. movq  &0x14,(%rdi)  //ï¼ˆå°†16è¿›åˆ¶çš„14èµ‹å€¼ç»™rdiæ‰€å­˜å‚¨åœ°å€æ‰€åœ¨çš„ç©ºé—´,()æ‰¾åˆ°åœ°å€æŒ‡å‘çš„ç©ºé—´ï¼‰
5. movq  -ox30(%rbp),%rdi  //å°†rbp-0x30çš„åœ°å€æ‰€åœ¨ç©ºé—´çš„å€¼èµ‹å€¼ç»™%rdi

##å‡½æ•°é‡è½½

+ è§„åˆ™

  1. å‡½æ•°åç›¸åŒ
  2. å‚æ•°ä¸ªæ•°ä¸åŒ||å‚æ•°ç±»å‹ä¸åŒ||å‚æ•°æ ‡ç­¾ä¸åŒ

+ è¿”å›å€¼ç±»å‹æœ‰æ— ä¸åŒä¸æ„æˆå‡½æ•°é‡è½½

+ é»˜è®¤å‚æ•°å€¼å’Œå‡½æ•°é‡è½½ä¸€èµ·ä½¿ç”¨äº§ç”ŸäºŒä¹‰è¡Œæ—¶ï¼Œç¼–è¯‘å™¨å¹¶ä¸ä¼šæŠ¥é”™(åœ¨c++ä¸­ä¼šæŠ¥é”™)

+ å¯å˜å‚æ•°ã€çœç•¥å‚æ•°æ ‡ç­¾ã€å‡½æ•°é‡è½½ä¸€èµ·ä½¿ç”¨äº§ç”ŸäºŒä¹‰æ€§æ—¶ï¼Œç¼–è¯‘å™¨æœ‰å¯èƒ½æŠ¥é”™

  ```swift
  // è¿™æ®µæ”¾å¼€å°±ä¼šæŠ¥é”™
  //func sum(v1:Int, v2:Double) -> Int {
  //    v1+Int(v2)+1
  //}
  func sum(_ v1:Int, _ v2:Int) -> Int {
    v1+v2
  }
  //func sum(v1:Int,v2:Int,v3:Int=30) -> Int {
  //  v1+v2+v3
  //}
  func sum(_ v1:Int,_ v2:Int,_ v3:Int=30) -> Int {
    v1+v2+v3
  }
  
  func sum(_ v1:Int...) -> Int {
      v1.first ?? 0
  }
   
  print(sum(10,20)) // 30
  ```

## å†…è”å‡½æ•°

1. å¦‚æœå¼€å¯äº†ç¼–è¯‘å™¨ä¼˜åŒ–(Releaseæ¨¡å¼é»˜è®¤ä¼šå¼€å¯ä¼˜åŒ–),ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å°†æŸäº›å‡½æ•°å˜æˆå†…è”å‡½æ•°
   1. Build Settings ä¸‹æœç´¢optimizationä¼šçœ‹åˆ°Swift Complierï¼Œ 
2. å†…è”å°±æ˜¯å°†å‡½æ•°è°ƒç”¨å±•å¼€æˆå‡½æ•°ä½“,(å³è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œæ˜¯å°†æ•´ä¸ªå‡½æ•°ä½“çš„ä»£ç æ‹¿å‡ºæ¥æ‰§è¡Œï¼Œå‡å°‘äº†å‡½æ•°è°ƒç”¨å¼€é”€ï¼Œ)
3. å“ªäº›å‡½æ•°ä¸ä¼šå†…è”
   1. å‡½æ•°ä½“æ¯”è¾ƒé•¿
   2. é€’å½’è°ƒç”¨
   3. åŒ…å«åŠ¨æ€æ´¾å‘
   4. ...
4. @inline
   1. åœ¨Releaseæ¨¡å¼ä¸‹ï¼Œç¼–è¯‘å™¨å·²ç»å¼€å¯ä¼˜åŒ–ï¼Œä¼šè‡ªåŠ¨å†³å®šå“ªäº›å‡½æ•°éœ€è¦å†…è”ï¼Œå› æ­¤æ²¡å¿…è¦ä½¿ç”¨@inline

```swift
// æ°¸è¿œä¸ä¼šè¢«å†…è”(å³ä½¿å¼€å¯è”ç¼–è¯‘å™¨ä¼˜åŒ–)
@inline(never) func test() {
   print("test")
}
// å¼€å¯è”ç¼–è¯‘å™¨ä¼˜åŒ–åï¼Œå³ä½¿ä»£ç å¾ˆé•¿ï¼Œä¹Ÿä¼šè¢«å†…è”(é€’å½’è°ƒç”¨å‡½æ•°ã€åŠ¨æ€æ´¾å‘çš„å‡½æ•°é™¤å¤–)
@inline(__always) func test(){
  print("test")
}
```

## å‡½æ•°ç±»å‹

1. æ¯ä¸€ä¸ªå‡½æ•°éƒ½æ˜¯æœ‰ç±»å‹çš„ï¼Œå‡½æ•°ç±»å‹ç”±å½¢å¼å‚æ•°ç±»å‹ã€è¿”å›å€¼ç±»å‹ç»„æˆ

   ```swift
   func test() {}  // () -> Void æˆ–è€… () -> ()
   func sum(a:Int,b:Int) -> Int {
     a+b
   } // (Int,Int) -> Int
   // å®šä¹‰å˜é‡
   var fn:(Int,Int) -> Int = sum  // å°†å‡½æ•°ç±»å‹èµ‹å€¼ç»™å˜é‡
   fn(2,3) // è°ƒç”¨æ—¶ä¸éœ€è¦å‚æ•°æ ‡ç­¾
   ```

2. å‡½æ•°ç±»å‹ä½œä¸ºå‡½æ•°å‚æ•°

   ```swift
   func sum(a:Int,b:Int) -> Int {
     a+b
   }
   func difference(a:Int,b:Int) -> Int {
     a-b
   } 
   func printResult(_ mathFn:(Int,Int)->Int,_ a:Int,_ b:Int) {
     print("Result:\(mathFn(a,b))")
   }
   printResult(sum,5,2) // Result:7
   printResult(difference,5,2) // Result:3
   ```

3. å‡½æ•°ç±»å‹ä½œä¸ºè¿”å›å€¼ï¼Œè¿”å›å€¼æ˜¯å‡½æ•°ç±»å‹çš„å‡½æ•°ï¼Œå«åšé«˜é˜¶å‡½æ•°

## typealias

1. ç”¨æ¥ç»™ç±»å‹èµ·åˆ«å

   ```swift
   typealias Byte = Int8
   typealias Date = (year:Int,month:Int,day:Int)
   typealias IntFn = (Int,Int)->Int
   ```

2. æŒ‰ç…§Swiftæ ‡å‡†åº“çš„å®šä¹‰ï¼ŒVoidå…¶å®å°±æ˜¯ç©ºå…ƒç¥–

   ```swift
   typealias Void = ()
   ```

## åµŒå¥—å‡½æ•°

1. å°†å‡½æ•°å®šä¹‰åœ¨å‡½æ•°å†…éƒ¨

# æšä¸¾

```swift
enum Direction {
   case north
   case south
   case east
}
var dir = Direction.north
dir = .south
```

## å…³è”å€¼

æœ‰æ—¶ä¼šå°†æšä¸¾çš„æˆå‘˜å€¼è·Ÿå…¶ä»–ç±»å‹çš„å…³è”å­˜å‚¨åœ¨ä¸€èµ·ï¼Œä¼šéå¸¸æœ‰ç”¨

```swift
enum Score {
  case point(Int)
  case grade(Character)
  case digit(year:Int,month:Int,day:Int)
}
var score = Score.point(96)
score = .grade("A")
 
 
switch score {
  case let .point(i):
      print(i,"points")
  case let .grade(i):
      print("grade",i)
  case .digit(let year,let month,let day):
      print("let å†™å‰é¢è¡¨ç¤ºyearã€monthã€dayéƒ½æ˜¯letï¼Œä¹Ÿå¯ä»¥åˆ†å¼€å†™")
}
```

## åŸå§‹å€¼

1. æšä¸¾æˆå‘˜å¯ä»¥ä½¿ç”¨ç›¸åŒç±»å‹çš„é»˜è®¤å€¼é¢„å…ˆå…³è”ï¼Œè¿™ä¸ªé»˜è®¤å€¼å«åšåŸå§‹å€¼
2. å¦‚æœæšä¸¾çš„åŸå§‹å€¼ç±»å‹æ˜¯Int(0\1\2é€’å¢)ã€String(å³æ˜¯caseçš„å€¼æ¯”å¦‚notrh=â€œnorthâ€),Swiftä¼šè‡ªåŠ¨åˆ†é…åŸå§‹å€¼
3. åŸå§‹å€¼æ˜¯ä»€ä¹ˆå¹¶ä¸ä¼šå½±å“è¿™ä¸ªæšä¸¾çš„å¤§å°

```swift
enum Grade: String {
  case perfect = "A"
  case great = "B"
  case good = "C"
}
```

## é€’å½’æšä¸¾

æšä¸¾é‡Œçš„ä¸€ä¸ªcaseå…³è”æšä¸¾ï¼Œéœ€è¦åŠ ä¸Šindirectä¿®é¥°

```swift
indirect enum ArithExpr {
  case number(Int)
  case sum(ArithExpr,ArithExpr)
}
```

## memoryLayout

è·å–ç±»å‹å ç”¨çš„å†…å­˜å¤§å°

```swift
// å…³è”å€¼ã€åŸå§‹å€¼çš„åŒºåˆ«
// å¦‚æœæ˜¯å…³è”å€¼ï¼Œæ˜¯å°†å†…å®¹ç›´æ¥å­˜å‚¨è¿›å†…å­˜é‡Œ
// å¦‚æœæ˜¯åŸå§‹å€¼ï¼Œå€¼æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥ä¸ç®¡ä»€ä¹ˆç±»å‹ï¼Œéƒ½åªæ˜¯å°†æ¯ä¸ªå€¼æ ‡ä¸ªåºå·(åªå ä¸€ä¸ªå­—èŠ‚)ï¼Œè°ƒç”¨x.rawValueæ‰ä¼šçœŸæ­£æ‹¿åˆ°é»˜è®¤å€¼
//memoryLayout.size      // å®é™…ç”¨åˆ°çš„ç©ºé—´å¤§å°
//memoryLayout.stride    // åˆ†é…å ç”¨çš„ç©ºé—´å¤§å°
//memoryLayout.alignment // å¯¹é½å‚æ•°
 
enum Password {
   case number(Int,Int,Int,Int) // 32
   case other  // 1
}
var pwd = Password.number(5,6,7,8)
pwd = .other
 
print(MemoryLayout<Password>.size) // 33
print(MemoryLayout<Password>.stride)    // 40
print(MemoryLayout<Password>.alignment)  // 8
 
 
enum Season : String {
   case spring = "spring",sumer = "sumer",autumn = "autumn",winter = "winter"
}
var s = Season.spring
 
print(MemoryLayout<Season>.size)       // 1
print(MemoryLayout<Season>.stride)     // 1
print(MemoryLayout<Season>.alignment)  // 1
```

# å¯é€‰é¡¹(Optional)

1. å¯é€‰ç±»å‹å…è®¸å°†å€¼è®¾ç½®ä¸ºnil
2. åœ¨ç±»å‹åç§°åé¢åŠ ä¸ªé—®å¥½?æ¥å®šä¹‰ä¸€ä¸ªå¯é€‰é¡¹
3. é€šè¿‡å­—å…¸æ‹¿åˆ°çš„å€¼æ˜¯å¯é€‰é¡¹ï¼Œé€šè¿‡æ•°ç»„æ‹¿åˆ°çš„å°±æ˜¯å€¼ï¼Œæ•°ç»„è¶Šç•Œä¼šå´©æºƒ

```swift
var age: Int   // æ²¡æœ‰åˆå§‹å€¼
var kage: Int?  // é»˜è®¤ä¸ºnil
 
 
// å¼ºåˆ¶è§£åŒ…
var num = Int("123")
if num != nil {
   print("è½¬æ¢æˆåŠŸ:\(num!)")
} else {
   print("è½¬æ¢å¤±è´¥")
}
 
 
// å¯é€‰é¡¹ç»‘å®š
if let number = Int("123") { // number ä½œç”¨åŸŸåªåœ¨è¿™ä¸ªå¤§é˜”å·é‡Œ
   print("è½¬æ¢æˆåŠŸ:\(number)")
} else {
   print("è½¬æ¢å¤±è´¥")
}
 
 
// åŒæ—¶æˆç«‹åˆ¤æ–­,ç›¸å½“äºfirstæœ‰å€¼è§£åŒ…æˆåŠŸ&&secondæœ‰å€¼è§£åŒ…æˆåŠŸ&&first < second // && second < 100çš„è¯æ‰“å°...  å¯¹äºå¯é€‰é¡¹ç»‘å®šçš„å¹¶ä¸”ç”¨ï¼Œä¸èƒ½ç”¨&&
if let first = Int("4"),
   if second = Int("42"),
   first < second && second < 100 {
   print("\(second) < \(second) < 100")
}
 
 
// whileå¾ªç¯ä¸­ä½¿ç”¨å¯é€‰é¡¹ç»‘å®š
// éå†æ•°ç»„,å°†é‡åˆ°çš„æ­£æ•°éƒ½åŠ èµ·æ¥ï¼Œå¦‚æœé‡åˆ°è´Ÿæ•°æˆ–è€…éæ•°å­—ï¼Œåœæ­¢éå†
var strs = ["10","20","abc","-20","30"]
var index = 0
var sum = 0
while let num = Int(strs[index]),num>0 {  // å¹¶ä¸”
   sum += num
   index += 1
}
 
 
// ?? ä¸ if leté…åˆä½¿ç”¨
let a: Int? = nil
let b: Int? = 2
if let c = a ?? b { // ç±»ä¼¼äº if a!=nil||b!=nil
   print(c)
}
```

##å¼ºåˆ¶è§£åŒ…

1. å¯é€‰é¡¹æ˜¯å¯¹å…¶ä»–ç±»å‹çš„ä¸€å±‚åŒ…è£…ï¼Œå¯ä»¥å°†å®ƒç†è§£ä¸ºä¸€ä¸ªç›’å­
2. å¦‚æœä¸ºnilï¼Œé‚£ä¹ˆæ˜¯ä¸ªç©ºç›’å­
3. å¦‚æœä¸ä¸ºnilï¼Œé‚£ä¹ˆç›’å­é‡Œè£…çš„æ˜¯:è¢«åŒ…è£…ç±»å‹çš„æ•°æ®
4. å¦‚æœè¦ä»å¯é€‰é¡¹ä¸­å–å‡ºè¢«åŒ…è£…çš„æ•°æ®(å°†ç›’å­é‡Œè£…çš„ä¸œè¥¿å–å‡ºæ¥),éœ€è¦ä½¿ç”¨æ„Ÿå¹å·!è¿›è¡Œå¼ºåˆ¶è§£åŒ…
5. å¦‚æœå¯¹å€¼ä¸ºnilçš„å¯é€‰é¡¹(ç©ºç›’å­)è¿›è¡Œå¼ºåˆ¶è§£åŒ…ï¼Œå°†ä¼šäº§ç”Ÿè¿è¡Œæ—¶é”™è¯¯

##å¯é€‰é¡¹ç»‘å®š

1. å¯ä»¥ä½¿ç”¨å¯é€‰é¡¹ç»‘å®šæ¥åˆ¤æ–­å¯é€‰é¡¹æ˜¯å¦åŒ…å«å€¼
2. å¦‚æœåŒ…å«å€¼å°±è‡ªåŠ¨è§£åŒ…ï¼ŒæŠŠå€¼èµ‹ç»™ä¸€ä¸ªä¸´æ—¶çš„å¸¸é‡(let)æˆ–è€…å˜é‡(var),å¹¶è¿”å›true,å¦åˆ™è¿”å›false
3. å¯é€‰é¡¹ç»‘å®šçš„"å¹¶ä¸”"ç”¨','è¡¨ç¤ºï¼Œä¸èƒ½ç”¨'&&'

##ç©ºåˆå¹¶è¿ç®—ç¬¦??

1. a??b  // å¦‚æœaä¸ä¸ºnilï¼Œè¿”å›aï¼Œå¦‚æœaä¸ºnilï¼Œè¿”å›b
2. a æ˜¯å¯é€‰é¡¹ï¼Œbå¯ä»¥æ˜¯å¯é€‰é¡¹ä¹Ÿå¯ä»¥ä¸æ˜¯å¯é€‰é¡¹ï¼Œaè·Ÿbçš„å­˜å‚¨ç±»å‹å¿…é¡»ç›¸åŒ
3. å¦‚æœbä¸æ˜¯å¯é€‰é¡¹ï¼Œè¿”å›aæ—¶ä¼šè‡ªåŠ¨è§£åŒ…

## guard

1. å½“guardæ¡ä»¶ä¸ºfalseæ—¶ï¼Œå°±ä¼šæ‰§è¡Œå¤§æ‹¬å·é‡Œçš„ä»£ç 
2. å½“guardæ¡ä»¶ä¸ºtrueæ—¶ï¼Œå°±ä¼šè·³è¿‡guardè¯­å¥
3. å½“ä½¿ç”¨guardè¯­å¥è¿›è¡Œå¯é€‰é¡¹ç»‘å®šæ—¶ï¼Œç»‘å®šçš„å¸¸é‡(let)ã€å˜é‡(var)ä¹Ÿèƒ½åœ¨å¤–å±‚ä½œç”¨åŸŸä¸­ä½¿ç”¨

```swift
guard æ¡ä»¶ else {
    
   é€€å‡ºå½“å‰ä½œç”¨åŸŸ// returnã€breakã€continueã€throwã€error
}
 
 
// ä½¿ç”¨
func login(_ info:[String:String]) {
   guard let username = info["username"] else {
      print("è¯·è¾“å…¥ç”¨æˆ·å")
      return
   }
   guard let password = info["password"] else {
      print("è¯·è¾“å…¥å¯†ç ")
      return
   }
   // è¿›è¡Œç™»å½•
   print("ç”¨æˆ·å:\(username)","å¯†ç :\(password)","ç™»é™†ing")
}
```

## éšå¼è§£åŒ…

1. åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯é€‰é¡¹ä¸€æ—¦è¢«è®¾å®šå€¼ä¹‹åï¼Œå°±ä¼šä¸€ç›´æ‹¥æœ‰å€¼
2. åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å»æ‰æ£€æŸ¥ï¼Œä¹Ÿä¸å¿…æ¯æ¬¡è®¿é—®çš„æ—¶å€™éƒ½è¿›è¡Œè§£åŒ…ï¼Œå› ä¸ºå®ƒèƒ½ç¡®å®šæ¯æ¬¡è®¿é—®çš„æ—¶å€™éƒ½æœ‰å€¼
3. å¯ä»¥åœ¨ç±»å‹åé¢åŠ ä¸ªæ„Ÿå¹å·ï¼å®šä¹‰ä¸€ä¸ªéšå¼è§£åŒ…çš„å¯é€‰é¡¹

```swift
let num1: Int! = 10  // è™½ç„¶æ˜¯ç›’å­ï¼Œä½†æ˜¯æ˜¯ï¼ï¼Œæ‰€ä»¥ä¼šè‡ªåŠ¨è§£åŒ…
let num2: Int = num1 // éšå¼è§£åŒ…äº† Intç±»å‹
let num3 = num1  // Int? ç±»å‹

let num4: Int? = 10  // è™½ç„¶æ˜¯ç›’å­ï¼Œä½†æ˜¯æ˜¯ï¼ï¼Œæ‰€ä»¥ä¼šè‡ªåŠ¨è§£åŒ…
let num5: Int = num4  // ä¼šæŠ¥é”™
```

##å¯é€‰é¡¹çš„å­—ç¬¦ä¸²æ’å€¼

å¯é€‰é¡¹åœ¨å­—ç¬¦ä¸²æ’å€¼æˆ–è€…ç›´æ¥æ‰“å°æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå‘å‡ºè­¦å‘Š

```swift
var age: Int? = 10   // 10 æˆ– nil
print("My age is \(age)") // ä¼šæœ‰è­¦å‘Š My age is Optional(10) æˆ– My age is nil
//æ¶ˆé™¤è­¦å‘Šæ–¹æ³•
print("My age is \(age!)") // My age is 10 æˆ– å´©æºƒ
print("My age is \(String(describing: age))")  // My age is Optional(10) æˆ– My age is nil
print("My age is \(age ?? 0)")  // My age is 10 æˆ– My age is 0
```

## å¤šé‡å¯é€‰é¡¹

xcodeå‘½ä»¤è¡Œè¾“å…¥: fr v -R x (å¯ä»¥çœ‹åˆ°å¯¹è±¡çš„ç»„æˆç»“æ„)

```swift
var num11: Int? = 10
/* num1 = some { 
 *  some = {
 *    _value = 10
 *  }
 * }
*/
var num22: Int?? = num1
var num33: Int?? = 10
print(num22 == num33) // true
 
 
var num1: Int? = nil
/* num1 = none {  // ä¸ºnoneçš„æ—¶å€™é‡Œé¢çš„å†…å®¹æ— æ„ä¹‰
 *  some = {
 *    _value = 0
 *  }
 * }
*/
var num2: Int?? = num1
/* num2 = some {
    some = none { 
 *    some = {
 *      _value = 0
 *    }
 * }
  }
*/
var num3: Int?? = nil
/* num3 = none {
    some = some { 
 *    some = {
 *      _value = 0
 *    }
 * }
  }
*/
print(num2 == num3) // false é‡ç‚¹  å¦‚æœnum2å’Œnum3å­˜çš„valueéƒ½æ˜¯1ï¼Œé‚£ä¹ˆä¸ºtrueï¼Œå› ä¸ºè‡ªé¡¶å‘ä¸‹éƒ½æ˜¯someã€someã€1
print(num1 == num3) // false ç±»å‹ä¸åŒ
(num2 ?? 1) ?? 2  // 2  é‡ç‚¹ num2ä¸ä¸ºnil
(num3 ?? 1) ?? 2  // 1  é‡ç‚¹ num3ä¸ºnil
```

# æ±‡ç¼–

## çª¥æ¢å†…å­˜

1. æ‰“æ–­ç‚¹â†’View Memory of 'num' æˆ–è€…å·¥å…·æ â†’Debugä¸‹Debug Workflowçš„View Memory
2. æŸ¥çœ‹å†…å­˜åœ°å€çš„å°å·¥å…·: https://github.com/CoderMJLee/Mems ï¼ˆæŠŠMems.Swiftæ‹–å…¥é¡¹ç›®æ—¢å¯ç”¨ï¼‰
3. æŸ¥çœ‹æ™®é€šæšä¸¾ï¼Œå‘ç°æšä¸¾ç”¨äº†ä¸€ä¸ªå­—èŠ‚æ¥å­˜å‚¨ï¼Œå­˜å‚¨0ã€1ã€2ã€ã€ã€ã€ã€
4. å¯¹äºå…³è”å€¼ï¼Œä¸€ä¸ªå­—èŠ‚å­˜å‚¨æˆå‘˜å€¼ï¼ŒNä¸ªå­—èŠ‚å­˜å‚¨å…³è”å€¼(Nå–å ç”¨å†…å­˜æœ€å¤§çš„å…³è”å€¼)

```swift
// å¯ä»¥çœ‹åˆ°ç”¨å‰é¢24ä¸ªå­—èŠ‚å­˜å‚¨å†…å®¹å€¼
// ç¬¬25ä¸ªå­—èŠ‚ç”¨æ¥è¡¨ç¤ºæ˜¯å“ªä¸€ä¸ªæšä¸¾
enum TestEnum {
  case test1(Int,Int,Int) // 24
  case test2(Int,Int)
  case test3(Int)
  case test4(Bool)
  case test5
}

var e = TestEnum.test1(1,2,3)
// å°ç«¯: é«˜é«˜ä½ä½
// 01 00 00 00 00 00 00 00
// 02 00 00 00 00 00 00 00
// 03 00 00 00 00 00 00 00
// 00
// 00 00 00 00 00 00 00
print(Mems.ptr(ofVal:&e)) // æ‰“å°åœ°å€ï¼Œå†é€šè¿‡View Memory of 'num'æˆ–è€…æ§åˆ¶å°x/20 0x0000000100008228æŸ¥çœ‹è¯¥åœ°å€ä¸‹å­˜å‚¨çš„å†…å®¹
e = .test2(4,5)
// 04 00 00 00 00 00 00 00
// 05 00 00 00 00 00 00 00
// 00 00 00 00 00 00 00 00
// 01
// 00 00 00 00 00 00 00
e = .test3(6)
e = .test4(true)
e = .test5
 
 
MemoryLayout<TestEnum>.size       // 25
MemoryLayout<TestEnum>.stride     // 32
MemoryLayout<TestEnum>.alignment  // 8
 
 
// åªæœ‰ä¸€ä¸ªå€¼çš„æšä¸¾,å¹¶ä¸ä¼šå ç”¨å†…å­˜
enum TestEn {
  case test
}
var t = TestEn.test
MemoryLayout<TestEn>.size       // 0
MemoryLayout<TestEn>.stride     // 1
MemoryLayout<TestEn>.alignment  // 1
// åŒç†åªæœ‰ä¸€ä¸ªå€¼çš„å…³è”æšä¸¾,å¹¶ä¸éœ€è¦é¢å¤–ä¸€ä¸ªå­—èŠ‚æ ‡ç¤ºæ˜¯å“ªä¸ªæšä¸¾
enum TestE {
  case test(Int)
}
var te = TestE.test
MemoryLayout<TestE>.size       // 8
MemoryLayout<TestE>.stride     // 8
MemoryLayout<TestE>.alignment  // 8
```

## ç¨‹åºçš„æœ¬è´¨

1. å­˜æ”¾åœ¨ç¡¬ç›˜çš„ç¨‹åº\è½¯ä»¶  ----è£…è½½---->å†…å­˜(å…¨æ˜¯0101çš„æ•°æ®) <---è¯»å†™----> CPU ----> æ§åˆ¶ ----->è®¡ç®—æœº(æ˜¾ç¤ºå™¨ã€éŸ³å“ã€è¯ç­’ã€å…¶ä»–è®¾å¤‡)

2. CPU(å¯„å­˜å™¨(ä¿¡æ¯å­˜å‚¨)ã€è¿ç®—å™¨(è¿ç®—å¤„ç†)ã€æ§åˆ¶å™¨)

3. å¯„å­˜å™¨ä¸å†…å­˜

   1. é€šå¸¸ï¼ŒCPUä¼šå…ˆå°†å†…å­˜ä¸­çš„æ•°æ®å­˜å‚¨åˆ°å¯„å­˜å™¨ä¸­ï¼Œç„¶åå†å¯¹å¯„å­˜å™¨ä¸­çš„æ•°æ®è¿›è¡Œè¿ç®—

      ![å¯„å­˜å™¨ä¸å†…å­˜](/Swiftå…¥é—¨åˆ°ç²¾é€šç¬”è®°/å¯„å­˜å™¨ä¸å†…å­˜.png)

##ç¼–ç¨‹è¯­è¨€çš„å‘å±•

1. æœºå™¨è¯­è¨€
   1. ç”±0å’Œ1ç»„æˆ
2. æ±‡ç¼–è¯­è¨€
   1. ç”¨ç¬¦å·ä»£æ›¿æ¥0å’Œ1ï¼Œæ¯”æœºå™¨è¯­è¨€ä¾¿äºé˜…è¯»å’Œè®°å¿†
3. é«˜çº§è¯­è¨€
   1. C\C++\Java\JavaScript\Pythonç­‰ï¼Œæ›´æ¥è¿‘äººç±»è‡ªç„¶è¯­è¨€
4. é«˜çº§è¯­è¨€ ----ç¼–è¯‘---> æ±‡ç¼–è¯­è¨€ ----ç¼–è¯‘---> æœºå™¨è¯­è¨€ ----è¿è¡Œ---> è®¡ç®—æœº
   1. æ±‡ç¼–è¯­è¨€å’Œæœºå™¨è¯­è¨€ä¸€ä¸€å¯¹åº”ï¼Œæ¯ä¸€æ¡æœºå™¨æŒ‡ä»¤éƒ½æœ‰ä¸ä¹‹å¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤
   2. æ±‡ç¼–è¯­è¨€å¯ä»¥é€šè¿‡ç¼–è¯‘å¾—åˆ°æœºå™¨è¯­è¨€ï¼Œæœºå™¨è¯­è¨€å¯ä»¥é€šè¿‡åæ±‡ç¼–å¾—åˆ°æ±‡ç¼–è¯­è¨€
5. æ±‡ç¼–è¯­è¨€çš„ç§ç±»
   1. 8086æ±‡ç¼–(16bit)
   2. x86æ±‡ç¼–(32bit)
   3. x64æ±‡ç¼–(64bit)
   4. ARMæ±‡ç¼–(åµŒå…¥å¼ã€ç§»åŠ¨è®¾å¤‡)
   5. .....
6. x86ã€x64æ±‡ç¼–æ ¹æ®ç¼–è¯‘å™¨çš„ä¸åŒï¼Œæœ‰2ç§ä¹¦å†™æ ¼å¼
   1. Intel    ï¼šWindowsæ´¾ç³»
   2. AT&T  ï¼šUnixæ´¾ç³»
7. ä½œä¸ºiOSå¼€å‘å·¥ç¨‹å¸ˆï¼Œä¸»è¦çš„æ±‡ç¼–è¯­è¨€æ˜¯
   1. AT&Tæ±‡ç¼– -----> iOSæ¨¡æ‹Ÿå™¨
   2. ARMæ±‡ç¼– -----> iOSçœŸæœºè®¾å¤‡

##å¸¸è§æ±‡ç¼–æŒ‡ä»¤

1. jmpæ˜¯è·³è½¬ï¼Œcallæ˜¯æ‰§è¡ŒæŸä¸ªå‡½æ•°ï¼Œcallä¸€èˆ¬å’Œreturné…åˆä½¿ç”¨ï¼Œjmpåˆ™ä¸èƒ½ç”¨
2. æœ‰raxï¼Œripï¼Œeaxï¼Œecx(eå¼€å¤´éƒ½æ˜¯32ä½çš„ï¼Œrå¼€å¤´çš„æ˜¯8ä¸ªå­—èŠ‚)
3. æŒ‡ä»¤movã€leaåé¢è·Ÿç€æ•°å­—å†³å®šæ¥æ“ä½œæ•°é•¿åº¦

![å¸¸è§æ±‡ç¼–æŒ‡ä»¤](/Swiftå…¥é—¨åˆ°ç²¾é€šç¬”è®°/å¸¸è§æ±‡ç¼–æŒ‡ä»¤.png)

## lldbå¸¸ç”¨æŒ‡ä»¤

1. thread step-overã€nextã€n : å•æ­¥è¿è¡Œï¼ŒæŠŠå­å‡½æ•°å½“ä½œæ•´ä½“ä¸€æ­¥æ‰§è¡Œ(æºç çº§åˆ«)
2. thread step-inã€stepã€s : å•æ­¥è¿è¡Œï¼Œé‡åˆ°å­å‡½æ•°ä¼šè¿›å…¥å­å‡½æ•°(æºç çº§åˆ«)
3. thread step-inst-overã€nextiã€ni : å•æ­¥è¿è¡Œï¼ŒæŠŠå­å‡½æ•°å½“ä½œæ•´ä½“ä¸€æ­¥æ‰§è¡Œ(æ±‡ç¼–çº§åˆ«)
4. thread step-instã€stepiã€si : å•æ­¥è¿è¡Œï¼Œé‡åˆ°å­å‡½æ•°ä¼šè¿›å…¥å­å‡½æ•°(æ±‡ç¼–çº§åˆ«)
5. thread step-outã€finish : æ‰§è¡Œæ‰§è¡Œå®Œå½“å‰å‡½æ•°çš„æ‰€æœ‰ä»£ç ,è¿”å›åˆ°ä¸Šä¸€ä¸ªå‡½æ•°(é‡åˆ°æ–­ç‚¹ä¼šå¡ä½)
6. ![lldbå¸¸ç”¨æŒ‡ä»¤](/Swiftå…¥é—¨åˆ°ç²¾é€šç¬”è®°/lldbå¸¸ç”¨æŒ‡ä»¤.png)

# ç±»å’Œç»“æ„ä½“

##ç»“æ„ä½“

1. åœ¨Swiftæ ‡å‡†åº“ä¸­ï¼Œç»å¤§å¤šæ•°çš„å…¬å¼€ç±»å‹éƒ½æ˜¯ç»“æ„ä½“ï¼Œè€Œæšä¸¾å’Œç±»åªå å¾ˆå°ä¸€éƒ¨åˆ†

2. Boolã€Intã€Doubleã€Stringã€Arrayã€Dictionaryéƒ½æ˜¯ç»“æ„ä½“

3. æ‰€æœ‰çš„ç»“æ„ä½“éƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„åˆå§‹åŒ–å™¨(ä¿è¯æ‰€æœ‰æˆå‘˜éƒ½æœ‰åˆå§‹å€¼)(initializer,åˆå§‹åŒ–æ–¹æ³•ï¼Œæ„é€ å™¨ï¼Œæ„é€ æ–¹æ³•)

4. ä¸€æ—¦åœ¨å®šä¹‰ç»“æ„ä½“æ—¶è‡ªå®šä¹‰ç±»åˆå§‹åŒ–å™¨ï¼Œç¼–è¯‘å™¨å°±ä¸ä¼šå†å¸®å®ƒè‡ªåŠ¨ç”Ÿæˆå…¶ä»–åˆå§‹åŒ–å™¨

   ```swift
   struct Date {
     var year: Int = 1
     var month: Int
     var day: Int
   }
   var date = Date(year:2019,month:6,day:23) //è¿™äº›æˆå‘˜å«å­˜å‚¨å±æ€§
   var date2 = Date(month: 1, day: 2)
   ```

##ç±»

1. ç±»çš„å®šä¹‰å’Œç»“æ„ä½“ç±»ä¼¼ï¼Œä½†ç¼–è¯‘å™¨å¹¶æ²¡æœ‰ä¸ºç±»è‡ªåŠ¨ç”Ÿæˆå¯ä»¥ä¼ å…¥æˆå‘˜å€¼çš„åˆå§‹åŒ–å™¨
2. å¦‚æœè¿™äº›æˆå‘˜éƒ½æœ‰é»˜è®¤å€¼ï¼Œä¼šåªç”Ÿæˆä¸€ä¸ªæ— å‚åˆå§‹åŒ–å™¨
3. ç±»è‡ªå¸¦16ä¸ªå­—èŠ‚ï¼Œå­˜å‚¨ç±»å‹ä¿¡æ¯å’Œå¼•ç”¨è®¡æ•°

## ç±»å’Œç»“æ„ä½“çš„åŒºåˆ«

1. ç»“æ„ä½“æ˜¯å€¼ç±»å‹(æšä¸¾ä¹Ÿæ˜¯å€¼ç±»å‹)ï¼Œç±»æ˜¯å¼•ç”¨ç±»å‹(æŒ‡é’ˆç±»å‹)

2. æŸ¥çœ‹æ±‡ç¼–å¯çœ‹åˆ°ç»“æ„ä½“æ²¡æœ‰è°ƒç”¨allocï¼Œç±»æœ‰è°ƒç”¨alloc

   ![ç±»å’Œç»“æ„ä½“çš„åŒºåˆ«](/Swiftå…¥é—¨åˆ°ç²¾é€šç¬”è®°/ç±»å’Œç»“æ„ä½“çš„åŒºåˆ«.png)

### å¯¹è±¡çš„å †ç©ºé—´ç”³è¯·è¿‡ç¨‹

1. åœ¨Swiftä¸­ï¼Œåˆ›å»ºç±»çš„å®ä¾‹å¯¹è±¡ï¼Œè¦å‘å †ç©ºé—´ç”³è¯·å†…å­˜ï¼Œå¤§æ¦‚æµç¨‹å¦‚ä¸‹
   1. Class.__allocating_init()
   2. libswiftCore.dylib:_swift_allocObject_
   3. libswiftCore.dylib: swift_slowAlloc
   4. libsystem_malloc.dylib:malloc
2. åœ¨Macã€iOSä¸­çš„mallocå‡½æ•°åˆ†é…çš„å†…å­˜å¤§å°æ€»æ˜¯16çš„å€æ•°
3. é€šè¿‡class_getInstanceSizeå¯ä»¥å¾—çŸ¥ç±»çš„å¯¹è±¡çœŸæ­£ä½¿ç”¨çš„å†…å­˜å¤§å°ï¼šclass_getInstanceSize(Point.self) æˆ–class_getInstanceSize(type(of:p))
4. malloc_size()// æˆ–è€…æŒ‡é’ˆæŒ‡å‘çš„å †ç©ºé—´å ç”¨çš„ç©ºé—´ä½¿ç”¨:

## å¼•ç”¨ç±»å‹

1. å¼•ç”¨èµ‹å€¼ç»™varã€letæˆ–è€…ç»™å‡½æ•°ä¼ å‚ï¼Œæ˜¯å°†å†…å­˜åœ°å€æ‹·è´ä¸€ä»½

2. ç±»ä¼¼äºåˆ¶ä½œä¸€ä¸ªæ–‡ä»¶çš„æ›¿èº«(å¿«æ·æ–¹å¼ã€é“¾æ¥)ï¼ŒæŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªæ–‡ä»¶ã€‚å±äºæµ…æ‹·è´(shallow copy)

   ![å¼•ç”¨ç±»å‹](/Swiftå…¥é—¨åˆ°ç²¾é€šç¬”è®°/å¼•ç”¨ç±»å‹.png)

3. æ±‡ç¼–ï¼šraxã€rdxä¸€èˆ¬ç”¨äºåšå‡½æ•°è¿”å›å€¼ä½¿ç”¨
   1. rdiã€rsiã€rdxã€rcxã€r8ã€r9ç­‰å¯„å­˜å™¨å¸¸ç”¨äºå­˜æ”¾å‡½æ•°å‚æ•°ï¼Œ
   2. å¦‚æœä»¥ä¸Šéƒ½ä¸å¤Ÿæ”¾å‚æ•°ï¼Œrspã€rbpç”¨äºæ ˆæ“ä½œï¼Œä¼šæŠŠå‰©ä½™çš„å‡½æ•°å‚æ•°å­˜æ”¾åœ¨rspã€rbpé‡Œ
   3. ripä½œä¸ºæŒ‡ä»¤æŒ‡é’ˆ
   4. register read rax: è·å–raxçš„åœ°å€å€¼
   5. æ ˆåˆ†é…çš„åœ°å€å…ˆåˆ†é…çš„æ›´é«˜ï¼Œååˆ†é…çš„åœ°å€æ›´ä½
   6. å†…å­˜åœ°å€æ ¼å¼ä¸ºï¼š0x10(%rax)ï¼Œä¸€èˆ¬æ˜¯å †ç©ºé—´

## å€¼ç±»å‹

1. ç±»æ— è®ºåœ¨å“ªé‡Œåˆ›å»ºï¼Œè¿™ä¸ªå¯¹è±¡çš„å†…å­˜éƒ½åœ¨å †ç©ºé—´ï¼ŒæŒ‡é’ˆå˜é‡åœ°å€ä¼šæ ¹æ®æƒ…å†µå˜åŒ–
2. å€¼ç±»å‹èµ‹å€¼ç»™varã€letæˆ–è€…ç»™å‡½æ•°ä¼ å‚ï¼Œæ˜¯ç›´æ¥å°†æ‰€æœ‰å†…å®¹æ‹·è´ä¸€ä»½
3. ç±»ä¼¼äºå¯¹æ–‡ä»¶è¿›è¡Œcopyã€pasteæ“ä½œï¼Œäº§ç”Ÿäº†å…¨æ–°çš„æ–‡æœ¬å‰¯æœ¬ã€‚å±äºæ·±æ‹·è´
4. æ±‡ç¼–eaxå…¶å®å°±æ˜¯raxï¼Œä¸Šä¸€ä¸ªæŒ‡ä»¤æ˜¯eaxï¼Œä¸‹ä¸€ä¸ªæŒ‡ä»¤raxï¼Œä»–ä»¬2ä¸ªå°±æ˜¯ä»£è¡¨åŒä¸€ä¸ªä¸œè¥¿
5. æ±‡ç¼–è§„å¾‹ï¼Œå†…å­˜åœ°å€æ ¼å¼ä¸º:0xxxxx(%rip), ripåŠ ä¸Šä¸€ä¸ªå¾ˆå¤§çš„å€¼ï¼Œä¸€èˆ¬æ˜¯å…¨å±€å˜é‡(å…¨å±€åŒºã€æ•°æ®æ®µ)ï¼Œç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ripçš„å€¼ä¸ä¼šå˜ï¼Œ
6. æ±‡ç¼–è§„å¾‹ï¼Œå†…å­˜åœ°å€æ ¼å¼ä¸º:-0x78(%rbp), rbpå‡æ‰ä¸€ä¸ªå€¼ï¼Œä¸€èˆ¬æ˜¯å±€éƒ¨å˜é‡(æ ˆç©ºé—´)ï¼Œrbpæ¯æ¬¡è°ƒç”¨æ—¶å€™çš„å€¼å°±æœ‰å¯èƒ½ä¸åŒ
7. å­—ç¬¦ä¸²ã€æ•°ç»„éƒ½æ˜¯å€¼ç±»å‹
8. åœ¨Swiftæ ‡å‡†åº“ä¸­ï¼Œä¸ºäº†æç¤ºæ€§èƒ½ï¼ŒStringã€Arrayã€Dictionaryã€Seté‡‡å–äº†Copy On WriteæŠ€æœ¯
   1. Copy On Write: å¦‚æœå€¼ä¸åšæ›´æ”¹ï¼Œå°±ä¸è¿›è¡Œæ·±æ‹·è´ï¼Œå¦‚æœåšäº†ä¿®æ”¹æ“ä½œï¼Œå°±è¿›è¡Œæ·±æ‹·è´
   2. è‡ªå®šä¹‰çš„ç»“æ„ä½“æ˜¯æ²¡æœ‰è¿™ä¸ªæŠ€æœ¯çš„
9. ä¸éœ€è¦ä¿®æ”¹çš„ï¼Œå°½é‡å®šä¹‰ä¸ºlet

```swift
struct Point {
  var x: Int
  var y: Int
}
func test() {
  var p1 = Point(x:10,y:20)
  var p2 = p1
  p2.x = 11
  p2.y = 22
  // é—®p1çš„xå’Œyæ˜¯å¤šå°‘ï¼Ÿ
  // ç­”: 10 20
 
 
  p1 = Point(x:100,y:200)
  // p1çš„åœ°å€å¹¶ä¸ä¼šå˜åŒ–ï¼Œåªæ˜¯åœ°å€é‡Œçš„å€¼ä¼šæ›´æ”¹ä¸º100ï¼Œ200
}
 
 
// Copy On Write
var s1 = "Jack"
var s2 = s1  // å¦‚æœs1å’Œs2çš„å€¼ä¸€æ ·ï¼Œé‚£ä¹ˆs2çš„åœ°å€å’Œs1çš„åœ°å€å°±æ˜¯ä¸€æ ·çš„
s2.appendï¼ˆ"_Rose"ï¼‰ // 2ä¸ªä¸ä¸€æ ·å¼€å§‹åšäº†æ·±æ‹·è´ï¼Œs2åšæ·±æ‹·è´
```

